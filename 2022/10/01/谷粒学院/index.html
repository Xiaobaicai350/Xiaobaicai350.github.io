<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>谷粒学院 | 是小白菜哦</title><meta name="keywords" content="实战项目"><meta name="author" content="小白菜"><meta name="copyright" content="小白菜"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Day1本次项目实现的是一个在线教育平台 商业模式B2C模式（Business To Customer 会员模式） 商家到用户，这种模式是自己制作大量自有版权的视频，放在自有平台上，让用户按月付费或者按年付费。 这种模式简单，快速，只要专心录制大量视频即可快速发展，其曾因为 lynda 的天价融资而大热。 但在中国由于版权保护意识不强，教育内容易于复制，有海量的免费资源的竞争对手众多等原因，难以取">
<meta property="og:type" content="article">
<meta property="og:title" content="谷粒学院">
<meta property="og:url" content="http://example.com/2022/10/01/%E8%B0%B7%E7%B2%92%E5%AD%A6%E9%99%A2/index.html">
<meta property="og:site_name" content="是小白菜哦">
<meta property="og:description" content="Day1本次项目实现的是一个在线教育平台 商业模式B2C模式（Business To Customer 会员模式） 商家到用户，这种模式是自己制作大量自有版权的视频，放在自有平台上，让用户按月付费或者按年付费。 这种模式简单，快速，只要专心录制大量视频即可快速发展，其曾因为 lynda 的天价融资而大热。 但在中国由于版权保护意识不强，教育内容易于复制，有海量的免费资源的竞争对手众多等原因，难以取">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220806101221.jpg">
<meta property="article:published_time" content="2022-10-01T09:34:07.000Z">
<meta property="article:modified_time" content="2023-02-25T03:14:05.161Z">
<meta property="article:author" content="小白菜">
<meta property="article:tag" content="实战项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220806101221.jpg"><link rel="shortcut icon" href="https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/132124.png"><link rel="canonical" href="http://example.com/2022/10/01/%E8%B0%B7%E7%B2%92%E5%AD%A6%E9%99%A2/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '谷粒学院',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-25 11:14:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"><script src="/live2d-widget/autoload.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/plugins.min.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/pic.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220806101221.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">是小白菜哦</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">谷粒学院</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-01T09:34:07.000Z" title="发表于 2022-10-01 17:34:07">2022-10-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-25T03:14:05.161Z" title="更新于 2023-02-25 11:14:05">2023-02-25</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="谷粒学院"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Day1"><a href="#Day1" class="headerlink" title="Day1"></a>Day1</h1><p>本次项目实现的是一个在线教育平台</p>
<h2 id="商业模式"><a href="#商业模式" class="headerlink" title="商业模式"></a>商业模式</h2><h3 id="B2C模式"><a href="#B2C模式" class="headerlink" title="B2C模式"></a>B2C模式</h3><p>（Business To Customer 会员模式）</p>
<p>商家到用户，这种模式是自己制作大量自有版权的视频，放在自有平台上，让用户按月付费或者按年付费。 这种模式简单，快速，只要专心录制大量视频即可快速发展，其曾因为 lynda 的天价融资而大热。</p>
<p>但在中国由于版权保护意识不强，教育内容易于复制，有海量的免费资源的竞争对手众多等原因，难以取得像样的现金流。</p>
<p><strong>这种商业模式就是本次项目所使用的模式。</strong></p>
<p>谷粒学院 <a target="_blank" rel="noopener" href="http://www.gulixueyuan.com/">http://www.gulixueyuan.com/</a></p>
<h3 id="B2B2C模式"><a href="#B2B2C模式" class="headerlink" title="B2B2C模式"></a>B2B2C模式</h3><p>平台链接第三方教育机构和用户，平台一般不直接提供课程内容，而是更多承担教育的互联网载体角色，为教学过程各个环节提供全方位支持和服务。</p>
<p>或者来说，举个例子，京东里面有京东自营店，还有其他个体卖家。</p>
<p>腾讯课堂 <a target="_blank" rel="noopener" href="https://ke.qq.com/">https://ke.qq.com/</a></p>
<h2 id="谷粒学院功能简介"><a href="#谷粒学院功能简介" class="headerlink" title="谷粒学院功能简介"></a>谷粒学院功能简介</h2><p>谷粒学院，是一个B2C模式的<strong>职业技能在线教育</strong>系统，分为<strong>前台用户系统</strong>和<strong>后台运营平台</strong>。</p>
<p><img src="/../pic/image-20221001174236442.png" alt="image-20221001174236442"></p>
<h2 id="Mybatis-Plus"><a href="#Mybatis-Plus" class="headerlink" title="Mybatis Plus"></a>Mybatis Plus</h2><p>知识点总结</p>
<h3 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h3><p>配置properties文件（根据自己的需要改）</p>
<p>数据库环境看着配就行</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_plus?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">xth</span></span><br></pre></td></tr></table></figure>

<h3 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h3><p>根据数据库中的字段一一对应着写就行，需要注意的是：<strong>MP自动会把下划线命名法转换为驼峰命名法</strong>，不需要再做额外的配置，也可以根据有关注解与数据库中的字段相照应，但是最好不要这样做</p>
<h3 id="创建Mapper"><a href="#创建Mapper" class="headerlink" title="创建Mapper"></a>创建Mapper</h3><p><img src="/../pic/image-20221001174655764.png" alt="image-20221001174655764"></p>
<p>注意这里我没有加@Mapper注解，为了方便起见，最好还是用@MapperScan注解，二者其实并没有什么区别</p>
<p>下面是@MapperScan注解的位置，可以扫描整个包真的很省事</p>
<p><img src="/../pic/image-20221001175328987.png" alt="image-20221001175328987"></p>
<h3 id="配置日志"><a href="#配置日志" class="headerlink" title="配置日志"></a>配置日志</h3><p>在properties文件中加入这个就开启日志了</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#mybatis日志</span></span><br><span class="line"><span class="attr">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<h3 id="主键新增策略"><a href="#主键新增策略" class="headerlink" title="主键新增策略"></a>主键新增策略</h3><p>你可能会问，为什么MP知道哪个是主键字段？</p>
<blockquote>
<p>情况一：</p>
<blockquote>
<p>如果数据库中主键名称叫id，实体类中的属性名也叫id，mp默认认为字段名为id的是主键。</p>
</blockquote>
<p>情况二：</p>
<blockquote>
<p>如果数据库中主键名称叫uid，实体类中的属性名叫id，需要使用注解@TableId。</p>
<p><img src="/../pic/image-20221001175807128.png" alt="image-20221001175807128"></p>
</blockquote>
</blockquote>
<p>拉回正轨，咳咳，我们这个讨论的是MP的主键新增策略</p>
<p>一共有下面<img src="/../pic/image-20221001175947183.png" alt="image-20221001175947183"></p>
<p>六个策略，我简单的总结一下</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>AUTO</td>
<td>自动增长（需要注意的是数据库中主键字段也需要设置为自动增长，要不然会报错）</td>
</tr>
<tr>
<td>NONE</td>
<td>不设置MP对于主键的自动生成策略</td>
</tr>
<tr>
<td>INPUT</td>
<td>通过用户自动设置</td>
</tr>
<tr>
<td>ID_WORKER</td>
<td>对于Long类型主键，MP默认的自动生成策略</td>
</tr>
<tr>
<td>UUID</td>
<td>UUID生成策略，之前一直用的</td>
</tr>
<tr>
<td>ID_WORKER_STR</td>
<td>对于String类型主键，用的这个</td>
</tr>
</tbody></table>
<h3 id="自动填充"><a href="#自动填充" class="headerlink" title="自动填充"></a>自动填充</h3><p>之前做过的两个项目都有自动填充功能，下面总结一下具体实现。</p>
<ol>
<li>在实体类的属性上加入注解</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Date updateTime;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>实现元对象处理器接口</li>
</ol>
<p>注意：要在类上加上@Component注解，加入springIOC容器中</p>
<p>代码很简单，在里面加入处理逻辑就好了</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="comment">//根据名称设置属性值</span></span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>完成，之后再添加或更新就可以自动更新&#x2F;添加字段了</li>
</ol>
<h3 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h3><p>现在都不咋用悲观锁了，但还是介绍一下把</p>
<p>悲观锁：当你更新这条记录的时候，其他人都不能更新这条数据</p>
<p>乐观锁：当要更新一条记录的时候，记下version的值，之后修改过就+1，如果最后得到的值确实是version+1。则说明实现线程安全的数据更新。</p>
<p>我们主要再MP中实现乐观锁</p>
<p><strong>乐观锁实现方式：</strong></p>
<ol>
<li>取出记录时，获取当前version</li>
<li>更新时，带上这个version</li>
<li>执行更新时， set version &#x3D; newVersion where version &#x3D; oldVersion</li>
<li>如果version不对，就更新失败</li>
</ol>
<p>具体步骤：</p>
<ol>
<li>在数据库中添加version字段，并且设置插入时默认值为1</li>
</ol>
<p><img src="/../pic/image-20221001182843580.png" alt="image-20221001182843580"></p>
<ol start="2">
<li>在实体类中加入version属性和@Version注解</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Version</span></span><br><span class="line"><span class="keyword">private</span> Integer version;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置乐观锁插件</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.mpdemo.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 乐观锁插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OptimisticLockerInterceptor <span class="title function_">optimisticLockerInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OptimisticLockerInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>完成，可以测试（先查询再修改）</li>
</ol>
<h3 id="分页插件"><a href="#分页插件" class="headerlink" title="分页插件"></a>分页插件</h3><p>之前就用过了，简单总结一下</p>
<ol>
<li>在MybatisPlusConfig类中配置分页插件</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写查询分页代码</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">    void testDemo5()&#123;</span><br><span class="line">        Page&lt;User&gt; page = new Page&lt;User&gt;(1,5);</span><br><span class="line">        userMapper.selectPage(page, null);</span><br><span class="line"></span><br><span class="line">        page.getRecords().forEach(System.out::println);</span><br><span class="line">        System.out.println(page.getCurrent());</span><br><span class="line">        System.out.println(page.getPages());</span><br><span class="line">        System.out.println(page.getSize());</span><br><span class="line">        System.out.println(page.getTotal());</span><br><span class="line">        System.out.println(page.hasNext());</span><br><span class="line">        System.out.println(page.hasPrevious());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>具体的属性可以去mp官网查，用到哪个找哪个</p>
<h3 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h3><p>比如一个员工离职，我们不想删除他的信息，我们可以给他标志位离职</p>
<p>在MP中有相应的插件可以帮我们完成逻辑删除</p>
<ol>
<li>在数据库中添加一个deleted字段，默认值为0（修改值为1说明被删除了）</li>
</ol>
<p><img src="/../pic/image-20221001200132924.png" alt="image-20221001200132924"></p>
<ol start="2">
<li>在实体类中加入字段，并加上逻辑删除的@TableLogic注解</li>
</ol>
<p><img src="/../pic/image-20221001200233672.png" alt="image-20221001200233672"></p>
<ol start="3">
<li>在MybatisPlusConfig类中配置逻辑删除插件</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ISqlInjector <span class="title function_">sqlInjector</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LogicSqlInjector</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>完成，可以测试了，执行删除代码,最终效果deleted值变成1，之后不管是查询全部还是其他查询，都会在后面加上一个条件<code>where deleted = 0</code></li>
</ol>
<h3 id="性能分析插件"><a href="#性能分析插件" class="headerlink" title="性能分析插件"></a>性能分析插件</h3><p>这个插件用于在你执行sql的时候，会在控制台显示执行的时间，你可以设置超过多少s的sql不执行。</p>
<ol>
<li>在MybatisPlusConfig类中配置性能分析插件</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * SQL 执行性能分析插件</span></span><br><span class="line"><span class="comment">     * 开发环境使用，线上不推荐。 maxTime 指的是 sql 最大执行时长</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile(&#123;&quot;dev&quot;,&quot;test&quot;&#125;)</span><span class="comment">// 设置在dev和test下环境开启性能分析插件</span></span><br><span class="line"><span class="keyword">public</span> PerformanceInterceptor <span class="title function_">performanceInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">PerformanceInterceptor</span> <span class="variable">performanceInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PerformanceInterceptor</span>();</span><br><span class="line">    performanceInterceptor.setMaxTime(<span class="number">100</span>);<span class="comment">//ms，超过此处设置的ms则sql不执行</span></span><br><span class="line">    performanceInterceptor.setFormat(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> performanceInterceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在配置文件中加入现在是什么环境下的</li>
</ol>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#环境设置：dev、test、prod</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">test</span></span><br></pre></td></tr></table></figure>

<h1 id="Day2"><a href="#Day2" class="headerlink" title="Day2"></a>Day2</h1><h2 id="搭建项目结构"><a href="#搭建项目结构" class="headerlink" title="搭建项目结构"></a>搭建项目结构</h2><p><img src="/../pic/image-20221001205318981.png" alt="image-20221001205318981"></p>
<h3 id="模块说明"><a href="#模块说明" class="headerlink" title="模块说明"></a>模块说明</h3><blockquote>
<p><strong>guli-parent</strong>：在线教学根目录（父工程），管理四个子模块：</p>
<p> <strong>canal-client</strong>：<strong>canal</strong>数据库表同步模块（统计同步数据）</p>
<p> <strong>common</strong>：公共模块父节点</p>
<p> common-util：工具类模块，所有模块都可以依赖于它</p>
<p> service-base：service服务的base包，包含service服务的公共配置类，所有service模块依赖于它</p>
<p> spring-security：认证与授权模块，需要认证授权的service服务依赖于它</p>
<p><strong>infrastructure</strong>：基础服务模块父节点</p>
<p> api-gateway：api网关服务</p>
<p> <strong>service</strong>：<strong>api</strong>接口服务父节点</p>
<p>service-acl：用户权限管理api接口服务（用户管理、角色管理和权限管理等）</p>
<p>service-cms：cms api接口服务</p>
<p>service-edu：教学相关api接口服务</p>
<p>service-msm：短信api接口服务</p>
<p>service-order：订单相关api接口服务</p>
<p>service-oss：阿里云oss api接口服务</p>
<p>service-statistics：统计报表api接口服务</p>
<p>service-ucenter：会员api接口服务</p>
<p>service-vod：视频点播api接口服务</p>
</blockquote>
<p>创建代码结构并配置依赖</p>
<p><img src="/../pic/image-20221001213451991.png" alt="image-20221001213451991"></p>
<p>（这里我配置依赖配置了好久，因为有的依赖下载不下来，但是我看在网上搜索了一下，在响应的依赖下加入相应的版本号就可以了）</p>
<p><img src="/../pic/image-20221002110822417.png" alt="image-20221002110822417"></p>
<p>10.2再寄，依赖冲突了，我再试试</p>
<p>最终还是导入了老师的仓库和源码，不得不说，配环境这个问题真的是很浪费时间</p>
<h2 id="配置配置文件"><a href="#配置配置文件" class="headerlink" title="配置配置文件"></a>配置配置文件</h2><p>根据自己的配置文件修改</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8001</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">service-edu</span></span><br><span class="line"><span class="comment"># dev?test?prod</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"># mysql</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">xth</span></span><br><span class="line"><span class="comment">#mybatis-plus</span></span><br><span class="line"><span class="attr">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<h2 id="MP代码生成器生成大致框架"><a href="#MP代码生成器生成大致框架" class="headerlink" title="MP代码生成器生成大致框架"></a>MP代码生成器生成大致框架</h2><p>直接用就行，不过这部分代码放在测试中就可以了，只是一个生成的工具</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGenerator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        <span class="comment">//输出目录</span></span><br><span class="line">        gc.setOutputDir(projectPath + <span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">        <span class="comment">//设置作者</span></span><br><span class="line">        gc.setAuthor(<span class="string">&quot;昊昊&quot;</span>);</span><br><span class="line">        gc.setOpen(<span class="literal">false</span>); <span class="comment">//生成后是否打开资源管理器</span></span><br><span class="line">        gc.setFileOverride(<span class="literal">false</span>); <span class="comment">//重新生成时文件是否覆盖</span></span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);	<span class="comment">//去掉Service接口的首字母I</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER); <span class="comment">//主键策略</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);<span class="comment">//定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);<span class="comment">//开启Swagger2模式</span></span><br><span class="line"></span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;xth&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        <span class="comment">//包名com.atguigu.eduservice.controller</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        pc.setModuleName(<span class="string">&quot;eduservice&quot;</span>); <span class="comment">//模块名</span></span><br><span class="line">        pc.setParent(<span class="string">&quot;com.atguigu&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;edu_teacher&quot;</span>);</span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);<span class="comment">//数据库表映射到实体的命名策略</span></span><br><span class="line">        strategy.setTablePrefix(pc.getModuleName() + <span class="string">&quot;_&quot;</span>); <span class="comment">//生成实体时去掉表前缀</span></span><br><span class="line"></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);<span class="comment">//数据库表字段映射到实体的命名策略</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>); <span class="comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span></span><br><span class="line"></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>); <span class="comment">//restful api风格控制器</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>); <span class="comment">//url中驼峰转连字符</span></span><br><span class="line"></span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="统一返回json时间的格式"><a href="#统一返回json时间的格式" class="headerlink" title="统一返回json时间的格式"></a>统一返回json时间的格式</h2><p>默认情况下json时间格式带有时区，并且是世界标准时间，和我们的时间差了八个小时</p>
<p>在application.properties中设置</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#返回json的全局时间格式</span></span><br><span class="line"><span class="attr">spring.jackson.date-format</span>=<span class="string">yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="attr">spring.jackson.time-zone</span>=<span class="string">GMT+8</span></span><br></pre></td></tr></table></figure>

<h2 id="在service中使用swagger"><a href="#在service中使用swagger" class="headerlink" title="在service中使用swagger"></a>在service中使用swagger</h2><p>创建以下工程</p>
<p><img src="/../pic/image-20221002115120828.png" alt="image-20221002115120828"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="comment">//配置类</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span> <span class="comment">//swagger注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">webApiConfig</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;haohaoAPI&quot;</span>)</span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/admin/.*&quot;</span>)))</span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/error.*&quot;</span>)))</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">webApiInfo</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;网站-课程中心API文档&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;本文档描述了课程中心微服务接口定义&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;瑶瑶昊昊&quot;</span>, <span class="string">&quot;http://atguigu.com&quot;</span>, <span class="string">&quot;1499487526@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后我们再在server中引入service_base模块</p>
<p><img src="/../pic/image-20221002115331408.png" alt="image-20221002115331408"></p>
<h2 id="把pom文件中的bean交给spring管理的方法"><a href="#把pom文件中的bean交给spring管理的方法" class="headerlink" title="把pom文件中的bean交给spring管理的方法"></a>把pom文件中的bean交给spring管理的方法</h2><p>比如说我们之前引入了service_base模块，但是如果不把config文件交给spring管理是加载不上的，所以可以这样</p>
<p>Springboot默认只会扫描启动类所在包极其子包下的带有@Component注解的类，但是如果超出这个范围就扫描不到了</p>
<p>下面配置的是既能扫描我们的包下的，又能扫描引入依赖那个包下面的 </p>
<p><img src="/../pic/image-20221002120017867.png" alt="image-20221002120017867"></p>
<h2 id="统一返回结果"><a href="#统一返回结果" class="headerlink" title="统一返回结果"></a>统一返回结果</h2><p>项目中我们会将响应封装成json返回，一般我们会将所有接口的数据格式统一， 使前端(iOS Android,Web)对数据的操作更一致、轻松。</p>
<p>一般情况下，统一返回数据格式没有固定的格式，只要能描述清楚返回的数据状态以及要返回的具体数据就可以。但是一般会包含状态码、返回消息、数据这几部分内容</p>
<p>例如，我们的系统要求返回的基本数据格式如下：</p>
<p>列表：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">20000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;刘德华&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;intro&quot;</span><span class="punctuation">:</span> <span class="string">&quot;毕业于师范大学数学系，热爱教育事业，执教数学思维6年有余&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">        ....</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>分页：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">20000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">17</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;刘德华&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;intro&quot;</span><span class="punctuation">:</span> <span class="string">&quot;毕业于师范大学数学系，热爱教育事业，执教数学思维6年有余&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">        ....</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>没有返回数据：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">20000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>失败：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">20001</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;失败&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>所以根据规律，定义统一结果</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> 布尔<span class="punctuation">,</span> <span class="comment">//响应是否成功</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> 数字<span class="punctuation">,</span> <span class="comment">//响应码</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> 字符串<span class="punctuation">,</span> <span class="comment">//返回消息</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> HashMap <span class="comment">//返回数据，放在键值对中</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="编码实现"><a href="#编码实现" class="headerlink" title="编码实现"></a>编码实现</h3><ol>
<li>编写响应码</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResultCode</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">SUCCESS</span> <span class="operator">=</span> <span class="number">20000</span>; <span class="comment">//成功</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">ERROR</span> <span class="operator">=</span> <span class="number">20001</span>; <span class="comment">//失败</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写R返回结果类</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.commonutils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//统一返回结果的类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;是否成功&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回消息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回数据&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把构造方法私有</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">R</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//成功静态方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">ok</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">R</span>();</span><br><span class="line">        r.setSuccess(<span class="literal">true</span>);</span><br><span class="line">        r.setCode(ResultCode.SUCCESS);</span><br><span class="line">        r.setMessage(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//失败静态方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">error</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">R</span>();</span><br><span class="line">        r.setSuccess(<span class="literal">false</span>);</span><br><span class="line">        r.setCode(ResultCode.ERROR);</span><br><span class="line">        r.setMessage(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用下面的方法，主要是满足链式编程的原理，比如,R.ok().success()....等等</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">success</span><span class="params">(Boolean success)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setSuccess(success);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">message</span><span class="params">(String message)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setMessage(message);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">code</span><span class="params">(Integer code)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setCode(code);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">data</span><span class="params">(String key, Object value)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.data.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">data</span><span class="params">(Map&lt;String, Object&gt; map)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setData(map);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在用到返回结果的模块引入依赖</li>
</ol>
<p><img src="/../pic/image-20221002125806447.png" alt="image-20221002125806447"></p>
<h2 id="跨域配置"><a href="#跨域配置" class="headerlink" title="跨域配置"></a><strong>跨域配置</strong></h2><p>浏览器从一个域名的网页去请求另一个域名的资源时，域名、端口、协议任一不同，都是跨域 。前后端分离开发中，需要考虑ajax跨域的问题。</p>
<p><img src="/../pic/image-20221003155307865.png" alt="image-20221003155307865"></p>
<p>这里我们可以从服务端解决这个问题</p>
<p><strong>配置</strong></p>
<p>在Controller类上添加注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span> <span class="comment">//跨域</span></span><br></pre></td></tr></table></figure>

<h2 id="条件查询分页"><a href="#条件查询分页" class="headerlink" title="条件查询分页"></a>条件查询分页</h2><p>这个业务是  </p>
<p><code>根据讲师名称name，讲师头衔level、讲师入驻时间gmt_create（时间段）查询 </code></p>
<p>之后再分页</p>
<p>开发规范中，通常把需要传属性多的请求封装成一个实体类，叫<strong>vo</strong>,在这个业务中，我们封装成TeacherQuery</p>
<p><img src="/../pic/image-20221002132450275.png" alt="image-20221002132450275">\</p>
<p>那么这个类怎么写呢，答案是根据业务写</p>
<p>业务大概是这样</p>
<p><img src="/../pic/image-20221002132750554.png" alt="image-20221002132750554"></p>
<p>对着，然后改成代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TeacherQuery</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;教师名称,模糊查询&quot; ,example = &quot;张三&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;头衔 1高级讲师 2首席讲师&quot; ,example = &quot;1&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer level;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;查询开始时间&quot;, example = &quot;2019-01-01 10:10:10&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String begin;<span class="comment">//注意，这里使用的是String类型，前端传过来的数据无需进行类型转换</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;查询结束时间&quot;, example = &quot;2019-12-01 10:10:10&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是</p>
<p><img src="/../pic/image-20221002135445332.png" alt="image-20221002135445332"></p>
<p>这个红框里面的东西，是和上面的实体类中的swagger注解的example属性相对应的</p>
<p>@RequestBody</p>
<p>需要使用post提交方式，用其他方式是取不到的</p>
<p>只能发送POST请求，GET方式无请求体</p>
<p>用法是：使用json传递数据,把json数据封装到对应对象里面</p>
<p><strong>完善代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//4 条件查询带分页的方法</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;pageTeacherCondition/&#123;current&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">pageTeacherCondition</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">long</span> current,<span class="meta">@PathVariable</span> <span class="type">long</span> limit,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@RequestBody(required = false)</span>  TeacherQuery teacherQuery)</span> &#123;</span><br><span class="line">        <span class="comment">//创建page对象</span></span><br><span class="line">        Page&lt;EduTeacher&gt; pageTeacher = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current,limit);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建条件</span></span><br><span class="line">        LambdaQueryWrapper&lt;EduTeacher&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;EduTeacher&gt;();</span><br><span class="line">        <span class="comment">// 多条件组合查询</span></span><br><span class="line">        <span class="comment">// mybatis学过 动态sql</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> teacherQuery.getName();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">level</span> <span class="operator">=</span> teacherQuery.getLevel();</span><br><span class="line">        <span class="type">String</span> <span class="variable">begin</span> <span class="operator">=</span> teacherQuery.getBegin();</span><br><span class="line">        <span class="type">String</span> <span class="variable">end</span> <span class="operator">=</span> teacherQuery.getEnd();</span><br><span class="line"></span><br><span class="line">        wrapper.like(name!=<span class="literal">null</span>,EduTeacher::getName,name);</span><br><span class="line">        wrapper.eq(level!=<span class="literal">null</span>,EduTeacher::getLevel,level);</span><br><span class="line">        wrapper.ge(begin!=<span class="literal">null</span>,EduTeacher::getGmtCreate,begin);</span><br><span class="line">        wrapper.le(end!=<span class="literal">null</span>,EduTeacher::getGmtCreate,end);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用方法实现条件查询分页</span></span><br><span class="line">        teacherService.page(pageTeacher,wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> pageTeacher.getTotal();<span class="comment">//总记录数</span></span><br><span class="line">        List&lt;EduTeacher&gt; records = pageTeacher.getRecords(); <span class="comment">//数据list集合</span></span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;total&quot;</span>,total).data(<span class="string">&quot;rows&quot;</span>,records);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//指定出现什么异常执行这个方法</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span> <span class="comment">//为了返回数据</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">error</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;执行了全局异常处理..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//特定异常处理</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ArithmeticException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">arithmeticExceptionError</span><span class="params">(ArithmeticException e)</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;执行了特定异常处理&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再在需要用到全局异常处理的地方引入依赖就可以了</p>
<p>基本原理是，如果有特定的异常处理类，就走特定，没有特定就走全局异常</p>
<h2 id="统一日志处理"><a href="#统一日志处理" class="headerlink" title="统一日志处理"></a>统一日志处理</h2><h3 id="配置日志级别"><a href="#配置日志级别" class="headerlink" title="配置日志级别"></a>配置日志级别</h3><p>日志记录器（Logger）的行为是分等级的。如下表所示：</p>
<p>分为：OFF、FATAL、<strong>ERROR</strong>、<strong>WARN</strong>、<strong>INFO</strong>、<strong>DEBUG</strong>、ALL</p>
<p>默认情况下，spring boot从控制台打印出来的日志级别只有INFO及以上级别，可以配置日志级别</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 设置日志级别</span></span><br><span class="line"><span class="attr">logging.level.root</span>=<span class="string">WARN</span></span><br></pre></td></tr></table></figure>

<h3 id="把日志输出到文件中"><a href="#把日志输出到文件中" class="headerlink" title="把日志输出到文件中"></a>把日志输出到文件中</h3><ol>
<li>删除配置文件中的关于日志的配置删除</li>
</ol>
<p><img src="/../pic/image-20221002144039066.png" alt="image-20221002144039066"></p>
<ol start="2">
<li>resources 中创建 logback-spring.xml</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;10 seconds&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志级别从低到高分为TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL，如果设</span></span><br><span class="line"><span class="comment">    置为WARN，则低于WARN的信息都不会输出 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- scan:当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值</span></span><br><span class="line"><span class="comment">    为true --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- scanPeriod:设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认</span></span><br><span class="line"><span class="comment">    单位是毫秒。当scan为true时，此属性生效。默认的时间间隔为1分钟。 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- de<span class="doctag">bug:</span>当此属性设置为true时，将打印出logback内部日志信息，实时查</span></span><br><span class="line"><span class="comment">    看logback运行状态。默认值为false。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span>&gt;</span>logback<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- name的值是变量的名称，value的值时变量定义的值。通过定义的值会被插入</span></span><br><span class="line"><span class="comment">    到logger上下文中。定义变量后，可以使“$&#123;&#125;”来使用变量。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log.path&quot;</span> <span class="attr">value</span>=<span class="string">&quot;D:/All项目/谷粒学院/log&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 彩色日志 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置格式变量：CONSOLE_LOG_PATTERN 彩色日志格式 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:洋红 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- boldMagenta:粗红--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- cyan:青色 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- white:白色 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:洋红 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE_LOG_PATTERN&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">&quot;%yellow(%date&#123;yyyy-MM-dd HH:mm:ss&#125;) |%highlight(%-5level)</span></span></span><br><span class="line"><span class="string"><span class="tag">|%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--输出到控制台--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或</span></span><br><span class="line"><span class="comment">        等于此级别的日志信息--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 例如：如果此处配置了INFO级别，则后面其他位置即使配置了DEBUG级别的日</span></span><br><span class="line"><span class="comment">        志，也不会被输出 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span> <span class="tag">&lt;<span class="name">encoder</span>&gt;</span> <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置字符集 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--输出到文件--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 时间滚动输出 level为 INFO 日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;INFO_FILE&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/log_info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span> <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level</span><br><span class="line">            %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span> <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 每天日志归档路径以及格式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/info/log-info-%d&#123;yyyy-MM�dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span> <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此日志文件只记录info级别的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 时间滚动输出 level为 WARN 日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;WARN_FILE&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/log_warn.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span> <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level</span><br><span class="line">            %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span> <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- 此处设置字符集 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/warn/log-warn-%d&#123;yyyy-MM�dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span> <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此日志文件只记录warn级别的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">level</span>&gt;</span>warn<span class="tag">&lt;/<span class="name">level</span>&gt;</span> <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span> <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 时间滚动输出 level为 ERROR 日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;ERROR_FILE&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/log_error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span> <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level</span><br><span class="line">            %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span> <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- 此处设置字符集 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/error/log-error-%d&#123;yyyy-MM�dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span> <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此日志文件只记录ERROR级别的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span> <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span> <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;logger&gt;用来设置某一个包或者具体的某一个类的日志打印级别、以及指</span></span><br><span class="line"><span class="comment">    定&lt;appender&gt;。</span></span><br><span class="line"><span class="comment">    &lt;logger&gt;仅有一个name属性，</span></span><br><span class="line"><span class="comment">    一个可选的level和一个可选的addtivity属性。</span></span><br><span class="line"><span class="comment">    name:用来指定受此logger约束的某一个包或者具体的某一个类。</span></span><br><span class="line"><span class="comment">    level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL</span></span><br><span class="line"><span class="comment">    和 OFF，</span></span><br><span class="line"><span class="comment">    如果未设置此属性，那么当前logger将会继承上级的级别。</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    使用mybatis的时候，sql语句是debug下才会打印，而这里我们只配置了info，所以想</span></span><br><span class="line"><span class="comment">    要查看sql语句的话，有以下两种操作：</span></span><br><span class="line"><span class="comment">    第一种把&lt;root level=&quot;INFO&quot;&gt;改成&lt;root level=&quot;DEBUG&quot;&gt;这样就会打印sql，不过</span></span><br><span class="line"><span class="comment">    这样日志那边会出现很多其他消息</span></span><br><span class="line"><span class="comment">    第二种就是单独给mapper下目录配置DEBUG模式，代码如下，这样配置sql语句会打</span></span><br><span class="line"><span class="comment">    印，其他还是正常DEBUG级别：</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开发环境:打印控制台--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--可以输出项目中的debug日志，包括mybatis的sql日志--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.guli&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        root节点是必选节点，用来指定最基础的日志输出级别，只有一个level属性</span></span><br><span class="line"><span class="comment">        level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR,</span></span><br><span class="line"><span class="comment">        ALL 和 OFF，默认是DEBUG</span></span><br><span class="line"><span class="comment">        可以包含零个或多个appender元素。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;INFO_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;WARN_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--生产环境:输出到文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;pro&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;DEBUG_FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;INFO_FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;WARN_FILE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>里面需要注意的是，输出路径的格式，嘿嘿因为我踩过这个坑了</p>
<h3 id="把错误的日志单独输出"><a href="#把错误的日志单独输出" class="headerlink" title="把错误的日志单独输出"></a>把错误的日志单独输出</h3><p>加入这两个东西，就可以输出了</p>
<img src="../pic/image-20221002145601457.png" alt="image-20221002145601457" style="zoom:50%;" />

<p>之后触发异常后就会输出错误信息到这里面啦(里面输出的错误信息可以修改哦)</p>
<p><img src="/../pic/image-20221002145747700.png" alt="image-20221002145747700"></p>
<hr>
<h1 id="Day3"><a href="#Day3" class="headerlink" title="Day3"></a>Day3</h1><h2 id="在VSCode里面创建工作区"><a href="#在VSCode里面创建工作区" class="headerlink" title="在VSCode里面创建工作区"></a>在VSCode里面创建工作区</h2><ol>
<li>先创建一个空文件夹</li>
<li>用VSCode打开这个空文件夹</li>
<li>点击<img src="/../pic/image-20221002151138556.png" alt="image-20221002151138556"></li>
<li>保存文件就可以了</li>
<li>运行<img src="/../pic/image-20221002151439422.png" alt="image-20221002151439422"></li>
</ol>
<h2 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h2><p>ES6是一套标准，JavaScript是ES6的具体实现</p>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><h4 id="let声明变量"><a href="#let声明变量" class="headerlink" title="let声明变量"></a>let声明变量</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// var 声明的变量没有局部作用域</span></span><br><span class="line"><span class="comment">// let 声明的变量 有局部作用域</span></span><br><span class="line">	&#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> b = <span class="number">1</span> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// 0</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(b) <span class="comment">// ReferenceError: b is not defined</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// var 可以声明多次</span></span><br><span class="line"><span class="comment">// let 只能声明一次</span></span><br><span class="line"><span class="keyword">var</span> m = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> m = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> n = <span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> n = <span class="number">4</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m) <span class="comment">// 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n) <span class="comment">// Identifier &#x27;n&#x27; has already been declared</span></span><br></pre></td></tr></table></figure>

<h4 id="const声明常量（只读变量）"><a href="#const声明常量（只读变量）" class="headerlink" title="const声明常量（只读变量）"></a>const声明常量（只读变量）</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、声明之后不允许改变 </span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PI</span> = <span class="string">&quot;3.1415926&quot;</span></span><br><span class="line"><span class="variable constant_">PI</span> = <span class="number">3</span> <span class="comment">// TypeError: Assignment to constant variable.</span></span><br><span class="line"><span class="comment">// 2、一但声明必须初始化，否则会报错</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MY_AGE</span> <span class="comment">// SyntaxError: Missing initializer in const declaration</span></span><br></pre></td></tr></table></figure>

<h4 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h4><p>解构赋值是对赋值运算符的扩展。</p>
<p>他是一种针对数组或者对象进行模式匹配，然后对其中的变量进行赋值。</p>
<p>在代码书写上简洁且易读，语义更加清晰明了；也方便了复杂对象中数据字段获取。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1、数组解构</span></span><br><span class="line"><span class="comment">// 传统</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>, b = <span class="number">2</span>, c = <span class="number">3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c)</span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> [x, y, z] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x, y, z)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//2、对象解构</span></span><br><span class="line"><span class="keyword">let</span> user = &#123;<span class="attr">name</span>: <span class="string">&#x27;Helen&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;</span><br><span class="line"><span class="comment">// 传统</span></span><br><span class="line"><span class="keyword">let</span> name1 = user.<span class="property">name</span></span><br><span class="line"><span class="keyword">let</span> age1 = user.<span class="property">age</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name1, age1)</span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> &#123; name, age &#125; = user<span class="comment">//注意：结构的变量必须是user中的属性</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name, age)</span><br></pre></td></tr></table></figure>

<h4 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h4><p>模板字符串相当于加强版的字符串，用反引号 &#96;,除了作为普通字符串，还可以用来定义多行字符串，还可以在字符串中加入变量和表达式。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、多行字符串</span></span><br><span class="line"><span class="keyword">let</span> string1 = <span class="string">`Hey,</span></span><br><span class="line"><span class="string">can you stop angry now?`</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(string1)</span><br><span class="line"><span class="comment">// Hey,</span></span><br><span class="line"><span class="comment">// can you stop angry now?</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2、字符串插入变量和表达式。变量名写在 $&#123;&#125; 中，$&#123;&#125; 中可以放入 JavaScript 表达式。</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;Mike&quot;</span></span><br><span class="line"><span class="keyword">let</span> age = <span class="number">27</span></span><br><span class="line"><span class="keyword">let</span> info = <span class="string">`My Name is <span class="subst">$&#123;name&#125;</span>,I am <span class="subst">$&#123;age+<span class="number">1</span>&#125;</span> years old next year.`</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info)</span><br><span class="line"><span class="comment">// My Name is Mike,I am 28 years old next year.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 3、字符串中调用函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>)&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="string">&quot;have fun!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> string2 = <span class="string">`Game start,<span class="subst">$&#123;f()&#125;</span>`</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(string2); <span class="comment">// Game start,have fun!</span></span><br></pre></td></tr></table></figure>

<h4 id="声明对象简写"><a href="#声明对象简写" class="headerlink" title="声明对象简写"></a>声明对象简写</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> age = <span class="number">12</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;Amy&quot;</span></span><br><span class="line"><span class="comment">// 传统</span></span><br><span class="line"><span class="keyword">const</span> person1 = &#123;<span class="attr">age</span>: age, <span class="attr">name</span>: name&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">const</span> person2 = &#123;age, name&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person2) <span class="comment">//&#123;age: 12, name: &quot;Amy&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="定义方法简写"><a href="#定义方法简写" class="headerlink" title="定义方法简写"></a>定义方法简写</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 传统</span></span><br><span class="line"><span class="comment">//person1相当于类名，sayHi相当于方法名</span></span><br><span class="line"><span class="keyword">const</span> person1 = &#123;</span><br><span class="line">    <span class="attr">sayHi</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hi&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">person1.<span class="title function_">sayHi</span>();<span class="comment">//&quot;Hi&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">const</span> person2 = &#123;</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hi&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">person2.<span class="title function_">sayHi</span>() <span class="comment">//&quot;Hi&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="对象扩展运算符"><a href="#对象扩展运算符" class="headerlink" title="对象扩展运算符"></a>对象扩展运算符</h4><p>拓展运算符（…）用于取出参数对象所有可遍历属性然后拷贝到当前对象</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、拷贝对象</span></span><br><span class="line"><span class="keyword">let</span> person1 = &#123;<span class="attr">name</span>: <span class="string">&quot;Amy&quot;</span>, <span class="attr">age</span>: <span class="number">15</span>&#125;</span><br><span class="line"><span class="keyword">let</span> person2 = &#123; ...person1 &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person2) <span class="comment">//&#123;name: &quot;Amy&quot;, age: 15&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2、合并对象</span></span><br><span class="line"><span class="keyword">let</span> age = &#123;<span class="attr">age</span>: <span class="number">15</span>&#125;</span><br><span class="line"><span class="keyword">let</span> name = &#123;<span class="attr">name</span>: <span class="string">&quot;Amy&quot;</span>&#125;</span><br><span class="line"><span class="keyword">let</span> person2 = &#123;...age, ...name&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person2) <span class="comment">//&#123;age: 15, name: &quot;Amy&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h4><p>箭头函数提供了一种更加简洁的函数书写方式。基本语法是：</p>
<p>参数 &#x3D;&gt; 函数体</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 传统</span></span><br><span class="line"><span class="keyword">var</span> f1 = <span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line"> 	<span class="keyword">return</span> a </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f1</span>(<span class="number">1</span>))</span><br><span class="line"><span class="comment">//这二者是等价的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">f2</span> = a =&gt; a</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f2</span>(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 当箭头函数没有参数或者有多个参数，要用 () 括起来。</span></span><br><span class="line"><span class="comment">// 当箭头函数函数体有多行语句，用 &#123;&#125; 包裹起来，表示代码块，</span></span><br><span class="line"><span class="comment">// 当只有一行语句，并且需要返回结果时，可以省略 &#123;&#125; , 结果会自动返回。</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">f3</span> = (<span class="params">a,b</span>) =&gt; &#123;</span><br><span class="line"> <span class="keyword">let</span> result = a+b</span><br><span class="line"> <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f3</span>(<span class="number">6</span>,<span class="number">2</span>)) <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 前面代码相当于：</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">f4</span> = (<span class="params">a,b</span>) =&gt; a+b</span><br></pre></td></tr></table></figure>

<p>箭头函数多用于匿名函数的定义</p>
<h2 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h2><p><a target="_blank" rel="noopener" href="https://xiaobaicai350.github.io/2022/08/29/Vue/">Vue | 是小白菜哦 (xiaobaicai350.github.io)</a></p>
<h2 id="Element-UI"><a href="#Element-UI" class="headerlink" title="Element-UI"></a>Element-UI</h2><p>element-ui 是饿了么前端出品的基于 Vue.js的 后台组件库，方便程序员进行页面快速布局和构建</p>
<p>官网： <a target="_blank" rel="noopener" href="https://element-cn.eleme.io/#/zh-CN">https://element-cn.eleme.io/#/zh-CN</a></p>
<p>下次直接用这里面的组件开发程序</p>
<p><a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/layout">组件 | Element</a></p>
<h2 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h2><p>(1)之前学过java，运行java需要安装jdk环境</p>
<p>学习的这个nodejs，<strong>是JavaScript的运行环境</strong>，用于执行JavaScript代码环境不需要浏览器,直接使用nodejs运行JavaScript代码</p>
<p>(2)模拟服务器效果,比如tomcat</p>
<h3 id="模拟服务器效果"><a href="#模拟服务器效果" class="headerlink" title="模拟服务器效果"></a>模拟服务器效果</h3><p>直接拿来用就行，不需要自己写，知道有这个就行</p>
<p>创建demo02.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">request, response</span>) &#123;</span><br><span class="line"> <span class="comment">// 发送 HTTP 头部</span></span><br><span class="line"> <span class="comment">// HTTP 状态值: 200 : OK</span></span><br><span class="line"> <span class="comment">// 内容类型: text/plain</span></span><br><span class="line"> response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br><span class="line"> <span class="comment">// 发送响应数据 &quot;Hello World&quot;</span></span><br><span class="line"> response.<span class="title function_">end</span>(<span class="string">&#x27;Hello Server&#x27;</span>);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8888</span>);</span><br><span class="line"><span class="comment">// 终端打印如下信息</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server running at http://127.0.0.1:8888/&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/../pic/image-20221002220201684.png" alt="image-20221002220201684"></p>
<p>访问<a target="_blank" rel="noopener" href="http://127.0.0.1:8888/">http://127.0.0.1:8888/</a></p>
<p><img src="/../pic/image-20221002220240065.png" alt="image-20221002220240065"></p>
<h3 id="在vscode使用nodejs"><a href="#在vscode使用nodejs" class="headerlink" title="在vscode使用nodejs"></a>在vscode使用nodejs</h3><p>在vscode工具中打开cmd窗口，进行js代码执行</p>
<p><img src="/../pic/image-20221002220654159.png" alt="image-20221002220654159"></p>
<p>之后在终端中写代码</p>
<img src="../pic/image-20221002220755237.png" alt="image-20221002220755237" style="zoom: 67%;" />

<h4 id="安装NPM"><a href="#安装NPM" class="headerlink" title="安装NPM"></a>安装NPM</h4><p>NPM全称Node Package Manager，是Node.js包管理工具，是全球最大的模块生态系统，里面所有的模块都是开源免费的；也是Node.js的包管理工具，相当于**前端的Maven **</p>
<p>安装Node.js的时候自动就安装好了npm，下面是我的npm的地址</p>
<p><img src="/../pic/image-20221002221553050.png" alt="image-20221002221553050"></p>
<h4 id="npm项目初始化操作"><a href="#npm项目初始化操作" class="headerlink" title="npm项目初始化操作"></a>npm项目初始化操作</h4><p><img src="/../pic/image-20221003094521226.png" alt="image-20221003094521226"></p>
<p>使用命令<code>npm init</code></p>
<p>之后一路回车，使用默认的就行。最后点击yes，会生成一个名叫<code>package.json</code>的文件,这个文件类似于maven的<code>pom.xml</code>文件</p>
<h4 id="npm下载js依赖"><a href="#npm下载js依赖" class="headerlink" title="npm下载js依赖"></a>npm下载js依赖</h4><p>命令<code>npm install 依赖名称</code> </p>
<p><img src="/../pic/image-20221003095242188.png" alt="image-20221003095242188"></p>
<p><code>package-lock.json</code>文件是锁定依赖的版本，只能用这个版本的依赖</p>
<p><strong>根据json文件下载依赖</strong></p>
<p>只需要下面这个</p>
<p><img src="/../pic/image-20221003095903602.png" alt="image-20221003095903602"></p>
<p>在这个项目中（这里面就是npmdemo）的命令行中，再输入命令<code>npm install</code>,之后就会下载成功</p>
<h2 id="babel转码器"><a href="#babel转码器" class="headerlink" title="babel转码器"></a>babel转码器</h2><p>babel可以把<strong>es6</strong>的代码转换成<strong>es5</strong>的代码</p>
<p>因为写的代码es6代码,但是es6代码浏览器兼容性很差，如果使用es5代码浏览器兼容性很好</p>
<p>编写es6代码,把es6代码转换es5运行</p>
<h3 id="安装babel"><a href="#安装babel" class="headerlink" title="安装babel"></a>安装babel</h3><p>初始化项目</p>
<p><code> npm init -y</code></p>
<p>安装babel</p>
<p><code>npm install --global babel-cli</code></p>
<p>正常安装后</p>
<p>可以查看babel的版本</p>
<p><code>babel --version</code></p>
<p>如果没有正常安装</p>
<p>可以<strong>强制覆盖</strong>安装</p>
<p><code>npm install --force --global babel-cli</code></p>
<p>查看版本可能会爆红</p>
<p><img src="/../pic/image-20221003101622689.png" alt="image-20221003101622689"></p>
<p>查不了版本号，以<strong>管理员</strong>身份重启vscode，终端输入<code>set-ExecutionPolicy RemoteSigned</code>就OK了</p>
<p><img src="/../pic/image-20221003101652079.png" alt="image-20221003101652079"></p>
<h3 id="创建js文件-编写es6代码"><a href="#创建js文件-编写es6代码" class="headerlink" title="创建js文件,编写es6代码"></a>创建js文件,编写es6代码</h3><ol>
<li><p>在es6文件夹下创建js文件</p>
<p><img src="/../pic/image-20221003102849059.png" alt="image-20221003102849059"></p>
</li>
<li><p>配置<code>.babelrc</code>文件(这里面是es6转es5的配置文件)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;es2015&quot;</span>],</span><br><span class="line">    <span class="string">&quot;plugins&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装转换es5的插件<code>npm install --save-dev babel-preset-es2015</code></p>
</li>
<li><p>有两种转换方式，一种是根据文件名单个转换，另一种是根据文件夹把文件夹里面的es6文件全部转换为es5</p>
<p>(1)<code>babel es6/01.js -o dist/001.js </code></p>
<p><img src="/../pic/image-20221003103309498.png" alt="image-20221003103309498"></p>
<p>(2)<code>babel es6 -d dist</code></p>
<p><img src="/../pic/image-20221003103414808.png" alt="image-20221003103414808"></p>
</li>
</ol>
<h2 id="模块化操作"><a href="#模块化操作" class="headerlink" title="模块化操作"></a>模块化操作</h2><h3 id="es5模块化操作"><a href="#es5模块化操作" class="headerlink" title="es5模块化操作"></a>es5模块化操作</h3><p>目录结构</p>
<p><img src="/../pic/image-20221003121811379.png" alt="image-20221003121811379"></p>
<p><code>01.js</code>中的代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建js方法</span></span><br><span class="line"><span class="keyword">const</span> sum=<span class="keyword">function</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">parseInt</span>(a)+<span class="built_in">parseInt</span>(b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> sub=<span class="keyword">function</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">parseInt</span>(a)-<span class="built_in">parseInt</span>(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置哪些方法可以被其他js调用</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    sum,</span><br><span class="line">    sub</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>02.js</code>中的代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//调用01.js里面的方法</span></span><br><span class="line"><span class="comment">//引入01.js文件</span></span><br><span class="line"><span class="keyword">const</span> m=<span class="built_in">require</span>(<span class="string">&#x27;./01.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m.<span class="title function_">sum</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m.<span class="title function_">sub</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<p>输出结果</p>
<p><img src="/../pic/image-20221003121859079.png" alt="image-20221003121859079"></p>
<h3 id="es6模块化操作"><a href="#es6模块化操作" class="headerlink" title="es6模块化操作"></a>es6模块化操作</h3><p>注意:如果使用es6写法实现模块化操作，在nodejs环境中不能直接运行的，需要使用babel把es6代码转换es5代码,才可以在nodejs进行运行</p>
<p>基本结构</p>
<p><img src="/../pic/image-20221003124551794.png" alt="image-20221003124551794"></p>
<p>es5的代码是根据es6生成的</p>
<h4 id="第一种写法"><a href="#第一种写法" class="headerlink" title="第一种写法"></a>第一种写法</h4><p>es6的01.js的代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义方法，并设置哪些方法可以被其他js调用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">   <span class="keyword">return</span> a+b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sub</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">   <span class="keyword">return</span> a-b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>02.js代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//引入01.js文件</span></span><br><span class="line"><span class="keyword">import</span> &#123;sum,sub&#125; <span class="keyword">from</span> <span class="string">&quot;./01.js&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sub</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<p>之后转成es5的代码才能运行</p>
<h4 id="第二种写法"><a href="#第二种写法" class="headerlink" title="第二种写法"></a>第二种写法</h4><p>01.js的代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">sum</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">sub</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> a - b</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>02.js的代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> m <span class="keyword">from</span> <span class="string">&quot;./01.js&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m.<span class="title function_">sum</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m.<span class="title function_">sub</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>第二种写法是对第一种写法的进一步简化</p>
<p>我们后面用的最多的当然是用的最简化的写法啦</p>
</blockquote>
<h2 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h2><p>Webpack 是一个前端资源加载&#x2F;打包工具。它将根据模块的依赖关系进行静态分析，然后将这些模块按</p>
<p>照指定的规则生成对应的静态资源。</p>
<p>&#x3D;&#x3D;Webpack 可以将<strong>多种静态资源 js、css、less 转换成一个静态文件</strong>，减少了页面的请求&#x3D;&#x3D;</p>
<h3 id="安装Webpack"><a href="#安装Webpack" class="headerlink" title="安装Webpack"></a>安装Webpack</h3><p><code>npm install -g webpack webpack-cli</code></p>
<p>查看版本</p>
<p><code>webpack -v</code></p>
<h3 id="使用Webpack打包js"><a href="#使用Webpack打包js" class="headerlink" title="使用Webpack打包js"></a>使用Webpack打包js</h3><p>一个小demo</p>
<p><strong>基本结构</strong></p>
<p><img src="/../pic/image-20221003131849304.png" alt="image-20221003131849304"></p>
<p>记得要先<code>npm init -y</code> 哦</p>
<p>分别创建这个目录结构和文件</p>
<p><strong>src下面的代码</strong></p>
<ol>
<li><p>common.js</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exports.info = function (str) &#123;</span><br><span class="line">    document.write(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>utils.js</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exports.add = function (a, b) &#123;</span><br><span class="line">    return a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>main.js</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const common = require(&#x27;./common&#x27;);</span><br><span class="line">const utils = require(&#x27;./utils&#x27;);</span><br><span class="line">common.info(&#x27;Hello world!&#x27; + utils.add(100, 200));</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>创建webpack的配置类</strong></p>
<p>文件名为<code>webpack.config.js</code>(里面可以修改参数)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>); <span class="comment">//Node.js内置模块（不可改）</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>, <span class="comment">//配置入口文件（可改）</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./输出&#x27;</span>), <span class="comment">//输出路径，__dirname：当前文件所在路径（可改）</span></span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;haohao的webpack输出.js&#x27;</span> <span class="comment">//输出文件（可改）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在根目录下使用<code>webpack</code>指令</p>
<p><img src="/../pic/image-20221003132459057.png" alt="image-20221003132459057"></p>
<p><strong>得到结果</strong></p>
<p><img src="/../pic/image-20221003132359507.png" alt="image-20221003132359507"></p>
<p><strong>测试</strong></p>
<p><img src="/../pic/image-20221003134049683.png" alt="image-20221003134049683"></p>
<p>之后启动index.html就可以看到效果了</p>
<h3 id="使用Webpack打包css"><a href="#使用Webpack打包css" class="headerlink" title="使用Webpack打包css"></a>使用Webpack打包css</h3><p>Webpack 本身只能处理 JavaScript 模块，如果要处理其他类型的文件，就需要使用 loader 进行转换。</p>
<p>Loader 可以理解为是模块和资源的转换器。</p>
<p>首先我们需要安装相关Loader插件，css-loader 是将 css 装载到 javascript；style-loader 是让 javascript认识css</p>
<p><code>npm install --save-dev style-loader css-loader</code></p>
<p><strong>修改webpack.config.js</strong></p>
<p><img src="/../pic/image-20221003133812535.png" alt="image-20221003133812535"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>); <span class="comment">//Node.js内置模块（不可改）</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>, <span class="comment">//配置入口文件（可改）</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./输出&#x27;</span>), <span class="comment">//输出路径，__dirname：当前文件所在路径（可改）</span></span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;haohao的webpack输出.js&#x27;</span> <span class="comment">//输出文件（可改）</span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="comment">//打包规则应用到以css结尾的文件上</span></span><br><span class="line">                <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在src文件夹创建style.css</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line"> <span class="attribute">background</span>:pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>修改main.js</strong></p>
<p>在第一行引入style.css</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./style.css&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>重新打包</strong></p>
<p>之后再查看index.html</p>
<h2 id="使用模板启动项目"><a href="#使用模板启动项目" class="headerlink" title="使用模板启动项目"></a>使用模板启动项目</h2><p><code>npm run dev</code></p>
<h3 id="项目的创建和基本配置"><a href="#项目的创建和基本配置" class="headerlink" title="项目的创建和基本配置"></a><strong>项目的创建和基本配置</strong></h3><h4 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h4><p>将vue-admin-template-master重命名为guli-admin</p>
<h4 id="修改项目信息"><a href="#修改项目信息" class="headerlink" title="修改项目信息"></a>修改项目信息</h4><p>package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;guli-admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ......</span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;谷粒学院后台管理系统&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Helen &lt;55317332@qq.com&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ......</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="项目的目录结构"><a href="#项目的目录结构" class="headerlink" title="项目的目录结构"></a>项目的目录结构</h4><blockquote>
<p>├── build &#x2F;&#x2F; 构建脚本</p>
<p>├── config &#x2F;&#x2F; 全局配置</p>
<p>├── node_modules &#x2F;&#x2F; 项目依赖模块</p>
<p>├── src &#x2F;&#x2F;项目源代码</p>
<p>├── static &#x2F;&#x2F; 静态资源</p>
<p>└── package.jspon &#x2F;&#x2F; 项目信息和依赖配置</p>
</blockquote>
<p>src的目录结构</p>
<blockquote>
<p>src</p>
<p>├── api &#x2F;&#x2F; 各种接口</p>
<p>├── assets &#x2F;&#x2F; 图片等资源</p>
<p>├── components &#x2F;&#x2F; 各种公共组件，非公共组件在各自view下维护</p>
<p>├── icons &#x2F;&#x2F;svg icon</p>
<p>├── router &#x2F;&#x2F; 路由表</p>
<p>├── store &#x2F;&#x2F; 存储</p>
<p>├── styles &#x2F;&#x2F; 各种样式</p>
<p>├── utils &#x2F;&#x2F; 公共工具，非公共工具，在各自view下维护</p>
<p>├── views &#x2F;&#x2F; 各种layout</p>
<p>├── App.vue &#x2F;&#x2F;<em><strong>项目顶层组件</strong></em></p>
<p>├── main.js &#x2F;&#x2F;<em><strong>项目入口文件</strong></em></p>
<p>└── permission.js &#x2F;&#x2F;认证入口</p>
</blockquote>
<h4 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h4><p><code>npm run dev</code></p>
<h3 id="我太开心了"><a href="#我太开心了" class="headerlink" title="我太开心了"></a>我太开心了</h3><p>因为下modules包下了一下午都下不下来，出现了各种各样的错误，期间成功了一次，但是之后再启动又失败了，现在找到了问题所在</p>
<p><img src="/../pic/image-20221004100143996.png" alt="image-20221004100143996"></p>
<p>这两个版本得一致，并且下载的时候不要开代理！！！如果你正在开，先关掉，再执行下面两条指令</p>
<blockquote>
<p>重置代理</p>
</blockquote>
<p><code>npm config set proxy null</code></p>
<blockquote>
<p>清除缓存</p>
</blockquote>
<p><code>npm cache clean --force</code></p>
<p>之后再下载，就ok啦</p>
<p><code>npm install</code></p>
<p>当我看见这个，内心无比激动</p>
<p><img src="/../pic/image-20221003163223624.png" alt="image-20221003163223624"></p>
<p>看到这个我更激动了</p>
<p><img src="/../pic/image-20221003163300487.png" alt="image-20221003163300487"></p>
<p>对接上了后端，我要哭出来了</p>
<p><img src="/../pic/image-20221003163327272.png" alt="image-20221003163327272"></p>
<h3 id="项目中需要注意的点"><a href="#项目中需要注意的点" class="headerlink" title="项目中需要注意的点"></a>项目中需要注意的点</h3><p>项目中不认识.&#x2F;</p>
<p>只认识@&#x2F;</p>
<p>@&#x2F;表示的含义是从src目录</p>
<p>多次路由跳转到同一页面时，created 方法只会被执行一次</p>
<p><img src="/../pic/image-20221004171231367.png" alt="image-20221004171231367"></p>
<p><img src="/../pic/image-20221004193454561.png" alt="image-20221004193454561"></p>
<p>项目中报403错误，错误原因可能是</p>
<blockquote>
<p>1.跨域问题</p>
<p>2.路径写错了</p>
</blockquote>
<p><img src="/../pic/image-20221017151846079.png" alt="image-20221017151846079"></p>
<h2 id="前端页面"><a href="#前端页面" class="headerlink" title="前端页面"></a>前端页面</h2><h3 id="讲师列表前端实现"><a href="#讲师列表前端实现" class="headerlink" title="讲师列表前端实现"></a>讲师列表前端实现</h3><p><img src="/../pic/image-20221003171037202.png" alt="image-20221003171037202"></p>
<p><img src="/../pic/image-20221003183303640.png" alt="image-20221003183303640"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">label-width</span>=<span class="string">&quot;120px&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;讲师名称&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;teacher.name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span> <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;讲师排序&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">el-input-number</span> <span class="attr">v-model</span>=<span class="string">&quot;teacher.sort&quot;</span> <span class="attr">controls-position</span>=<span class="string">&quot;right&quot;</span></span></span><br><span class="line"><span class="tag">                                                                 <span class="attr">min</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span> <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;讲师头衔&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;teacher.level&quot;</span> <span class="attr">clearable</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">数据类型一定要和取出的json中的一致，否则没法回填</span></span><br><span class="line"><span class="comment">因此，这里value使用动态绑定的值，保证其数据类型是number</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">:value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">label</span>=<span class="string">&quot;高级讲师&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">:value</span>=<span class="string">&quot;2&quot;</span> <span class="attr">label</span>=<span class="string">&quot;首席讲师&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;讲师资历&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;teacher.career&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span> <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;讲师简介&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;teacher.intro&quot;</span> <span class="attr">:rows</span>=<span class="string">&quot;10&quot;</span> <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 讲师头像：TODO --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span> <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">:disabled</span>=<span class="string">&quot;saveBtnDisabled&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">                              @<span class="attr">click</span>=<span class="string">&quot;saveOrUpdate&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        &lt;/el-form</span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span> &gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">from matplotlib.pyplot import*x=np. linspace(0,2*np.pi,200)</span><br><span class="line">y1=np.sin(x);y2=np.cos(pow(x,2))rc( &#x27;font&#x27; ,size=16);</span><br><span class="line">plot(x,y1,&#x27;r &#x27;,label= &#x27; $sin(x)$ &#x27; ,linewidth=2)plot(x,y2,&#x27;b--&#x27;,label=&#x27;$cos(x^2)$ &#x27;)</span><br><span class="line">xlabel( &#x27;$x$ &#x27; );ylabel( &#x27;$y$ &#x27; ,rotation=0)</span><br><span class="line">savefig( &#x27;figure2_38.png &#x27; ,dpi=500);legend().show()</span><br></pre></td></tr></table></figure>

<h2 id="EasyExcel"><a href="#EasyExcel" class="headerlink" title="EasyExcel"></a>EasyExcel</h2><h3 id="使用EasyExcel进行写操作"><a href="#使用EasyExcel进行写操作" class="headerlink" title="使用EasyExcel进行写操作"></a>使用EasyExcel进行写操作</h3><ol>
<li>引入依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/easyexcel --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>还需要这个依赖<img src="/../pic/image-20221004215642043.png" alt="image-20221004215642043"></p>
<ol start="2">
<li>创建实体类，找到表头</li>
</ol>
<p><img src="/../pic/image-20221004220719376.png" alt="image-20221004220719376"></p>
<ol start="3">
<li><p>开始写入（getData方法是得到一个list表）</p>
<p><img src="/../pic/image-20221004221137765.png" alt="image-20221004221137765"></p>
</li>
</ol>
<h3 id="使用EasyExcel进行读操作"><a href="#使用EasyExcel进行读操作" class="headerlink" title="使用EasyExcel进行读操作"></a>使用EasyExcel进行读操作</h3><ol>
<li>创建实体类</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadData</span> &#123;</span><br><span class="line">    <span class="comment">//设置列对应的属性</span></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 0)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> sid;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置列对应的属性</span></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 1)</span></span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>创建读取操作的监听器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建读取excel监听器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelListener</span> <span class="keyword">extends</span> <span class="title class_">AnalysisEventListener</span>&lt;ReadData&gt; &#123;</span><br><span class="line">    <span class="comment">//创建list集合用来封装最终的数据</span></span><br><span class="line">    List&lt;ReadData&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;ReadData&gt;();</span><br><span class="line">    <span class="comment">//一行一行去读取excle内容</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(ReadData user, AnalysisContext analysisContext)</span> &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        list.add(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//读取excel表头信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invokeHeadMap</span><span class="params">(Map&lt;Integer, String&gt; headMap, AnalysisContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;表头信息：&quot;</span>+headMap);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//读取完成后执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>调用实现最终的读取</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 写法1：</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;F:\\01.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// 这里 需要指定读用哪个class（规定格式）去读，然后读取第一个sheet</span></span><br><span class="line">    <span class="comment">//文件流会自动关闭</span></span><br><span class="line">    EasyExcel.read(fileName, ReadData.class, <span class="keyword">new</span> <span class="title class_">ExcelListener</span>()).sheet().doRead();</span><br></pre></td></tr></table></figure>

<h1 id="Day9"><a href="#Day9" class="headerlink" title="Day9"></a>Day9</h1><h2 id="课程最终发布实现"><a href="#课程最终发布实现" class="headerlink" title="课程最终发布实现"></a>课程最终发布实现</h2><p>昨天出现了一点小问题</p>
<p>问题的原因是因为Maven的默认加载机制：只会把src-main-java文件夹中的<code>java</code>类型文件进行加载，<code>其他类型</code>文件不会加载。(昨天我们在mapper的xml文件中写了sql语句，没有进行加载)</p>
<p><img src="/../pic/image-20221008093214384.png" alt="image-20221008093214384"></p>
<p><strong>解决方式</strong></p>
<ol>
<li><p>把<img src="/../pic/image-20221008093358456.png" alt="image-20221008093358456">这个文件夹复制到target目录下的mapper文件夹下</p>
</li>
<li><p>通过配置文件进行配置，让maven默认加载xml文件</p>
<ol>
<li><p>在guli_edu的pom中配置如下节点</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 项目打包时会将java目录中的*.xml文件也进行打包,需要注意的是，这个build标签是写在dependences标签后面的 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在Spring Boot配置文件中添加配置</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置mapper xml文件的路径，注意修改成自己的xml目录，classpath可以在target目录下看到</span></span><br><span class="line"><span class="attr">mybatis-plus.mapper-locations</span>=<span class="string">classpath:com/guli/edu/mapper/xml/*.xml</span></span><br></pre></td></tr></table></figure>

<p><img src="/../pic/image-20221008094442485.png" alt="image-20221008094442485"></p>
</li>
</ol>
</li>
</ol>
<h3 id="课程信息确认"><a href="#课程信息确认" class="headerlink" title="课程信息确认"></a>课程信息确认</h3><p>这是那个三步走的最后一个阶段，查询出来最终的信息，并作显示，现在写前端的页面</p>
<ol>
<li><p>写前端api调用发请求的部分</p>
<p><img src="/../pic/image-20221008144526075.png" alt="image-20221008144526075"></p>
</li>
<li><p>导入这个api的js文件</p>
<p><img src="/../pic/image-20221008144720366.png" alt="image-20221008144720366"></p>
</li>
<li><p>之后再data里面加入courseId并且在create方法里面给他赋值<img src="/../pic/image-20221008145125065.png" alt="image-20221008145125065"></p>
</li>
<li><p>定义方法并且在created方法中调用<img src="/../pic/image-20221008150021542.png" alt="image-20221008150021542"></p>
</li>
<li><p>数据回显，利用组件进行解析结果（elementUI）</p>
</li>
</ol>
<h3 id="课程发布"><a href="#课程发布" class="headerlink" title="课程发布"></a>课程发布</h3><p>课程的最终发布</p>
<p><img src="/../pic/image-20221008150207949.png" alt="image-20221008150207949"></p>
<p>这个业务主要是修改的这个字段<img src="/../pic/image-20221008150335764.png" alt="image-20221008150335764"></p>
<p>将Draft(默认)改成Normal</p>
<ol>
<li><p>编写后端代码<img src="/../pic/image-20221008151449506.png" alt="image-20221008151449506"></p>
</li>
<li><p>编写前端代码</p>
<p>编写api的js文件</p>
<p><img src="/../pic/image-20221008151752369.png" alt="image-20221008151752369"></p>
<p>之后调用这个方法并进行跳转<img src="/../pic/image-20221008153911233.png" alt="image-20221008153911233"></p>
</li>
</ol>
<h2 id="课程列表"><a href="#课程列表" class="headerlink" title="课程列表"></a>课程列表</h2><h3 id="课程列表显示"><a href="#课程列表显示" class="headerlink" title="课程列表显示"></a>课程列表显示</h3><h3 id="课程删除"><a href="#课程删除" class="headerlink" title="课程删除"></a>课程删除</h3><p>编写后端代码。</p>
<p>因为要把课程里面的视频，小节，章节，描述，课程本身都删除，所以我们把删除的方法都封装到removeCourse方法中（但是我觉得可以用更好的方法，用外键的级联删除和级联更新就可以实现 具体可以看<a target="_blank" rel="noopener" href="https://blog.csdn.net/guanyibei/article/details/82528048">Mysql实现级联操作（级联更新、级联删除）_元宝321的博客-CSDN博客_mysql设置级联删除</a>）</p>
<p><img src="/../pic/image-20221008160158808.png" alt="image-20221008160158808"></p>
<p>之后就是在后端中，根据课程id进行删除视频..小结….之类的</p>
<h2 id="阿里云视频点播服务"><a href="#阿里云视频点播服务" class="headerlink" title="阿里云视频点播服务"></a>阿里云视频点播服务</h2><blockquote>
<p>服务端：后端接口</p>
<p>客户端：浏览器、安卓、ios</p>
</blockquote>
<p>API:阿里云提供固定的地址，只需要调用这个固定的地址，向地址传递参数，就可以实现这个功能</p>
<p>SDK:SDK对API进行封装，更方便使用，比如之前使用的EasyExcel，可以调用阿里云提供的类和接口里面的方法进行实现相应的功能</p>
<h2 id="添加小节实现视频上传"><a href="#添加小节实现视频上传" class="headerlink" title="添加小节实现视频上传"></a>添加小节实现视频上传</h2><h1 id="Day12"><a href="#Day12" class="headerlink" title="Day12"></a>Day12</h1><h2 id="登录实现流程"><a href="#登录实现流程" class="headerlink" title="登录实现流程"></a>登录实现流程</h2><h3 id="SSO模式"><a href="#SSO模式" class="headerlink" title="SSO模式"></a>SSO模式</h3><p>single sign on</p>
<p><strong>单点登录</strong></p>
<p>在任何一个模块登录之后其他模块都可以登录上去，不需要二次登录，这就是单点登录</p>
<h4 id="常见的三种单点登录"><a href="#常见的三种单点登录" class="headerlink" title="常见的三种单点登录"></a>常见的三种单点登录</h4><p>第一种：</p>
<p><strong>session广播机制实现</strong></p>
<p>基于session复制，但是现在已经不怎么使用这种方式，这种方式主要是用单台主机实现，现在都是分布式集群了</p>
<p>第二种：</p>
<p><strong>使用cookie+redis实现</strong></p>
<p>在项目中任何一个模块进行登录，登录之后，把数据放到两个地方</p>
<ol>
<li>redis：在key中，生成唯一随机值，在value中存储用户数据</li>
<li>cookie：把redis里面生成的key值放到cookie里面</li>
</ol>
<p>当用户访问项目中的其他模块，发送请求会携带着cookie进行发送，当发送请求到服务器，会把cookie值到redis中进行查询，如果找到了对应的cookie值&#x3D;&#x3D;redis中的key值，说明就是该用户</p>
<p>第三种：</p>
<p><strong>使用token实现</strong></p>
<p>token是<em>按照一定规则生成的字符串</em>（字符串中包含用户信息）</p>
<p>token还有一种叫法叫<code>令牌</code>，全称叫<code>自包含令牌</code></p>
<p>具体步骤：</p>
<ol>
<li>在项目中某个模块进行登录，登录之后，会按照规则生成字符串，把信息都存储到字符串中并编码加密,之后服务端把字符串返回</li>
</ol>
<blockquote>
<p>通过cookie把字符串返回</p>
<p>通过url中地址栏中的数据返回</p>
</blockquote>
<ol start="2">
<li>客户端每次访问项目中的其他模块，每次在地址栏中带着字符串，如果服务端获取到字符串（解析过后），就算登录成功了</li>
</ol>
<h4 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h4><p>之前提到过token是按照一定规则生成的字符串，但是这个规则是怎么样的，是不确定的（可以自己写，也可以用别人规定的规则，JWT显然是后者）</p>
<p>JWT就是<strong>官方给我们的一种规则</strong></p>
<p>JWT由三部分组成：</p>
<p><img src="/../pic/image-20221011164459836.png" alt="image-20221011164459836"></p>
<p>第一部分：JWT头信息</p>
<p>第二部分：有效载荷，包含了主体信息（用户信息）</p>
<p>第三部分：签名哈希（也就是防伪标志，知道这个token不是伪造的）</p>
<h4 id="整合JWT"><a href="#整合JWT" class="headerlink" title="整合JWT"></a>整合JWT</h4><p>加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- JWT--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建工具类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.commonutils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jws;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> helen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019/10/16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">EXPIRE</span> <span class="operator">=</span> <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">APP_SECRET</span> <span class="operator">=</span> <span class="string">&quot;ukc8BDbRigUDaY6pZFfWus2jZWLPHO&quot;</span>;<span class="comment">//密钥，做加密使用的，每个公司由自己的规则生成</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//生成token字符串的方法（这里传了两个参数，可以更改参数的类型和数量）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getJwtToken</span><span class="params">(String id, String nickname)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">JwtToken</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>)</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;HS256&quot;</span>)<span class="comment">//头，不用改</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                .setSubject(<span class="string">&quot;guli-user&quot;</span>)<span class="comment">//设置token分类</span></span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>())<span class="comment">//设置过期时间</span></span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + EXPIRE))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                .claim(<span class="string">&quot;id&quot;</span>, id)<span class="comment">//设置token的主体部分（用户信息）</span></span><br><span class="line">                .claim(<span class="string">&quot;nickname&quot;</span>, nickname)</span><br><span class="line"></span><br><span class="line">                <span class="comment">//根据密钥生成hash</span></span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, APP_SECRET)</span><br><span class="line">                .compact();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断token是否存在与有效</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwtToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkToken</span><span class="params">(String jwtToken)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断token是否存在与有效</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkToken</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getMemberIdByJwtToken</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> claimsJws.getBody();</span><br><span class="line">        <span class="keyword">return</span> (String)claims.get(<span class="string">&quot;id&quot;</span>);<span class="comment">//根据id取到值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="整合阿里云短信微服务"><a href="#整合阿里云短信微服务" class="headerlink" title="整合阿里云短信微服务"></a>整合阿里云短信微服务</h3><p>发送验证码并设置超时时间</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;send/&#123;phone&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">sendMsm</span><span class="params">(<span class="meta">@PathVariable</span> String phone)</span>&#123;</span><br><span class="line">        <span class="comment">//从redis中获取验证码，如果获得到直接返回</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> (String) redisTemplate.opsForValue().get(phone);</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(code))&#123;</span><br><span class="line">            <span class="keyword">return</span> R.ok();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果从redis中获取不到，通过阿里云进行发送验证码</span></span><br><span class="line">        code =RandomUtils.getFourBitRandom();</span><br><span class="line">        HashMap&lt;String, Object&gt; param = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        param.put(<span class="string">&quot;code&quot;</span>,code);</span><br><span class="line">        <span class="comment">//发送验证码</span></span><br><span class="line">        <span class="type">boolean</span> isSend=msmService.send(param,phone);</span><br><span class="line">        <span class="keyword">if</span>(isSend)&#123;</span><br><span class="line">            redisTemplate.opsForValue().set(phone,code,<span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> R.ok();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="登录接口和注册接口"><a href="#登录接口和注册接口" class="headerlink" title="登录接口和注册接口"></a>登录接口和注册接口</h2><h3 id="编写实体类"><a href="#编写实体类" class="headerlink" title="编写实体类"></a>编写实体类</h3><p><strong>LoginVo</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(value=&quot;登录对象&quot;, description=&quot;登录对象&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginVo</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;手机号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;密码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>RegisterVo</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(value=&quot;注册对象&quot;, description=&quot;注册对象&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterVo</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;昵称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;手机号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;密码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;验证码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建controller编写登录和注册方法"><a href="#创建controller编写登录和注册方法" class="headerlink" title="创建controller编写登录和注册方法"></a>创建controller编写登录和注册方法</h3><p><code>MemberApiController.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/ucenterservice/apimember&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberApiController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;登录&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginVo loginVo)</span> &#123;</span><br><span class="line">        <span class="comment">//调用service得到token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> memberService.login(loginVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;注册&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">register</span><span class="params">(<span class="meta">@RequestBody</span> RegisterVo registerVo)</span>&#123;</span><br><span class="line">        <span class="comment">//调用service实现注册</span></span><br><span class="line">        memberService.register(registerVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建service接口和实现类"><a href="#创建service接口和实现类" class="headerlink" title="创建service接口和实现类"></a>创建service接口和实现类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;MemberMapper, Member&gt; <span class="keyword">implements</span> <span class="title class_">MemberService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 登录</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(LoginVo loginVo)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">mobile</span> <span class="operator">=</span> loginVo.getMobile();</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> loginVo.getPassword();</span><br><span class="line">        <span class="comment">//校验参数</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(mobile) ||</span><br><span class="line">           StringUtils.isEmpty(password) ||</span><br><span class="line">           StringUtils.isEmpty(mobile)) &#123;<span class="comment">//如果有一个为空，说明出错了！！</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取改对象</span></span><br><span class="line">        <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> baseMapper.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Member&gt;().eq(<span class="string">&quot;mobile&quot;</span>, mobile));</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> == member) &#123;<span class="comment">//如果找不到这个对象，说明还没注册呢</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//校验密码</span></span><br><span class="line">        <span class="keyword">if</span>(!MD5.encrypt(password).equals(member.getPassword())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//校验是否被禁用</span></span><br><span class="line">        <span class="keyword">if</span>(member.getIsDisabled()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//使用JWT生成token字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtils.getJwtToken(member.getId(), member.getNickname());</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 注册</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(RegisterVo registerVo)</span> &#123;</span><br><span class="line">        <span class="comment">//获取注册信息，进行校验</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">nickname</span> <span class="operator">=</span> registerVo.getNickname();</span><br><span class="line">        <span class="type">String</span> <span class="variable">mobile</span> <span class="operator">=</span> registerVo.getMobile();</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> registerVo.getPassword();</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> registerVo.getCode();</span><br><span class="line">        <span class="comment">//校验参数是否为空，为空就出错了</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(mobile) ||</span><br><span class="line">           StringUtils.isEmpty(mobile) ||</span><br><span class="line">           StringUtils.isEmpty(password) ||</span><br><span class="line">           StringUtils.isEmpty(code)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//校验校验验证码</span></span><br><span class="line">        <span class="comment">//从redis获取发送的验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">mobleCode</span> <span class="operator">=</span> redisTemplate.opsForValue().get(mobile);</span><br><span class="line">        <span class="keyword">if</span>(!code.equals(mobleCode)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//查询数据库中是否存在相同的手机号码</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> baseMapper.selectCount(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Member&gt;().eq(<span class="string">&quot;mobile&quot;</span>, mobile));</span><br><span class="line">        <span class="keyword">if</span>(count.intValue() &gt; <span class="number">0</span>) &#123;<span class="comment">//如果大于0，说明数据库中已经有这个用户了，那么他就不需要注册了</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//添加注册信息到数据库</span></span><br><span class="line">        <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Member</span>();</span><br><span class="line">        member.setNickname(nickname);</span><br><span class="line">        member.setMobile(registerVo.getMobile());</span><br><span class="line">        member.setPassword(MD5.encrypt(password));</span><br><span class="line">        member.setIsDisabled(<span class="literal">false</span>);</span><br><span class="line">        member.setAvatar(<span class="string">&quot;&#123;头像&#125;&quot;</span>);<span class="comment">//设置头像</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//保存这个对象到数据库</span></span><br><span class="line">        <span class="built_in">this</span>.save(member);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建接口根据token获取用户信息"><a href="#创建接口根据token获取用户信息" class="headerlink" title="创建接口根据token获取用户信息"></a>创建接口根据token获取用户信息</h3><p>在MemberApiController中创建方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;根据token获取登录信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;auth/getLoginInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">getLoginInfo</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">memberId</span> <span class="operator">=</span> JwtUtils.getMemberIdByJwtToken(request);<span class="comment">//通过发过来的请求（的请求头中）得到token，之后再解析成memeberId</span></span><br><span class="line">        <span class="comment">//通过getById(id)得到登录对象的具体信息</span></span><br><span class="line">        <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> memberService.getById(memberId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;userInfo&quot;</span>,member);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Day13"><a href="#Day13" class="headerlink" title="Day13"></a>Day13</h1><h2 id="登录前端实现"><a href="#登录前端实现" class="headerlink" title="登录前端实现"></a>登录前端实现</h2><p>页面中实现倒计时的方法，可以用js中的定时器方法实现</p>
<p><img src="/../pic/image-20221012025354247.png" alt="image-20221012025354247"></p>
<p>这段代码的意思是每隔3000毫秒弹出一下<code>haohao</code></p>
<p>所以我们可以实现那个发验证码的方法的倒计时效果</p>
<p><img src="/../pic/image-20221012025551923.png" alt="image-20221012025551923"></p>
<p>每隔1000毫秒执行一次这个方法</p>
<h3 id="登录和登录成功之后首页显示数据的实现过程"><a href="#登录和登录成功之后首页显示数据的实现过程" class="headerlink" title="登录和登录成功之后首页显示数据的实现过程"></a><strong>登录和登录成功之后首页显示数据的实现过程</strong></h3><ol>
<li>调用登录接口返回token字符串</li>
<li>把第一步返回的token字符串放到cookie中</li>
<li>创建前端拦截器：判断cookie里面是否有token字符串，如果有，把token字符串放到<strong>请求头</strong>中（因为我们是通过请求头获取token并获取用户id的，当然也可以用cookie，但是我们习惯用请求头）</li>
<li>根据token值，调用接口，根据token获取用户信息，为了首页面右上角的显示，再把调用接口返回的用户信息放到cookie中</li>
<li>从cookie中获取用户信息，在首页面显示</li>
</ol>
<h4 id="在api文件夹中创建登录的js文件，定义接口"><a href="#在api文件夹中创建登录的js文件，定义接口" class="headerlink" title="在api文件夹中创建登录的js文件，定义接口"></a>在api文件夹中创建登录的js文件，定义接口</h4><p><img src="/../pic/image-20221012150903901.png" alt="image-20221012150903901"></p>
<p>login.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//登录</span></span><br><span class="line">    <span class="title function_">submitLogin</span>(<span class="params">userInfo</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/ucenterservice/apimember/login`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: userInfo</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//根据token获取用户信息</span></span><br><span class="line">    <span class="title function_">getLoginInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/ucenterservice/apimember/auth/getLoginInfo`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="在pages文件夹中创建登录页面，调用方法"><a href="#在pages文件夹中创建登录页面，调用方法" class="headerlink" title="在pages文件夹中创建登录页面，调用方法"></a>在pages文件夹中创建登录页面，调用方法</h4><p><img src="/../pic/image-20221012150937608.png" alt="image-20221012150937608"></p>
<p>login.vue</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;main&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">        &lt;a class=&quot;active&quot; href=&quot;/login&quot;&gt;登录&lt;/a&gt;</span><br><span class="line">        &lt;span&gt;·&lt;/span&gt;</span><br><span class="line">        &lt;a href=&quot;/register&quot;&gt;注册&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;sign-up-container&quot;&gt;</span><br><span class="line">        &lt;el-form ref=&quot;userForm&quot; :model=&quot;user&quot;&gt;</span><br><span class="line">            &lt;el-form-item class=&quot;input-prepend restyle&quot; prop=&quot;mobile&quot; :rules=&quot;[&#123;required: true, message: &#x27;请输入手机号码&#x27;, trigger: &#x27;blur&#x27; &#125;,&#123;validator:checkPhone, trigger:&#x27;blur&#x27;&#125;]&quot;&gt;</span><br><span class="line">                &lt;div &gt;</span><br><span class="line">                    &lt;el-input type=&quot;text&quot; placeholder=&quot;手机号&quot; v-model=&quot;user.mobile&quot;/&gt;</span><br><span class="line">                    &lt;i class=&quot;iconfont icon-phone&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item class=&quot;input-prepend&quot; prop=&quot;password&quot; :rules=&quot;[&#123; required:</span><br><span class="line">                                                                        true, message: &#x27;请输入密码&#x27;, trigger: &#x27;blur&#x27; &#125;]&quot;&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;el-input type=&quot;password&quot; placeholder=&quot;密码&quot; v-model=&quot;user.password&quot;/&gt;</span><br><span class="line">                    &lt;i class=&quot;iconfont icon-password&quot;/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">            &lt;div class=&quot;btn&quot;&gt;</span><br><span class="line">                &lt;input type=&quot;button&quot; class=&quot;sign-in-button&quot; value=&quot;登录&quot;</span><br><span class="line">                       @click=&quot;submitLogin()&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">        &lt;!-- 更多登录方式 --&gt;</span><br><span class="line">        &lt;div class=&quot;more-sign&quot;&gt;</span><br><span class="line">            &lt;h6&gt;社交帐号登录&lt;/h6&gt;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">                &lt;li&gt;&lt;a id=&quot;weixin&quot; class=&quot;weixin&quot; target=&quot;_blank&quot;</span><br><span class="line">                       href=&quot;http://qy.free.idcfengye.com/api/ucenter/weixinLogin/login&quot;&gt;&lt;i</span><br><span class="line">                                                                                            class=&quot;iconfont icon-weixin&quot;/&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;a id=&quot;qq&quot; class=&quot;qq&quot; target=&quot;_blank&quot; href=&quot;#&quot;&gt;&lt;i class=&quot;iconfont</span><br><span class="line">                    icon-qq&quot;/&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#x27;~/assets/css/sign.css&#x27;</span><br><span class="line">    import &#x27;~/assets/css/iconfont.css&#x27;</span><br><span class="line">    import cookie from &#x27;js-cookie&#x27;</span><br><span class="line">    import loginApi from &#x27;@/api/login&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        layout: &#x27;sign&#x27;,</span><br><span class="line">        data () &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                user:&#123;</span><br><span class="line">                    mobile:&#x27;&#x27;,</span><br><span class="line">                    password:&#x27;&#x27;</span><br><span class="line">                &#125;,</span><br><span class="line">                loginInfo:&#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            submitLogin()&#123;//点击登录触发的方法</span><br><span class="line">                loginApi.submitLogin(this.user).then(response =&gt; &#123;</span><br><span class="line">                    if(response.data.success)&#123;</span><br><span class="line">                        //第二步：把token存在cookie中、也可以放在localStorage中</span><br><span class="line">                        cookie.set(&#x27;guli_token&#x27;, response.data.data.token, &#123; domain: &#x27;localhost&#x27; &#125;)</span><br><span class="line">                        //第四步：登录成功根据token获取用户信息</span><br><span class="line">                        loginApi.getLoginInfo().then(response =&gt; &#123;</span><br><span class="line">                            this.loginInfo = response.data.data.item</span><br><span class="line">                            //将用户信息记录cookie</span><br><span class="line">                            cookie.set(&#x27;guli_ucenter&#x27;, this.loginInfo, &#123; domain: &#x27;localhost&#x27;&#125;)</span><br><span class="line">                            //跳转页面</span><br><span class="line">                            window.location.href = &quot;/&quot;;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            checkPhone (rule, value, callback) &#123;</span><br><span class="line">                //debugger</span><br><span class="line">                if (!(/^1[34578]\d&#123;9&#125;$/.test(value))) &#123;</span><br><span class="line">                    return callback(new Error(&#x27;手机号码格式不正确&#x27;))</span><br><span class="line">                &#125;</span><br><span class="line">                return callback()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>第三步：在request.js添加拦截器，用于传递token信息</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MessageBox</span>, <span class="title class_">Message</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"><span class="keyword">import</span> cookie <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="comment">//baseURL: &#x27;http://qy.free.idcfengye.com/api&#x27;, // api 的 base_url</span></span><br><span class="line">    <span class="comment">//baseURL: &#x27;http://localhost:8210&#x27;, // api 的 base_url</span></span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&#x27;http://localhost:9001&#x27;</span>,</span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">15000</span> <span class="comment">// 请求超时时间</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// http request 拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//把cookie中的token字符串放入header中</span></span><br><span class="line">        <span class="keyword">if</span> (cookie.<span class="title function_">get</span>(<span class="string">&#x27;guli_token&#x27;</span>)) &#123;</span><br><span class="line">            config.<span class="property">headers</span>[<span class="string">&#x27;token&#x27;</span>] = cookie.<span class="title function_">get</span>(<span class="string">&#x27;guli_token&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err);</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="comment">// http response 拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> == <span class="number">28004</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;response.data.resultCode是28004&quot;</span>)</span><br><span class="line">            <span class="comment">// 返回 错误代码-1 清除ticket信息并跳转到登录页面</span></span><br><span class="line">            <span class="comment">//debugger</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;/login&quot;</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> !== <span class="number">20000</span>) &#123;</span><br><span class="line">                <span class="comment">//25000：订单支付中，不做任何提示</span></span><br><span class="line">                <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">code</span> != <span class="number">25000</span>) &#123;</span><br><span class="line">                    <span class="title class_">Message</span>(&#123;</span><br><span class="line">                        <span class="attr">message</span>: response.<span class="property">data</span>.<span class="property">message</span> || <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">                        <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error.<span class="property">response</span>) <span class="comment">// 返回接口返回的错误信息</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure>

<h4 id="修改layouts中的default-vue页面"><a href="#修改layouts中的default-vue页面" class="headerlink" title="修改layouts中的default.vue页面"></a>修改layouts中的default.vue页面</h4><p>显示登录之后的用户信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    import cookie from &#x27;js-cookie&#x27;</span><br><span class="line">    import userApi from &#x27;@/api/login&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                token: &#x27;&#x27;,</span><br><span class="line">                loginInfo: &#123;</span><br><span class="line">                    id: &#x27;&#x27;,</span><br><span class="line">                    age: &#x27;&#x27;,</span><br><span class="line">                    avatar: &#x27;&#x27;,</span><br><span class="line">                    mobile: &#x27;&#x27;,</span><br><span class="line">                    nickname: &#x27;&#x27;,</span><br><span class="line">                    sex: &#x27;&#x27;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        created() &#123;</span><br><span class="line">            this.showInfo()</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            showInfo() &#123;//渲染页面前调用的方法</span><br><span class="line">                var jsonStr = cookie.get(&quot;guli_ucenter&quot;);</span><br><span class="line">                if (jsonStr) &#123;</span><br><span class="line">                    this.loginInfo = JSON.parse(jsonStr)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            logout() &#123;//退出登录</span><br><span class="line">                //给cookie值清空就可以了</span><br><span class="line">                cookie.set(&#x27;guli_ucenter&#x27;, &quot;&quot;, &#123;domain: &#x27;localhost&#x27;&#125;)</span><br><span class="line">                cookie.set(&#x27;guli_token&#x27;, &quot;&quot;, &#123;domain: &#x27;localhost&#x27;&#125;)</span><br><span class="line">                //跳转页面</span><br><span class="line">                window.location.href = &quot;/&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>default.vue页面显示登录之后的用户信息（直接复制粘贴就可以）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;ul class=&quot;h-r-login&quot;&gt;</span><br><span class="line">    &lt;li v-if=&quot;!loginInfo.id&quot; id=&quot;no-login&quot;&gt;</span><br><span class="line">        &lt;a href=&quot;/login&quot; title=&quot;登录&quot;&gt;</span><br><span class="line">            &lt;em class=&quot;icon18 login-icon&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">            &lt;span class=&quot;vam ml5&quot;&gt;登录&lt;/span&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">        |</span><br><span class="line">        &lt;a href=&quot;/register&quot; title=&quot;注册&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;vam ml5&quot;&gt;注册&lt;/span&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &lt;li v-if=&quot;loginInfo.id&quot; id=&quot;is-login-one&quot; class=&quot;mr10&quot;&gt;</span><br><span class="line">        &lt;a id=&quot;headerMsgCountId&quot; href=&quot;#&quot; title=&quot;消息&quot;&gt;</span><br><span class="line">            &lt;em class=&quot;icon18 news-icon&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">        &lt;q class=&quot;red-point&quot; style=&quot;display: none&quot;&gt;&amp;nbsp;&lt;/q&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li v-if=&quot;loginInfo.id&quot; id=&quot;is-login-two&quot; class=&quot;h-r-user&quot;&gt;</span><br><span class="line">        &lt;a href=&quot;/ucenter&quot; title&gt;</span><br><span class="line">            &lt;img</span><br><span class="line">                 :src=&quot;loginInfo.avatar&quot;</span><br><span class="line">                 width=&quot;30&quot;</span><br><span class="line">                 height=&quot;30&quot;</span><br><span class="line">                 class=&quot;vam picImg&quot;</span><br><span class="line">                 alt</span><br><span class="line">                 &gt;</span><br><span class="line">            &lt;span id=&quot;userName&quot; class=&quot;vam disIb&quot;&gt;&#123;&#123; loginInfo.nickname &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">        &lt;a href=&quot;javascript:void(0);&quot; title=&quot;退出&quot; @click=&quot;logout()&quot; class=&quot;ml5&quot;&gt;退出&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;!-- /未登录显示第1 li；登录后显示第2，3 li --&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>



<h2 id="微信扫码登录"><a href="#微信扫码登录" class="headerlink" title="微信扫码登录"></a>微信扫码登录</h2><h3 id="OAuth2"><a href="#OAuth2" class="headerlink" title="OAuth2"></a>OAuth2</h3><blockquote>
<p>OAuth2是针对特定问题的一种<strong>解决方案</strong></p>
<p>OAuth2主要可以解决两个问题：</p>
<ol>
<li>开放系统间的授权（存储照片打印照片问题）</li>
<li>分布式访问问题（单点登录）</li>
</ol>
</blockquote>
<p>关于分布式访问（单点登录）问题，之前我们就做过解释(在单点登录的时候)</p>
<h3 id="微信登录"><a href="#微信登录" class="headerlink" title="微信登录"></a>微信登录</h3><p>熟悉微信登录流程</p>
<p><img src="/../pic/image-20221012205435012.png" alt="image-20221012205435012"></p>
<p><img src="/../pic/image-20221012213023797.png" alt="image-20221012213023797"></p>
<h4 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h4><p>application.properties添加相关配置信息</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 微信开放平台 appid</span></span><br><span class="line"><span class="attr">wx.open.app_id</span>=<span class="string">你的appid</span></span><br><span class="line"><span class="comment"># 微信开放平台 appsecret</span></span><br><span class="line"><span class="attr">wx.open.app_secret</span>=<span class="string">你的appsecret</span></span><br><span class="line"><span class="comment"># 微信开放平台 重定向url</span></span><br><span class="line"><span class="attr">wx.open.redirect_url</span>=<span class="string">http://你的服务器名称/api/ucenter/wx/callback</span></span><br></pre></td></tr></table></figure>

<p>创建util包，创建ConstantPropertiesUtil.java常量类，这个类主要是得到配置文件中的值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//@PropertySource(&quot;classpath:application.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConstantPropertiesUtil</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.app_id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appId;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.app_secret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appSecret;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.redirect_url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String redirectUrl;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_APP_ID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_APP_SECRET;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_REDIRECT_URL;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        WX_OPEN_APP_ID = appId;</span><br><span class="line">        WX_OPEN_APP_SECRET = appSecret;</span><br><span class="line">        WX_OPEN_REDIRECT_URL = redirectUrl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>创建controller</strong></p>
<p>guli-microservice-ucenter微服务中创建api包 api包中创建WxApiController(访问这个controller会出现一个二维码哦)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@Controller</span><span class="comment">//注意这里没有配置 @RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/ucenter/wx&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WxApiController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">genQrConnect</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">        <span class="comment">// 微信开放平台授权baseUrl</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;https://open.weixin.qq.com/connect/qrconnect&quot;</span> +</span><br><span class="line">            <span class="string">&quot;?appid=%s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;redirect_uri=%s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;response_type=code&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;scope=snsapi_login&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;state=%s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;#wechat_redirect&quot;</span>;</span><br><span class="line">        <span class="comment">// 回调地址</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> ConstantPropertiesUtil.WX_OPEN_REDIRECT_URL; <span class="comment">//获取业务服务器重定向地址</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redirectUrl = URLEncoder.encode(redirectUrl, <span class="string">&quot;UTF-8&quot;</span>); <span class="comment">//url编码</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 防止csrf攻击（跨站请求伪造攻击）</span></span><br><span class="line">        <span class="comment">//String state = UUID.randomUUID().toString().replaceAll(&quot;-&quot;, &quot;&quot;);//一般情况下会使用一个随机数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">state</span> <span class="operator">=</span> <span class="string">&quot;imhelen&quot;</span>;<span class="comment">//为了让大家能够使用我搭建的外网的微信回调跳转服务器，这里填写你在ngrok的前置域名</span></span><br><span class="line">            System.out.println(<span class="string">&quot;state = &quot;</span> + state);</span><br><span class="line">        <span class="comment">// 采用redis等进行缓存state 使用sessionId为key 30分钟后过期，可配置</span></span><br><span class="line">        <span class="comment">//键：&quot;wechar-open-state-&quot; + httpServletRequest.getSession().getId()</span></span><br><span class="line">        <span class="comment">//值：satte</span></span><br><span class="line">        <span class="comment">//过期时间：30分钟</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成qrcodeUrl</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">qrcodeUrl</span> <span class="operator">=</span> String.format(</span><br><span class="line">            baseUrl,</span><br><span class="line">            ConstantPropertiesUtil.WX_OPEN_APP_ID,</span><br><span class="line">            redirectUrl,</span><br><span class="line">            state);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:&quot;</span> + qrcodeUrl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用户点击“确认登录”后，微信服务器会向谷粒学院的业务服务器发起回调，因此接下来我们需要开发回调controller</p>
<p><strong>跳转路径在配置配置文件的时候已经配置好了</strong></p>
<p>在WxApiController中添加方法</p>
<p>这个是下面的得到的<strong>result</strong>，注释中有标注</p>
<blockquote>
<p>openId是指该微信用户的唯一标识，可以用它来查询该用户是否登录过这个业务</p>
<p>需要注意的是：下面的代码中最后生成的token和access_token是不一样的，access_token</p>
</blockquote>
<p><img src="/../pic/image-20221012211712611.png" alt="image-20221012211712611"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;callback&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">callback</span><span class="params">(String code, String state, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//得到授权临时票据code</span></span><br><span class="line">    System.out.println(<span class="string">&quot;code = &quot;</span> + code);</span><br><span class="line">    System.out.println(<span class="string">&quot;state = &quot;</span> + state);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从redis中将state获取出来，和当前传入的state作比较</span></span><br><span class="line">    <span class="comment">//如果一致则放行，如果不一致则抛出异常：非法访问</span></span><br><span class="line">    <span class="comment">//向认证服务器发送请求换取access_token</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">baseAccessTokenUrl</span> <span class="operator">=</span></span><br><span class="line">        <span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token&quot;</span> +</span><br><span class="line">        <span class="string">&quot;?appid=%s&quot;</span> +</span><br><span class="line">        <span class="string">&quot;&amp;secret=%s&quot;</span> +</span><br><span class="line">        <span class="string">&quot;&amp;code=%s&quot;</span> +</span><br><span class="line">        <span class="string">&quot;&amp;grant_type=authorization_code&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">accessTokenUrl</span> <span class="operator">=</span> String.format(baseAccessTokenUrl,</span><br><span class="line">                                          ConstantPropertiesUtil.WX_OPEN_APP_ID,</span><br><span class="line">                                          ConstantPropertiesUtil.WX_OPEN_APP_SECRET,</span><br><span class="line">                                          code);<span class="comment">//给路径赋值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        result = HttpClientUtils.get(accessTokenUrl);<span class="comment">//!!发请求给该路径，得到的值的类型在上面图片，这就是换取token的那一步</span></span><br><span class="line">        System.out.println(<span class="string">&quot;accessToken=============&quot;</span> + result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>, <span class="string">&quot;获取access_token失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//解析json字符串，取得token</span></span><br><span class="line">    <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line">    <span class="type">HashMap</span> <span class="variable">map</span> <span class="operator">=</span> gson.fromJson(result, HashMap.class);</span><br><span class="line">    <span class="type">String</span> <span class="variable">accessToken</span> <span class="operator">=</span> (String)map.get(<span class="string">&quot;access_token&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">openid</span> <span class="operator">=</span> (String)map.get(<span class="string">&quot;openid&quot;</span>);</span><br><span class="line">    <span class="comment">//查询数据库当前用用户是否曾经使用过微信登录</span></span><br><span class="line">    <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> memberService.getByOpenid(openid);</span><br><span class="line">    <span class="keyword">if</span>(member == <span class="literal">null</span>)&#123;<span class="comment">//说明是第一次登录</span></span><br><span class="line">        System.out.println(<span class="string">&quot;新用户注册&quot;</span>);</span><br><span class="line">        <span class="comment">//访问微信的资源服务器（这个是固定的地址，因为我们要获得用户的昵称和其他信息）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">baseUserInfoUrl</span> <span class="operator">=</span> <span class="string">&quot;https://api.weixin.qq.com/sns/userinfo&quot;</span> +</span><br><span class="line">            <span class="string">&quot;?access_token=%s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;openid=%s&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userInfoUrl</span> <span class="operator">=</span> String.format(baseUserInfoUrl, accessToken, openid);<span class="comment">//给url赋值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resultUserInfo</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            resultUserInfo = HttpClientUtils.get(userInfoUrl);</span><br><span class="line">            System.out.println(<span class="string">&quot;resultUserInfo==========&quot;</span> + resultUserInfo);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuliException</span>(<span class="number">20001</span>, <span class="string">&quot;获取用户信息失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//解析json</span></span><br><span class="line">        HashMap&lt;String, Object&gt; mapUserInfo = gson.fromJson(resultUserInfo,HashMap.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">nickname</span> <span class="operator">=</span> (String)mapUserInfo.get(<span class="string">&quot;nickname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">headimgurl</span> <span class="operator">=</span> (String)mapUserInfo.get(<span class="string">&quot;headimgurl&quot;</span>);</span><br><span class="line">        <span class="comment">//向数据库中插入一条记录</span></span><br><span class="line">        member = <span class="keyword">new</span> <span class="title class_">Member</span>();</span><br><span class="line">        member.setNickname(nickname);</span><br><span class="line">        member.setOpenid(openid);</span><br><span class="line">        member.setAvatar(headimgurl);</span><br><span class="line">        <span class="comment">//保存该用户</span></span><br><span class="line">        memberService.save(member);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//下面是用户登录用的啦，生成的token和access_token是不一样的</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成jwt</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtils.geneJsonWebToken(member.getId(),member.getNickName());</span><br><span class="line">    <span class="comment">//因为端口号不同存在蛞蝓问题，cookie不能跨域，所以这里使用url重写</span></span><br><span class="line">    <span class="comment">//返回首页面，通过路径传递token字符串</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:http://localhost:3000?token=&quot;</span> + token;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Member <span class="title function_">getByOpenid</span><span class="params">(String openid)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;Member&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;openid&quot;</span>, openid);</span><br><span class="line">    <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> baseMapper.selectOne(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> member;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h4><ol>
<li><p>在页面路径中获取token字符串</p>
</li>
<li><p>把获取的token字符串放到cookie里</p>
<blockquote>
<p>有前端拦截器，判断cookie里面是否有token，如果有，把cookie中的token取出来，放到header里面</p>
</blockquote>
</li>
<li><p>调用后端接口，根据token值获取用户信息，把获取出来的用户信息放到cookie中</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">loginInfo</span>: &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">age</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">avatar</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">mobile</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">nickname</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">sex</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">//第一步</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">token</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">token</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">token</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">wxLogin</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">showInfo</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="title function_">showInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> jsonStr = cookie.<span class="title function_">get</span>(<span class="string">&quot;guli_ucenter&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (jsonStr) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">loginInfo</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsonStr)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">            cookie.<span class="title function_">set</span>(<span class="string">&#x27;guli_ucenter&#x27;</span>, <span class="string">&quot;&quot;</span>, &#123;<span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">            cookie.<span class="title function_">set</span>(<span class="string">&#x27;guli_token&#x27;</span>, <span class="string">&quot;&quot;</span>, &#123;<span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">            <span class="comment">//跳转页面</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">wxLogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">token</span> == <span class="string">&#x27;&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">            <span class="comment">//第二步，把token存在cookie中</span></span><br><span class="line">            cookie.<span class="title function_">set</span>(<span class="string">&#x27;guli_token&#x27;</span>, <span class="variable language_">this</span>.<span class="property">token</span>, &#123;<span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">            cookie.<span class="title function_">set</span>(<span class="string">&#x27;guli_ucenter&#x27;</span>, <span class="string">&#x27;&#x27;</span>, &#123;<span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">            <span class="comment">//第三步。登录成功根据token获取用户信息</span></span><br><span class="line">            userApi.<span class="title function_">getLoginInfo</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">loginInfo</span> = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">item</span></span><br><span class="line">                <span class="comment">//将用户信息记录cookie</span></span><br><span class="line">                cookie.<span class="title function_">set</span>(<span class="string">&#x27;guli_ucenter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">loginInfo</span>, &#123;<span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Day14"><a href="#Day14" class="headerlink" title="Day14"></a>Day14</h1><h2 id="名师列表功能"><a href="#名师列表功能" class="headerlink" title="名师列表功能"></a>名师列表功能</h2><h2 id="名师详情功能"><a href="#名师详情功能" class="headerlink" title="名师详情功能"></a>名师详情功能</h2><p>用到了动态路由的知识点</p>
<p>动态路由的页面由<code>_</code>开头</p>
<p><img src="/../pic/image-20221013153132901.png" alt="image-20221013153132901"></p>
<h2 id="课程列表功能"><a href="#课程列表功能" class="headerlink" title="课程列表功能"></a>课程列表功能</h2><h2 id="课程详情功能"><a href="#课程详情功能" class="headerlink" title="课程详情功能"></a>课程详情功能</h2><p><strong>需要编写sql语句，根据课程id查询课程信息</strong></p>
<ol>
<li>课程的基本信息</li>
<li>课程分类</li>
<li>课程描述</li>
<li>所属讲师</li>
</ol>
<h3 id="定义vo对象"><a href="#定义vo对象" class="headerlink" title="定义vo对象"></a>定义vo对象</h3><p>在项目中很多时候需要把model转换成dto用于网站信息的展示，按前端的需要传递对象的数据，保 证model对外是隐私的，例如密码之类的属性能很好地避免暴露在外，同时也会减小数据传输的体积。</p>
<p><code>CourseWebVo</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiModel(value=&quot;课程信息&quot;, description=&quot;网站课程详情页需要的相关字段&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CourseWebVo</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程销售价格，设置为0则可免费观看&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;总课时&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer lessonNum;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程封面图片路径&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;销售数量&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long buyCount;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;浏览数量&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程简介&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;讲师ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String teacherId;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;讲师姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String teacherName;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;讲师资历,一句话说明讲师&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String intro;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;讲师头像&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程类别ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectLevelOneId;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;类别名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectLevelOne;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程类别ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectLevelTwoId;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;类别名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectLevelTwo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定义Mapper方法"><a href="#定义Mapper方法" class="headerlink" title="定义Mapper方法"></a>定义Mapper方法</h3><p><code>CourseMapper.Java</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CourseWebVo selectInfoWebById(String courseId);</span><br></pre></td></tr></table></figure>

<p><code>CourseMapper.xml</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="comment">--!返回值为vo对象，但是其实这个可以直接用@Select注解实现 --&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> id<span class="operator">=</span>&quot;selectInfoWebById&quot; resultType<span class="operator">=</span>&quot;com.guli.edu.vo.CourseWebVo&quot;<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">    c.id,</span><br><span class="line">    c.title,</span><br><span class="line">    c.cover,</span><br><span class="line">    <span class="keyword">CONVERT</span>(c.price, <span class="type">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>)) <span class="keyword">AS</span> price,</span><br><span class="line">    c.lesson_num <span class="keyword">AS</span> lessonNum,</span><br><span class="line">    c.cover,</span><br><span class="line">    c.buy_count <span class="keyword">AS</span> buyCount,</span><br><span class="line">    c.view_count <span class="keyword">AS</span> viewCount,</span><br><span class="line">    cd.description,</span><br><span class="line">    t.id <span class="keyword">AS</span> teacherId,</span><br><span class="line">    t.name <span class="keyword">AS</span> teacherName,</span><br><span class="line">    t.intro,</span><br><span class="line">    t.avatar,</span><br><span class="line">    s1.id <span class="keyword">AS</span> subjectLevelOneId,</span><br><span class="line">    s1.title <span class="keyword">AS</span> subjectLevelOne,</span><br><span class="line">    s2.id <span class="keyword">AS</span> subjectLevelTwoId,</span><br><span class="line">    s2.title <span class="keyword">AS</span> subjectLevelTwo</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">    edu_course c</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> edu_course_description cd <span class="keyword">ON</span> c.id <span class="operator">=</span> cd.id</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> edu_teacher t <span class="keyword">ON</span> c.teacher_id <span class="operator">=</span> t.id</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> edu_subject s1 <span class="keyword">ON</span> c.subject_parent_id <span class="operator">=</span> s1.id</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> edu_subject s2 <span class="keyword">ON</span> c.subject_id <span class="operator">=</span> s2.id</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">    c.id <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">select</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="业务层获取数据并更新浏览量"><a href="#业务层获取数据并更新浏览量" class="headerlink" title="业务层获取数据并更新浏览量"></a>业务层获取数据并更新浏览量</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> CourseWebVo <span class="title function_">selectInfoWebById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="comment">//更新访问量，方法在下面</span></span><br><span class="line">    <span class="built_in">this</span>.updatePageViewCount(id);</span><br><span class="line">    <span class="comment">//调用mapper是返回查询的数据</span></span><br><span class="line">    <span class="keyword">return</span> baseMapper.selectInfoWebById(id);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updatePageViewCount</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="comment">//设置访问量+1</span></span><br><span class="line">    <span class="type">Course</span> <span class="variable">course</span> <span class="operator">=</span> baseMapper.selectById(id);</span><br><span class="line">    course.setViewCount(course.getViewCount() + <span class="number">1</span>);</span><br><span class="line">    baseMapper.updateById(course);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="接口层"><a href="#接口层" class="headerlink" title="接口层"></a>接口层</h3><p><code>CourseController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ChapterService chapterService;</span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据ID查询课程&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">getById</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@ApiParam(name = &quot;courseId&quot;, value = &quot;课程ID&quot;, required = true)</span></span></span><br><span class="line"><span class="params">    <span class="meta">@PathVariable</span> String courseId)</span>&#123;</span><br><span class="line">    <span class="comment">//查询课程信息和讲师信息</span></span><br><span class="line">    <span class="type">CourseWebVo</span> <span class="variable">courseWebVo</span> <span class="operator">=</span> courseService.selectInfoWebById(courseId);</span><br><span class="line">    <span class="comment">//查询当前课程的章节信息（之前写过了）</span></span><br><span class="line">    List&lt;ChapterVo&gt; chapterVoList = chapterService.nestedList(courseId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;course&quot;</span>, courseWebVo).data(<span class="string">&quot;chapterVoList&quot;</span>, chapterVoList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="整合阿里云视频播放器实现视频播放"><a href="#整合阿里云视频播放器实现视频播放" class="headerlink" title="整合阿里云视频播放器实现视频播放"></a>整合阿里云视频播放器实现视频播放</h2><ol>
<li><p>引入阿里云提供给我们的链接(放在前端的head标签中)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://g.alicdn.com/de/prismplayer/2.8.1/skins/default/aliplayer-min.css&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">src</span>=<span class="string">&quot;https://g.alicdn.com/de/prismplayer/2.8.1/aliplayer-min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在body中初始化播放器</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;prism-player&quot;</span> <span class="attr">id</span>=<span class="string">&quot;J_prismPlayer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> player = <span class="keyword">new</span> <span class="title class_">Aliplayer</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="string">&#x27;J_prismPlayer&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">width</span>: <span class="string">&#x27;100%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">autoplay</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">cover</span>: <span class="string">&#x27;http://liveroom-img.oss-cn-qingdao.aliyuncs.com/logo.png&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//播放配置</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//播放方式一：支持播放地址播放,此播放优先级最高，此种方式不能播放加密视频</span></span></span><br><span class="line"><span class="language-javascript">            source : <span class="string">&#x27;你的视频播放地址&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//播放方式二：播放凭证播放</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">encryptType</span>:<span class="string">&#x27;1&#x27;</span>,<span class="comment">//如果播放加密视频，则需设置encryptType=1，非加密视频无需设置此项</span></span></span><br><span class="line"><span class="language-javascript">            vid : <span class="string">&#x27;视频id&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            playauth : <span class="string">&#x27;视频授权码&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="keyword">function</span> (<span class="params">player</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;播放器创建好了。&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../pic/image-20221015111721031.png" alt="image-20221015111721031">这两种方式取哪种都可以，但是推荐用第二种，比较安全</p>
</li>
</ol>
<h3 id="后端获取播放凭证"><a href="#后端获取播放凭证" class="headerlink" title="后端获取播放凭证"></a>后端获取播放凭证</h3><p>在vod微服务中创建controller，再创建获取凭证的方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span> <span class="comment">//跨域</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/vod/video&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;get-play-auth/&#123;videoId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">getVideoPlayAuth</span><span class="params">(<span class="meta">@PathVariable(&quot;videoId&quot;)</span> String videoId)</span> <span class="keyword">throws</span></span><br><span class="line">        Exception &#123;</span><br><span class="line">        <span class="comment">//获取阿里云存储相关常量</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> ConstantPropertiesUtil.ACCESS_KEY_ID;</span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> ConstantPropertiesUtil.ACCESS_KEY_SECRET;</span><br><span class="line">        <span class="comment">//初始化</span></span><br><span class="line">        <span class="type">DefaultAcsClient</span> <span class="variable">client</span> <span class="operator">=</span> AliyunVodSDKUtils.initVodClient(accessKeyId, accessKeySecret);</span><br><span class="line">        <span class="comment">//请求</span></span><br><span class="line">        <span class="type">GetVideoPlayAuthRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetVideoPlayAuthRequest</span>();</span><br><span class="line">        request.setVideoId(videoId);</span><br><span class="line">        <span class="comment">//响应</span></span><br><span class="line">        <span class="type">GetVideoPlayAuthResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.getAcsResponse(request);</span><br><span class="line">        <span class="comment">//得到播放凭证</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">playAuth</span> <span class="operator">=</span> response.getPlayAuth();</span><br><span class="line">        <span class="comment">//返回结果</span></span><br><span class="line">        <span class="keyword">return</span> R.ok().message(<span class="string">&quot;获取凭证成功&quot;</span>).data(<span class="string">&quot;playAuth&quot;</span>, playAuth);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端播放器整合"><a href="#前端播放器整合" class="headerlink" title="前端播放器整合"></a>前端播放器整合</h3><blockquote>
<p>在线配置：<a target="_blank" rel="noopener" href="https://player.alicdn.com/aliplayer/setting/setting.html">https://player.alicdn.com/aliplayer/setting/setting.html</a> </p>
<p>功能展示：<a target="_blank" rel="noopener" href="https://player.alicdn.com/aliplayer/presentation/index.html">https://player.alicdn.com/aliplayer/presentation/index.html</a></p>
</blockquote>
<p>利用动态路由创建新播放器页面</p>
<h4 id="修改超链接"><a href="#修改超链接" class="headerlink" title="修改超链接"></a>修改超链接</h4><p>修改原来信息页面中的超链接属性</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span>  <span class="attr">:href</span>=<span class="string">&quot;&#x27;/player/&#x27;+video.videoSourceId&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">:title</span>=<span class="string">&quot;video.title&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="编写api"><a href="#编写api" class="headerlink" title="编写api"></a>编写api</h4><p>创建api&#x2F;vod.js（发送请求到后端获取播放凭证）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/vod/video&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">getPlayAuth</span>(<span class="params">vid</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`eduvod/video/getplayAuth/<span class="subst">$&#123;vid&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建动态路由跳转的页面（播放页面）"><a href="#创建动态路由跳转的页面（播放页面）" class="headerlink" title="创建动态路由跳转的页面（播放页面）"></a>创建动态路由跳转的页面（播放页面）</h3><p><code>创建 pages/player/_vid.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;!-- 阿里云视频播放器样式 --&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot;</span><br><span class="line">          href=&quot;https://g.alicdn.com/de/prismplayer/2.8.1/skins/default/aliplayer-min.css&quot; &gt;</span><br><span class="line">    &lt;!-- 阿里云视频播放器脚本 --&gt;</span><br><span class="line">    &lt;script charset=&quot;utf-8&quot; type=&quot;text/javascript&quot;</span><br><span class="line">            src=&quot;https://g.alicdn.com/de/prismplayer/2.8.1/aliplayer-min.js&quot; /&gt;</span><br><span class="line"> &lt;!-- 定义播放器dom --&gt;</span><br><span class="line"> 	&lt;div id=&quot;J_prismPlayer&quot; class=&quot;prism-player&quot; /&gt; &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import vod from &#x27;@/api/vod&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        layout: &#x27;video&#x27;,//应用video布局</span><br><span class="line">        asyncData(&#123; params, error &#125;) &#123;//异步请求取得路径中的vid值</span><br><span class="line">            return vod.getPlayAuth(params.vid).then(response =&gt; &#123;</span><br><span class="line">                // console.log(response.data.data)</span><br><span class="line">                return &#123;</span><br><span class="line">                    vid: params.vid,//得到路径中的值，并保存</span><br><span class="line">                    playAuth: response.data.data.playAuth//得到登录凭证</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        /**</span><br><span class="line">        * 页面渲染完成时：此时js脚本已加载，Aliplayer已定义，可以使用</span><br><span class="line">        * 如果在created生命周期函数中使用，Aliplayer is not defined错误</span><br><span class="line">        */</span><br><span class="line">        mounted() &#123;</span><br><span class="line">            new Aliplayer(&#123;</span><br><span class="line">                id: &#x27;J_prismPlayer&#x27;,//这个id写的是播放器dom的id</span><br><span class="line">                vid: this.vid, // 视频id</span><br><span class="line">                playauth: this.playAuth, // 播放凭证</span><br><span class="line">                encryptType: &#x27;1&#x27;, // 如果播放加密视频，则需设置encryptType=1，非加密视频无需设</span><br><span class="line">                置此项</span><br><span class="line">                width: &#x27;100%&#x27;,</span><br><span class="line">                height: &#x27;500px&#x27;</span><br><span class="line">            &#125;, function(player) &#123;</span><br><span class="line">                console.log(&#x27;播放器创建成功&#x27;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h1 id="Day15"><a href="#Day15" class="headerlink" title="Day15"></a>Day15</h1><h2 id="支付功能"><a href="#支付功能" class="headerlink" title="支付功能"></a>支付功能</h2><h3 id="课程支付需求描述"><a href="#课程支付需求描述" class="headerlink" title="课程支付需求描述"></a>课程支付需求描述</h3><ol>
<li><p>课程分为<code>免费</code>课程和<code>付费</code>课程，如果是免费课程可以直接观看，如果是付费课程，需要下单支付后才可以观看<img src="/../pic/image-20221016133332937.png" alt="image-20221016133332937"></p>
</li>
<li><p>如果是免费课程，在用户选择课程后进入课程详情页后，直接显示“立即观看”，点击立即观看，可以切换到播放列表进行视频播放<img src="/../pic/image-20221016133319426.png" alt="image-20221016133319426"></p>
</li>
<li><p>如果是付费课程，在用户选择课程后进入到课程详情页面后，会显示“立即购买”<img src="/../pic/image-20221016133424877.png" alt="image-20221016133424877"></p>
<p>（1）点击”立即购买”会生成课程的订单，跳转到订单页面。<img src="/../pic/image-20221016133515999.png" alt="image-20221016133515999"></p>
<p>（2）点击”去支付”，跳转到支付页面（就是微信扫码）</p>
<p>（3）扫码支付后，会跳转到课程详情页面，同时显示“立即观看”<img src="/../pic/image-20221016133649597.png" alt="image-20221016133649597"></p>
</li>
</ol>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>创建两张表</p>
<p><img src="/../pic/image-20221016133719995.png" alt="image-20221016133719995"></p>
<h3 id="开发创建订单接口"><a href="#开发创建订单接口" class="headerlink" title="开发创建订单接口"></a>开发创建订单接口</h3><p><strong>编写订单controller</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orderservice/order&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TOrderController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TOrderService orderService;</span><br><span class="line">    <span class="comment">//根据课程id和用户id创建订单，返回订单id</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;createOrder/&#123;courseId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@PathVariable</span> String courseId, HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">orderId</span> <span class="operator">=</span> orderService.saveOrder(courseId,JwtUtils.getMemberIdByJwtToken(request));</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;orderId&quot;</span>, orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在service_edu创建接口</strong></p>
<p>实现根据课程id获取课程信息，返回课程信息对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据课程id查询课程信息</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getDto/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> com.atguigu.commonutils.vo.CourseInfoForm <span class="title function_">getCourseInfoDto</span><span class="params">(<span class="meta">@PathVariable</span> String courseId)</span> &#123;</span><br><span class="line">    <span class="type">CourseInfoForm</span> <span class="variable">courseInfoForm</span> <span class="operator">=</span> courseService.getCourseInfo(courseId);</span><br><span class="line">    com.atguigu.commonutils.vo.<span class="type">CourseInfoForm</span> <span class="variable">courseInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.atguigu.commonutils.vo.CourseInfoForm();</span><br><span class="line">    BeanUtils.copyProperties(courseInfoForm,courseInfo);</span><br><span class="line">    <span class="keyword">return</span> courseInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在service_ucenter创建接口</strong></p>
<p>实现用户id获取用户信息，返回用户信息对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据token字符串获取用户信息</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;getInfoUc/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> com.atguigu.commonutils.vo.UcenterMember <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    <span class="comment">//根据用户id获取用户信息</span></span><br><span class="line">    <span class="type">UcenterMember</span> <span class="variable">ucenterMember</span> <span class="operator">=</span> memberService.getById(id);</span><br><span class="line">    com.atguigu.commonutils.vo.<span class="type">UcenterMember</span> <span class="variable">memeber</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.atguigu.commonutils.vo.UcenterMember();</span><br><span class="line">    BeanUtils.copyProperties(ucenterMember,memeber);</span><br><span class="line">    <span class="keyword">return</span> memeber;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编写订单service</strong></p>
<p>在service_order模块创建接口，实现远程调用</p>
<p><img src="/../pic/image-20221016134021905.png" alt="image-20221016134021905"></p>
<p>EduClient</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;service-edu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EduClient</span> &#123;</span><br><span class="line">    <span class="comment">//根据课程id查询课程信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/eduservice/course/getDto/&#123;courseId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> com.atguigu.commonutils.vo.CourseInfoForm</span><br><span class="line">        <span class="title function_">getCourseInfoDto</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UcenterClient</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;service-ucenter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UcenterClient</span> &#123;</span><br><span class="line">    <span class="comment">//根据课程id查询课程信息</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/ucenterservice/member/getInfoUc/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> com.atguigu.commonutils.vo.UcenterMember <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在service_order模块编写创建订单service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TOrderServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;TOrderMapper, TOrder&gt;</span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">TOrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduClient eduClient;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UcenterClient ucenterClient;</span><br><span class="line">    <span class="comment">//创建订单</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">saveOrder</span><span class="params">(String courseId, String memberId)</span> &#123;</span><br><span class="line">        <span class="comment">//远程调用课程服务，根据课程id获取课程信息</span></span><br><span class="line">        <span class="type">CourseInfoForm</span> <span class="variable">courseDto</span> <span class="operator">=</span> eduClient.getCourseInfoDto(courseId);</span><br><span class="line">        <span class="comment">//远程调用用户服务，根据用户id获取用户信息</span></span><br><span class="line">        <span class="type">UcenterMember</span> <span class="variable">ucenterMember</span> <span class="operator">=</span> ucenterClient.getInfo(memberId);</span><br><span class="line">        <span class="comment">//创建订单</span></span><br><span class="line">        <span class="type">TOrder</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TOrder</span>();</span><br><span class="line">        order.setOrderNo(OrderNoUtil.getOrderNo());</span><br><span class="line">        order.setCourseId(courseId);</span><br><span class="line">        order.setCourseTitle(courseDto.getTitle());</span><br><span class="line">        order.setCourseCover(courseDto.getCover());</span><br><span class="line">        order.setTeacherName(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        order.setTotalFee(courseDto.getPrice());</span><br><span class="line">        order.setMemberId(memberId);</span><br><span class="line">        order.setMobile(ucenterMember.getMobile());</span><br><span class="line">        order.setNickname(ucenterMember.getNickname());</span><br><span class="line">        order.setStatus(<span class="number">0</span>);</span><br><span class="line">        order.setPayType(<span class="number">1</span>);</span><br><span class="line">        baseMapper.insert(order);</span><br><span class="line">        <span class="keyword">return</span> order.getOrderNo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="开发获取订单接口"><a href="#开发获取订单接口" class="headerlink" title="开发获取订单接口"></a>开发获取订单接口</h3><p>在订单controller创建根据id获取订单信息接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;getOrder/&#123;orderId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> String orderId)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;TOrder&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;order_no&quot;</span>,orderId);</span><br><span class="line">    <span class="type">TOrder</span> <span class="variable">order</span> <span class="operator">=</span> orderService.getOne(wrapper);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;item&quot;</span>, order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="生成微信支付二维码接口"><a href="#生成微信支付二维码接口" class="headerlink" title="生成微信支付二维码接口"></a>生成微信支付二维码接口</h3><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.wxpay<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>wxpay-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orderservice/log&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayLogController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PayLogService payService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 生成二维码</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/createNative/&#123;orderNo&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">createNative</span><span class="params">(<span class="meta">@PathVariable</span> String orderNo)</span> &#123;</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> payService.createNative(orderNo);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayLogServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;PayLogMapper, PayLog&gt;</span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">PayLogService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TOrderService orderService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">createNative</span><span class="params">(String orderNo)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//根据订单id获取订单信息</span></span><br><span class="line">            QueryWrapper&lt;TOrder&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">            wrapper.eq(<span class="string">&quot;order_no&quot;</span>,orderNo);</span><br><span class="line">            <span class="type">TOrder</span> <span class="variable">order</span> <span class="operator">=</span> orderService.getOne(wrapper);</span><br><span class="line">            <span class="comment">//创建一个map设置生成二维码需要的参数</span></span><br><span class="line">            <span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">            <span class="comment">//1、设置支付参数</span></span><br><span class="line">            m.put(<span class="string">&quot;appid&quot;</span>, <span class="string">&quot;wx74862e0dfcf69954&quot;</span>);</span><br><span class="line">            m.put(<span class="string">&quot;mch_id&quot;</span>, <span class="string">&quot;1558950191&quot;</span>);<span class="comment">//商户号，和上面那个一样是固定的</span></span><br><span class="line">            m.put(<span class="string">&quot;nonce_str&quot;</span>, WXPayUtil.generateNonceStr());<span class="comment">//生成一个随机的字符串，使每个订单号的二维码都不一样</span></span><br><span class="line">            m.put(<span class="string">&quot;body&quot;</span>, order.getCourseTitle());<span class="comment">//生成的二维码显示的名字</span></span><br><span class="line">            m.put(<span class="string">&quot;out_trade_no&quot;</span>, orderNo);</span><br><span class="line">            m.put(<span class="string">&quot;total_fee&quot;</span>, order.getTotalFee().multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;100&quot;</span>)).longValue()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">            m.put(<span class="string">&quot;spbill_create_ip&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>);<span class="comment">//支持在支付的网址，在实际项目中要用域名www.baidu.com</span></span><br><span class="line">            m.put(<span class="string">&quot;notify_url&quot;</span>,<span class="string">&quot;http://guli.shop/api/order/weixinPay/weixinNotify\n&quot;</span>);<span class="comment">//支付之后回调的地址</span></span><br><span class="line">            m.put(<span class="string">&quot;trade_type&quot;</span>, <span class="string">&quot;NATIVE&quot;</span>);<span class="comment">//支付的类型</span></span><br><span class="line">            <span class="comment">//2、HTTPClient来根据URL访问第三方接口并且传递参数</span></span><br><span class="line">            <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpClient</span>(<span class="string">&quot;https://api.mch.weixin.qq.com/pay/unifiedorder&quot;</span>);</span><br><span class="line">            <span class="comment">//client设置参数（但是必须是xml格式的）</span></span><br><span class="line">            client.setXmlParam(WXPayUtil.generateSignedXml(m, <span class="string">&quot;T6m9iK73b0kn9g5v426MKfHQH7X8rKwb&quot;</span>));<span class="comment">//根据商户key对map中的参数进行加密，但是这个方法是微信提供给我们的，后面第二个参数就是相应的商户key</span></span><br><span class="line">            client.setHttps(<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//执行post提交发送</span></span><br><span class="line">            client.post();</span><br><span class="line">            <span class="comment">//3、返回第三方的数据（注意即使返回的格式也是xml，我们在下面对之进行转换）</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> client.getContent();</span><br><span class="line">            <span class="comment">//把返回数据的xml格式转换为map</span></span><br><span class="line">            Map&lt;String, String&gt; resultMap = WXPayUtil.xmlToMap(xml);</span><br><span class="line">            <span class="comment">//4、封装返回结果集</span></span><br><span class="line">            <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            map.put(<span class="string">&quot;out_trade_no&quot;</span>, orderNo);<span class="comment">//订单号</span></span><br><span class="line">            map.put(<span class="string">&quot;course_id&quot;</span>, order.getCourseId());<span class="comment">//课程id</span></span><br><span class="line">            map.put(<span class="string">&quot;total_fee&quot;</span>, order.getTotalFee());<span class="comment">//总价格</span></span><br><span class="line">            map.put(<span class="string">&quot;result_code&quot;</span>, resultMap.get(<span class="string">&quot;result_code&quot;</span>));<span class="comment">//返回二维码的状态码</span></span><br><span class="line">            map.put(<span class="string">&quot;code_url&quot;</span>, resultMap.get(<span class="string">&quot;code_url&quot;</span>));<span class="comment">//二维码地址</span></span><br><span class="line">            <span class="comment">//微信支付二维码2小时过期，可采取2小时未支付取消订单</span></span><br><span class="line">            <span class="comment">//redisTemplate.opsForValue().set(orderNo, map, 120,TimeUnit.MINUTES);</span></span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询用户的支付状态接口"><a href="#查询用户的支付状态接口" class="headerlink" title="查询用户的支付状态接口"></a>查询用户的支付状态接口</h3><p>这个接口主要是为了查询用户是否已支付，调用的主要是微信的api</p>
<p>编写controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/queryPayStatus/&#123;orderNo&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">queryPayStatus</span><span class="params">(<span class="meta">@PathVariable</span> String orderNo)</span> &#123;</span><br><span class="line">    <span class="comment">//调用查询接口</span></span><br><span class="line">    Map&lt;String, String&gt; map = payService.queryPayStatus(orderNo);</span><br><span class="line">    <span class="keyword">if</span> (map == <span class="literal">null</span>) &#123;<span class="comment">//出错</span></span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;支付出错&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (map.get(<span class="string">&quot;trade_state&quot;</span>).equals(<span class="string">&quot;SUCCESS&quot;</span>)) &#123;<span class="comment">//如果成功</span></span><br><span class="line">        <span class="comment">//更改订单状态</span></span><br><span class="line">        payService.updateOrderStatus(map);</span><br><span class="line">        <span class="keyword">return</span> R.ok().message(<span class="string">&quot;支付成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.ok().code(<span class="number">25000</span>).message(<span class="string">&quot;支付中&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写service，查询支付状态与更新订单状态</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map <span class="title function_">queryPayStatus</span><span class="params">(String orderNo)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1、封装参数</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        m.put(<span class="string">&quot;appid&quot;</span>, <span class="string">&quot;wx74862e0dfcf69954&quot;</span>);</span><br><span class="line">        m.put(<span class="string">&quot;mch_id&quot;</span>, <span class="string">&quot;1558950191&quot;</span>);</span><br><span class="line">        m.put(<span class="string">&quot;out_trade_no&quot;</span>, orderNo);</span><br><span class="line">        m.put(<span class="string">&quot;nonce_str&quot;</span>, WXPayUtil.generateNonceStr());</span><br><span class="line">        <span class="comment">//2、设置请求</span></span><br><span class="line">        <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">            <span class="title class_">HttpClient</span>(<span class="string">&quot;https://api.mch.weixin.qq.com/pay/orderquery&quot;</span>);</span><br><span class="line">        client.setXmlParam(WXPayUtil.generateSignedXml(m,<span class="string">&quot;T6m9iK73b0kn9g5v426MKfHQH7X8rKwb&quot;</span>));</span><br><span class="line">        client.setHttps(<span class="literal">true</span>);</span><br><span class="line">        client.post();</span><br><span class="line">        <span class="comment">//3、返回第三方的数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> client.getContent();</span><br><span class="line">        <span class="comment">//6、转成Map</span></span><br><span class="line">        Map&lt;String, String&gt; resultMap = WXPayUtil.xmlToMap(xml);</span><br><span class="line">        <span class="comment">//7、返回</span></span><br><span class="line">        <span class="keyword">return</span> resultMap;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateOrderStatus</span><span class="params">(Map&lt;String, String&gt; map)</span> &#123;</span><br><span class="line">    <span class="comment">//获取订单id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">orderNo</span> <span class="operator">=</span> map.get(<span class="string">&quot;out_trade_no&quot;</span>);</span><br><span class="line">    <span class="comment">//根据订单id查询订单信息</span></span><br><span class="line">    QueryWrapper&lt;TOrder&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;order_no&quot;</span>,orderNo);</span><br><span class="line">    <span class="type">TOrder</span> <span class="variable">order</span> <span class="operator">=</span> orderService.getOne(wrapper);</span><br><span class="line">    <span class="keyword">if</span>(order.getStatus().intValue() == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    order.setStatus(<span class="number">1</span>);</span><br><span class="line">    orderService.updateById(order);</span><br><span class="line">    <span class="comment">//记录支付日志</span></span><br><span class="line">    PayLog payLog=<span class="keyword">new</span> <span class="title class_">PayLog</span>();</span><br><span class="line">    payLog.setOrderNo(order.getOrderNo());<span class="comment">//支付订单号</span></span><br><span class="line">    payLog.setPayTime(<span class="keyword">new</span> <span class="title class_">Date</span>());<span class="comment">//完成订单的时间</span></span><br><span class="line">    payLog.setPayType(<span class="number">1</span>);<span class="comment">//支付类型 1为yi</span></span><br><span class="line">    payLog.setTotalFee(order.getTotalFee());<span class="comment">//总金额(分)</span></span><br><span class="line">    payLog.setTradeState(map.get(<span class="string">&quot;trade_state&quot;</span>));<span class="comment">//支付状态</span></span><br><span class="line">    payLog.setTransactionId(map.get(<span class="string">&quot;transaction_id&quot;</span>));</span><br><span class="line">    payLog.setAttr(JSONObject.toJSONString(map));</span><br><span class="line">    baseMapper.insert(payLog);<span class="comment">//插入到支付日志表</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="课程支付前端"><a href="#课程支付前端" class="headerlink" title="课程支付前端"></a>课程支付前端</h2><p><img src="/../pic/image-20221021102006409.png" alt="image-20221021102006409"></p>
<p>创建<code>order.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//1、创建订单</span></span><br><span class="line">    <span class="title function_">createOrder</span>(<span class="params">cid</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/orderservice/order/createOrder/&#x27;</span>+cid,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//2、根据id获取订单</span></span><br><span class="line">    <span class="title function_">getById</span>(<span class="params">cid</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/orderservice/order/getOrder/&#x27;</span>+cid,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//3、生成微信支付二维码</span></span><br><span class="line">    <span class="title function_">createNative</span>(<span class="params">cid</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/orderservice/log/createNative/&#x27;</span>+cid,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//4、根据id获取订单支付状态</span></span><br><span class="line">    <span class="title function_">queryPayStatus</span>(<span class="params">cid</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/orderservice/log/queryPayStatus/&#x27;</span>+cid,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在课程详情页面中添加创建订单方法</strong></p>
<p>在“立即购买”位置添加事件</p>
<p><img src="/../pic/image-20221016232802157.png" alt="image-20221016232802157"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">methods</span>:&#123;</span><br><span class="line">    <span class="comment">//根据课程id，调用接口方法生成订单</span></span><br><span class="line">    <span class="title function_">createOrder</span>(<span class="params"></span>)&#123;</span><br><span class="line">        order.<span class="title function_">createOrder</span>(<span class="variable language_">this</span>.<span class="property">courseId</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">success</span>)&#123;</span><br><span class="line">                <span class="comment">//订单创建成功，跳转到订单页面,这里实现了动态路由</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/order/&#x27;</span>+ response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">orderId</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>创建订单页面，显示订单信息</strong></p>
<p>在pages下面创建order文件夹，创建_oid.vue页面</p>
<p>在_oid.vue页面调用方法，获取订单信息</p>
<p>在页面中给值赋值，并且调用方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> orderApi <span class="keyword">from</span> <span class="string">&#x27;@/api/order&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//根据订单id获取订单信息</span></span><br><span class="line">    <span class="title function_">asyncData</span>(<span class="params">&#123;params, error&#125;</span>) &#123;<span class="comment">//异步调用取值</span></span><br><span class="line">        <span class="keyword">return</span> orderApi.<span class="title function_">getById</span>(params.<span class="property">oid</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">order</span>: response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">item</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">//点击去支付，跳转到支付页面</span></span><br><span class="line">        <span class="title function_">toPay</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/pay/&#x27;</span> + <span class="variable language_">this</span>.<span class="property">order</span>.<span class="property">orderNo</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>创建支付页面，生成二维码完成支付</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">import</span> orderApi <span class="keyword">from</span> <span class="string">&#x27;@/api/course&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//根据订单id生成微信支付二维码</span></span><br><span class="line">    <span class="title function_">asyncData</span>(<span class="params">&#123;params, error&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> orderApi.<span class="title function_">createNative</span>(params.<span class="property">pid</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">payObj</span>: response.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">timer</span>: <span class="literal">null</span>, <span class="comment">// 定时器名称</span></span><br><span class="line">            <span class="attr">initQCode</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">timer1</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">//在页面渲染之后执行</span></span><br><span class="line">        <span class="comment">//每隔三秒，去查询一次支付状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timer1</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">queryPayStatus</span>(<span class="variable language_">this</span>.<span class="property">payObj</span>.<span class="property">out_trade_no</span>)</span><br><span class="line">        &#125;, <span class="number">3000</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">//查询支付状态的方法</span></span><br><span class="line">        <span class="title function_">queryPayStatus</span>(<span class="params">out_trade_no</span>) &#123;</span><br><span class="line">            orderApi.<span class="title function_">queryPayStatus</span>(out_trade_no).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">success</span>) &#123;</span><br><span class="line">                    <span class="comment">//如果支付成功，清除定时器，（如果不清楚定时器，定时器不管在哪个页面都仍然会运行，直到前端所在的服务器停止）</span></span><br><span class="line">                    <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timer1</span>)</span><br><span class="line">                    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                        <span class="attr">message</span>: <span class="string">&#x27;支付成功!&#x27;</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                    <span class="comment">//跳转到课程详情页面观看视频</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/course/&#x27;</span> + <span class="variable language_">this</span>.<span class="property">payObj</span>.<span class="property">course_id</span>&#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，这里用了两次动态路由</p>
<p><img src="/../pic/image-20221016233142444.png" alt="image-20221016233142444">，都是根据id进行跳转的，所以都可以使用动态路由</p>
<h1 id="Day16"><a href="#Day16" class="headerlink" title="Day16"></a>Day16</h1><h2 id="统计分析模块"><a href="#统计分析模块" class="headerlink" title="统计分析模块"></a>统计分析模块</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#首先介绍一个函数</span><br><span class="line">#<span class="type">Date</span>函数,<span class="type">Date</span>函数用来获取时间格式里面的日期部分</span><br><span class="line">#比如查询<span class="number">2020</span><span class="number">-03</span><span class="number">-09</span>有多少创建人数人</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> <span class="type">date</span>(member.gmt_create)<span class="operator">=</span>‘<span class="number">2020</span><span class="number">-03</span><span class="number">-09</span>’;</span><br></pre></td></tr></table></figure>

<p>统计在线教育项目中，没一天有多少注册人数</p>
<p>把统计出来的注册人数，使用图表显示出来</p>
<h3 id="后端实现服务"><a href="#后端实现服务" class="headerlink" title="后端实现服务"></a>后端实现服务</h3><p><code>在service_ucenter模块创建接口，统计某一天的注册人数</code></p>
<p>controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;countregister/&#123;day&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">registerCount</span><span class="params">( <span class="meta">@PathVariable</span> String day)</span>&#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> memberService.countRegisterByDay(day);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;countRegister&quot;</span>, count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">countRegisterByDay</span><span class="params">(String day)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> baseMapper.selectRegisterCount(day);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectRegisterCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">    SELECT COUNT(1)</span><br><span class="line">    FROM ucenter_member</span><br><span class="line">    WHERE DATE(gmt_create) = #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>在service_statistics模块调用微服务</code>(这个调用的是上面查某一天注册人数的接口)</p>
<p>controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;&#123;day&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">createStatisticsByDate</span><span class="params">(<span class="meta">@PathVariable</span> String day)</span> &#123;</span><br><span class="line">    dailyService.createStatisticsByDay(day);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatisticsDailyServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;StatisticsDailyMapper,StatisticsDaily&gt; <span class="keyword">implements</span> <span class="title class_">StatisticsDailyService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UcenterClient ucenterClient;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createStatisticsByDay</span><span class="params">(String day)</span> &#123;</span><br><span class="line">        <span class="comment">//删除已存在的统计对象</span></span><br><span class="line">        QueryWrapper&lt;StatisticsDaily&gt; dayQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        dayQueryWrapper.eq(<span class="string">&quot;date_calculated&quot;</span>, day);</span><br><span class="line">        baseMapper.delete(dayQueryWrapper);</span><br><span class="line">        <span class="comment">//获取统计信息</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">registerNum</span> <span class="operator">=</span> (Integer)ucenterClient.registerCount(day).getData().get(<span class="string">&quot;countRegister&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">loginNum</span> <span class="operator">=</span> RandomUtils.nextInt(<span class="number">100</span>, <span class="number">200</span>);<span class="comment">//TODO下面三个都是虚拟数据，模拟的数据</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">videoViewNum</span> <span class="operator">=</span> RandomUtils.nextInt(<span class="number">100</span>, <span class="number">200</span>);<span class="comment">//TODO</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">courseNum</span> <span class="operator">=</span> RandomUtils.nextInt(<span class="number">100</span>, <span class="number">200</span>);<span class="comment">//TODO</span></span><br><span class="line">        <span class="comment">//创建统计对象</span></span><br><span class="line">        <span class="type">StatisticsDaily</span> <span class="variable">daily</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StatisticsDaily</span>();</span><br><span class="line">        daily.setRegisterNum(registerNum);</span><br><span class="line">        daily.setLoginNum(loginNum);</span><br><span class="line">        daily.setVideoViewNum(videoViewNum);</span><br><span class="line">        daily.setCourseNum(courseNum);</span><br><span class="line">        daily.setDateCalculated(day);</span><br><span class="line">        baseMapper.insert(daily);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h3><p>生成cron表达式</p>
<p><a target="_blank" rel="noopener" href="https://cron.qqe2.com/">在线Cron表达式生成器 (qqe2.com)</a></p>
<p>定时任务的意思是在固定的时候自动执行程序</p>
<ol>
<li>创建定时任务类，使用cron表达式</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledTask</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StatisticsDailyService dailyService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 每天凌晨1点执行定时</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">task2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//获取上一天的日期</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">day</span> <span class="operator">=</span> DateUtil.formatDate(DateUtil.addDays(<span class="keyword">new</span> <span class="title class_">Date</span>(), -<span class="number">1</span>));</span><br><span class="line">        dailyService.createStatisticsByDay(day);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在启动类上加上注解</li>
</ol>
<p><img src="/../pic/image-20221018095833547.png" alt="image-20221018095833547"></p>
<h3 id="前端页面实现"><a href="#前端页面实现" class="headerlink" title="前端页面实现"></a>前端页面实现</h3><p>创建api</p>
<p>创建src&#x2F;api&#x2F;sta.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/admin/statistics/daily&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">createStatistics</span>(<span class="params">day</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/<span class="subst">$&#123;day&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>增加路由</p>
<p>src&#x2F;router&#x2F;index.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/statistics/daily&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">            <span class="attr">redirect</span>: <span class="string">&#x27;/statistics/daily/create&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;Statistics&#x27;</span>,</span><br><span class="line">                    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;统计分析&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;chart&#x27;</span> &#125;,</span><br><span class="line">                        <span class="attr">children</span>: [</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">path</span>: <span class="string">&#x27;create&#x27;</span>,</span><br><span class="line">                                <span class="attr">name</span>: <span class="string">&#x27;StatisticsDailyCreate&#x27;</span>,</span><br><span class="line">                                <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/statistics/daily/create&#x27;</span>),</span><br><span class="line">                                <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;生成统计&#x27;</span> &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>创建组件</p>
<p>src&#x2F;views&#x2F;statistics&#x2F;daily&#x2F;create.vue 模板部分</p>
<p>这个是element-ui的组件，直接粘贴即用</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--表单--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:inline</span>=<span class="string">&quot;true&quot;</span> <span class="attr">class</span>=<span class="string">&quot;demo-form-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;日期&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-date-picker</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">v-model</span>=<span class="string">&quot;day&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">type</span>=<span class="string">&quot;date&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">placeholder</span>=<span class="string">&quot;选择要统计的日期&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">value-format</span>=<span class="string">&quot;yyyy-MM-dd&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">:disabled</span>=<span class="string">&quot;btnDisabled&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">                       @<span class="attr">click</span>=<span class="string">&quot;create()&quot;</span>&gt;</span>生成<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>script部分</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">import</span> daily <span class="keyword">from</span> <span class="string">&#x27;@/api/sta&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">day</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">btnDisabled</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">btnDisabled</span> = <span class="literal">true</span></span><br><span class="line">            daily.<span class="title function_">createStatistics</span>(<span class="variable language_">this</span>.<span class="property">day</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">btnDisabled</span> = <span class="literal">false</span></span><br><span class="line">                <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                    <span class="attr">message</span>: <span class="string">&#x27;生成成功&#x27;</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="前端集成ECharts"><a href="#前端集成ECharts" class="headerlink" title="前端集成ECharts"></a>前端集成ECharts</h3><p>安装ECharts</p>
<p><code>npm install --save echarts@4.1.0</code></p>
<p>增加路由</p>
<p>src&#x2F;router&#x2F;index.js 在统计分析路由中增加子路由</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;chart&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;StatisticsDayChart&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/statistics/daily/chart&#x27;</span>),</span><br><span class="line">                <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;统计图表&#x27;</span> &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建组件</p>
<p>src&#x2F;views&#x2F;statistics&#x2F;daily&#x2F;chart.vue</p>
<p>模板</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--表单--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:inline</span>=<span class="string">&quot;true&quot;</span> <span class="attr">class</span>=<span class="string">&quot;demo-form-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;searchObj.type&quot;</span> <span class="attr">clearable</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;学员登录数统计&quot;</span> <span class="attr">value</span>=<span class="string">&quot;login_num&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;学员注册数统计&quot;</span> <span class="attr">value</span>=<span class="string">&quot;register_num&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;课程播放数统计&quot;</span> <span class="attr">value</span>=<span class="string">&quot;video_view_num&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;每日课程数统计&quot;</span> <span class="attr">value</span>=<span class="string">&quot;course_num&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-date-picker</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">v-model</span>=<span class="string">&quot;searchObj.begin&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">type</span>=<span class="string">&quot;date&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">placeholder</span>=<span class="string">&quot;选择开始日期&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">value-format</span>=<span class="string">&quot;yyyy-MM-dd&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-date-picker</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">v-model</span>=<span class="string">&quot;searchObj.end&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">type</span>=<span class="string">&quot;date&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">placeholder</span>=<span class="string">&quot;选择截止日期&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">value-format</span>=<span class="string">&quot;yyyy-MM-dd&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">:disabled</span>=<span class="string">&quot;btnDisabled&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">icon</span>=<span class="string">&quot;el-icon-search&quot;</span></span></span><br><span class="line"><span class="tag">                       @<span class="attr">click</span>=<span class="string">&quot;showChart()&quot;</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chart-container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;chart&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height:500px;width:100%&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>js：暂时显示临时数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">import</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">searchObj</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">begin</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">end</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">btnDisabled</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">chart</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">xData</span>: [],</span><br><span class="line">            <span class="attr">yData</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="title function_">showChart</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">initChartData</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setChart</span>()</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 准备图表数据</span></span><br><span class="line">        <span class="title function_">initChartData</span>(<span class="params"></span>) &#123;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 设置图标参数</span></span><br><span class="line">        <span class="title function_">setChart</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">chart</span> = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chart&#x27;</span>))</span><br><span class="line">            <span class="comment">// console.log(this.chart)</span></span><br><span class="line">            <span class="comment">// 指定图表的配置项和数据</span></span><br><span class="line">            <span class="keyword">var</span> option = &#123;</span><br><span class="line">                <span class="comment">// x轴是类目轴（离散数据）,必须通过data设置类目数据</span></span><br><span class="line">                <span class="attr">xAxis</span>: &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">                    <span class="attr">data</span>: [<span class="string">&#x27;Mon&#x27;</span>, <span class="string">&#x27;Tue&#x27;</span>, <span class="string">&#x27;Wed&#x27;</span>, <span class="string">&#x27;Thu&#x27;</span>, <span class="string">&#x27;Fri&#x27;</span>, <span class="string">&#x27;Sat&#x27;</span>, <span class="string">&#x27;Sun&#x27;</span>]</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// y轴是数据轴（连续数据）</span></span><br><span class="line">                <span class="attr">yAxis</span>: &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// 系列列表。每个系列通过 type 决定自己的图表类型</span></span><br><span class="line">                <span class="attr">series</span>: [&#123;</span><br><span class="line">                    <span class="comment">// 系列中的数据内容数组</span></span><br><span class="line">                    <span class="attr">data</span>: [<span class="number">820</span>, <span class="number">932</span>, <span class="number">901</span>, <span class="number">934</span>, <span class="number">1290</span>, <span class="number">1330</span>, <span class="number">1320</span>],</span><br><span class="line">                    <span class="comment">// 折线图</span></span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span></span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">chart</span>.<span class="title function_">setOption</span>(option)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="完成后端业务"><a href="#完成后端业务" class="headerlink" title="完成后端业务"></a>完成后端业务</h3><p>controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;show-chart/&#123;begin&#125;/&#123;end&#125;/&#123;type&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">showChart</span><span class="params">(<span class="meta">@PathVariable</span> String begin,<span class="meta">@PathVariable</span> String end,<span class="meta">@PathVariable</span> String type)</span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; map = dailyService.getChartData(begin, end, type);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getChartData</span><span class="params">(String begin, String end, String type)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;Daily&gt; dayQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    dayQueryWrapper.select(type, <span class="string">&quot;date_calculated&quot;</span>);</span><br><span class="line">    dayQueryWrapper.between(<span class="string">&quot;date_calculated&quot;</span>, begin, end);</span><br><span class="line">    List&lt;Daily&gt; dayList = baseMapper.selectList(dayQueryWrapper);</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; dataList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">    List&lt;String&gt; dateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;dataList&quot;</span>, dataList);</span><br><span class="line">    map.put(<span class="string">&quot;dateList&quot;</span>, dateList);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; dayList.size(); i++) &#123;</span><br><span class="line">        <span class="type">Daily</span> <span class="variable">daily</span> <span class="operator">=</span> dayList.get(i);</span><br><span class="line">        dateList.add(daily.getDateCalculated());</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;register_num&quot;</span>:</span><br><span class="line">                dataList.add(daily.getRegisterNum());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;login_num&quot;</span>:</span><br><span class="line">                dataList.add(daily.getLoginNum());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;video_view_num&quot;</span>:</span><br><span class="line">                dataList.add(daily.getVideoViewNum());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;course_num&quot;</span>:</span><br><span class="line">                dataList.add(daily.getCourseNum());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前后端整合</p>
<p>创建api</p>
<p>src&#x2F;api&#x2F;statistics&#x2F;daily.js中添加方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">showChart</span>(<span class="params">searchObj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/show-chart/<span class="subst">$&#123;searchObj.begin&#125;</span>/<span class="subst">$&#123;searchObj.end&#125;</span>/<span class="subst">$&#123;searchObj.type&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>chart.vue中引入api模块</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import daily from &#x27;@/api/statistics/daily&#x27;</span><br></pre></td></tr></table></figure>

<p>修改initChartData方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">showChart</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initChartData</span>()</span><br><span class="line">    <span class="comment">// this.setChart()//放在initChartData回调中执行</span></span><br><span class="line">&#125;,</span><br><span class="line">    <span class="comment">// 准备图表数据</span></span><br><span class="line">    <span class="title function_">initChartData</span>(<span class="params"></span>) &#123;</span><br><span class="line">        daily.<span class="title function_">showChart</span>(<span class="variable language_">this</span>.<span class="property">searchObj</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 数据</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">yData</span> = response.<span class="property">data</span>.<span class="property">dataList</span></span><br><span class="line">            <span class="comment">// 横轴时间</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">xData</span> = response.<span class="property">data</span>.<span class="property">dateList</span></span><br><span class="line">            <span class="comment">// 当前统计类别</span></span><br><span class="line">            <span class="keyword">switch</span> (<span class="variable language_">this</span>.<span class="property">searchObj</span>.<span class="property">type</span>) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;register_num&#x27;</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&#x27;学员注册数统计&#x27;</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;login_num&#x27;</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&#x27;学员登录数统计&#x27;</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;video_view_num&#x27;</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&#x27;课程播放数统计&#x27;</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;course_num&#x27;</span>:</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&#x27;每日课程数统计&#x27;</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setChart</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>修改options中的数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">xAxis</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">xData</span><span class="comment">//-------绑定数据</span></span><br><span class="line">&#125;,</span><br><span class="line">    <span class="comment">// y轴是数据轴（连续数据）</span></span><br><span class="line">    <span class="attr">yAxis</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">        <span class="comment">// 系列列表。每个系列通过 type 决定自己的图表类型</span></span><br><span class="line">        <span class="attr">series</span>: [&#123;</span><br><span class="line">            <span class="comment">// 系列中的数据内容数组</span></span><br><span class="line">            <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">yData</span>,<span class="comment">//-------绑定数据</span></span><br><span class="line">            <span class="comment">// 折线图</span></span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span></span><br><span class="line">        &#125;],</span><br></pre></td></tr></table></figure>

<h1 id="Day17"><a href="#Day17" class="headerlink" title="Day17"></a>Day17</h1><h2 id="Canal"><a href="#Canal" class="headerlink" title="Canal"></a>Canal</h2><h3 id="Canal介绍"><a href="#Canal介绍" class="headerlink" title="Canal介绍"></a>Canal介绍</h3><p>在前面的统计分析功能中，我们采取了<strong>服务调用</strong>获取统计数据，这样耦合度高，效率相对较低，目前我们采取另一种实现方式，通过<strong>实时同步数据库表</strong>的方式实现，</p>
<p>例如我们要统计每天注册与登录人数，我们只需把会员表同步到统计库中，实现本地统计就可以了。</p>
<p>这样效率更高，耦合度更低，Canal就是一个很好的数据库同步工具。</p>
<p>canal是阿里巴巴旗下 的一款开源项目，纯Java开发。基于数据库增量日志解析，提供增量数据订阅&amp;消费，目前主要支持了MySQL。</p>
<h3 id="Canal环境搭建"><a href="#Canal环境搭建" class="headerlink" title="Canal环境搭建"></a>Canal环境搭建</h3><p>canal的原理是基于mysql binlog技术，所以这里一定需要开启mysql的binlog写入功能</p>
<p>开启mysql服务：<code> service mysql start</code></p>
<p>（1）检查binlog功能是否有开启</p>
<p><code>show variables like &#39;log_bin&#39;;</code></p>
<p>（2）如果显示状态为OFF表示该功能未开启，开启binlog功能</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>，修改 mysql 的配置文件 my.cnf</span><br><span class="line">vi <span class="operator">/</span>etc<span class="operator">/</span>my.cnf</span><br><span class="line">追加内容：</span><br><span class="line">log<span class="operator">-</span>bin<span class="operator">=</span>mysql<span class="operator">-</span>bin #binlog文件名</span><br><span class="line">binlog_format<span class="operator">=</span><span class="type">ROW</span> #选择<span class="type">row</span>模式</span><br><span class="line">server_id<span class="operator">=</span><span class="number">1</span> #mysql实例id,不能和canal的slaveId重复</span><br><span class="line"><span class="number">2</span>，重启 mysql：</span><br><span class="line">service mysql restart</span><br><span class="line"><span class="number">3</span>，登录 mysql 客户端，查看 log_bin 变量</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_bin&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> log_bin <span class="operator">|</span> <span class="keyword">ON</span><span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">————————————————</span><br><span class="line">如果显示状态为<span class="keyword">ON</span>表示该功能已开启</span><br></pre></td></tr></table></figure>

<p>（3）在mysql里面添加以下的相关用户和权限</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;canal&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">SELECT</span>, REPLICATION SLAVE, REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span></span><br><span class="line"><span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<h3 id="下载安装Canal服务"><a href="#下载安装Canal服务" class="headerlink" title="下载安装Canal服务"></a>下载安装Canal服务</h3><p>下载地址：<br><a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/releases">https://github.com/alibaba/canal/releases</a><br>（1）下载之后，放到目录中，解压文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/canal</span><br><span class="line">canal.deployer-1.1.4.tar.gz</span><br><span class="line">tar zxvf canal.deployer-1.1.4.tar.gz</span><br></pre></td></tr></table></figure>

<p>（2）修改配置文件 vi conf&#x2F;example&#x2F;instance.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#需要改成自己的数据库信息</span></span><br><span class="line"><span class="attr">canal.instance.master.address</span>=<span class="string">192.168.44.132:3306</span></span><br><span class="line"><span class="comment">#需要改成自己的数据库用户名与密码</span></span><br><span class="line"><span class="attr">canal.instance.dbUsername</span>=<span class="string">canal</span></span><br><span class="line"><span class="attr">canal.instance.dbPassword</span>=<span class="string">canal</span></span><br><span class="line"><span class="comment">#需要改成同步的数据库表规则，例如只是同步一下表</span></span><br><span class="line"><span class="comment">#canal.instance.filter.regex=.*\\..*</span></span><br><span class="line"><span class="attr">canal.instance.filter.regex</span>=<span class="string">guli_ucenter.ucenter_member</span></span><br></pre></td></tr></table></figure>

<p><img src="/../pic/image-20221018160414722.png" alt="image-20221018160414722"></p>
<p>（3）进入bin目录下启动 </p>
<p><code>sh bin/startup.sh</code></p>
<h3 id="使用Cannal"><a href="#使用Cannal" class="headerlink" title="使用Cannal"></a>使用Cannal</h3><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.otter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal.client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>、创建application.properties配置文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#服务端口</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">10000</span></span><br><span class="line"><span class="comment"># 服务名</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">canal-client</span></span><br><span class="line"><span class="comment"># 环境设置：dev、test、prod</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"># mysql数据库连接</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p>编写canal客户端类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CanalClient</span> &#123;</span><br><span class="line">    <span class="comment">//sql队列</span></span><br><span class="line">    <span class="keyword">private</span> Queue&lt;String&gt; SQL_QUEUE = <span class="keyword">new</span> <span class="title class_">ConcurrentLinkedQueue</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* canal入库方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CanalConnector</span> <span class="variable">connector</span> <span class="operator">=</span> CanalConnectors.newSingleConnector(<span class="keyword">new</span></span><br><span class="line">                                                                      <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;192.168.44.132&quot;</span>,</span><br><span class="line">                                                                                        <span class="number">11111</span>), <span class="string">&quot;example&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connector.connect();</span><br><span class="line">            connector.subscribe(<span class="string">&quot;.*\\..*&quot;</span>);</span><br><span class="line">            connector.rollback();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                    <span class="comment">//尝试从master那边拉去数据batchSize条记录，有多少取多少</span></span><br><span class="line">                    <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> connector.getWithoutAck(batchSize);</span><br><span class="line">                    <span class="type">long</span> <span class="variable">batchId</span> <span class="operator">=</span> message.getId();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> message.getEntries().size();</span><br><span class="line">                    <span class="keyword">if</span> (batchId == -<span class="number">1</span> || size == <span class="number">0</span>) &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        dataHandle(message.getEntries());</span><br><span class="line">                    &#125;</span><br><span class="line">                    connector.ack(batchId);</span><br><span class="line">                    <span class="comment">//当队列里面堆积的sql大于一定数值的时候就模拟执行</span></span><br><span class="line">                    <span class="keyword">if</span> (SQL_QUEUE.size() &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">                        executeQueueSql();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            connector.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 模拟执行队列里面的sql语句</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeQueueSql</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> SQL_QUEUE.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> SQL_QUEUE.poll();</span><br><span class="line">            System.out.println(<span class="string">&quot;[sql]----&gt; &quot;</span> + sql);</span><br><span class="line">            <span class="built_in">this</span>.execute(sql.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 数据处理</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> entrys</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dataHandle</span><span class="params">(List&lt;Entry&gt; entrys)</span> <span class="keyword">throws</span></span><br><span class="line">        InvalidProtocolBufferException &#123;</span><br><span class="line">        <span class="keyword">for</span> (Entry entry : entrys) &#123;</span><br><span class="line">            <span class="keyword">if</span> (EntryType.ROWDATA == entry.getEntryType()) &#123;</span><br><span class="line">                <span class="type">RowChange</span> <span class="variable">rowChange</span> <span class="operator">=</span> RowChange.parseFrom(entry.getStoreValue());</span><br><span class="line">                <span class="type">EventType</span> <span class="variable">eventType</span> <span class="operator">=</span> rowChange.getEventType();</span><br><span class="line">                <span class="keyword">if</span> (eventType == EventType.DELETE) &#123;</span><br><span class="line">                    saveDeleteSql(entry);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (eventType == EventType.UPDATE) &#123;</span><br><span class="line">                    saveUpdateSql(entry);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (eventType == EventType.INSERT) &#123;</span><br><span class="line">                    saveInsertSql(entry);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存更新语句</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> entry</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveUpdateSql</span><span class="params">(Entry entry)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">RowChange</span> <span class="variable">rowChange</span> <span class="operator">=</span> RowChange.parseFrom(entry.getStoreValue());</span><br><span class="line">            List&lt;RowData&gt; rowDatasList = rowChange.getRowDatasList();</span><br><span class="line">            <span class="keyword">for</span> (RowData rowData : rowDatasList) &#123;</span><br><span class="line">                List&lt;Column&gt; newColumnList = rowData.getAfterColumnsList();</span><br><span class="line">                <span class="type">StringBuffer</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;update &quot;</span> +</span><br><span class="line">                                                    entry.getHeader().getTableName() + <span class="string">&quot; set &quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; newColumnList.size(); i++) &#123;</span><br><span class="line">                    sql.append(<span class="string">&quot; &quot;</span> + newColumnList.get(i).getName()</span><br><span class="line">                               + <span class="string">&quot; = &#x27;&quot;</span> + newColumnList.get(i).getValue() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (i != newColumnList.size() - <span class="number">1</span>) &#123;</span><br><span class="line">                        sql.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                sql.append(<span class="string">&quot; where &quot;</span>);</span><br><span class="line">                List&lt;Column&gt; oldColumnList = rowData.getBeforeColumnsList();</span><br><span class="line">                <span class="keyword">for</span> (Column column : oldColumnList) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (column.getIsKey()) &#123;</span><br><span class="line">                        <span class="comment">//暂时只支持单一主键</span></span><br><span class="line">                        sql.append(column.getName() + <span class="string">&quot;=&quot;</span> + column.getValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                SQL_QUEUE.add(sql.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存删除语句</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> entry</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveDeleteSql</span><span class="params">(Entry entry)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">RowChange</span> <span class="variable">rowChange</span> <span class="operator">=</span> RowChange.parseFrom(entry.getStoreValue());</span><br><span class="line">            List&lt;RowData&gt; rowDatasList = rowChange.getRowDatasList();</span><br><span class="line">            <span class="keyword">for</span> (RowData rowData : rowDatasList) &#123;</span><br><span class="line">                List&lt;Column&gt; columnList = rowData.getBeforeColumnsList();</span><br><span class="line">                <span class="type">StringBuffer</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;delete from &quot;</span> +</span><br><span class="line">                                                    entry.getHeader().getTableName() + <span class="string">&quot; where &quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (Column column : columnList) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (column.getIsKey()) &#123;</span><br><span class="line">                        <span class="comment">//暂时只支持单一主键</span></span><br><span class="line">                        sql.append(column.getName() + <span class="string">&quot;=&quot;</span> + column.getValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                SQL_QUEUE.add(sql.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存插入语句</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> entry</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveInsertSql</span><span class="params">(Entry entry)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">RowChange</span> <span class="variable">rowChange</span> <span class="operator">=</span> RowChange.parseFrom(entry.getStoreValue());</span><br><span class="line">            List&lt;RowData&gt; rowDatasList = rowChange.getRowDatasList();</span><br><span class="line">            <span class="keyword">for</span> (RowData rowData : rowDatasList) &#123;</span><br><span class="line">                List&lt;Column&gt; columnList = rowData.getAfterColumnsList();</span><br><span class="line">                <span class="type">StringBuffer</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;insert into &quot;</span> +</span><br><span class="line">                                                    entry.getHeader().getTableName() + <span class="string">&quot; (&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; columnList.size(); i++) &#123;</span><br><span class="line">                    sql.append(columnList.get(i).getName());</span><br><span class="line">                    <span class="keyword">if</span> (i != columnList.size() - <span class="number">1</span>) &#123;</span><br><span class="line">                        sql.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                sql.append(<span class="string">&quot;) VALUES (&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; columnList.size(); i++) &#123;</span><br><span class="line">                    sql.append(<span class="string">&quot;&#x27;&quot;</span> + columnList.get(i).getValue() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (i != columnList.size() - <span class="number">1</span>) &#123;</span><br><span class="line">                        sql.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                sql.append(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">                SQL_QUEUE.add(sql.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 入库</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(String sql)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">con</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> == sql) <span class="keyword">return</span>;</span><br><span class="line">            con = dataSource.getConnection();</span><br><span class="line">            <span class="type">QueryRunner</span> <span class="variable">qr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> qr.execute(con, sql);</span><br><span class="line">            System.out.println(<span class="string">&quot;update: &quot;</span>+ row);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.closeQuietly(con);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建启动类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CanalApplication</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CanalClient canalClient;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(CanalApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... strings)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//项目启动，执行canal客户端监听</span></span><br><span class="line">        canalClient.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><p>需要五张表，五张表的关系如下</p>
<p><img src="/../pic/image-20221019085810286.png" alt="image-20221019085810286"></p>
<p>根据第三范可知，如果是两张表互为多对多的关系，需要多新建一张表来存储多对多的这种关系</p>
<p>菜单管理</p>
<p>（1）菜单列表</p>
<p>（2）菜单添加、修改</p>
<p>（3）菜单删除功能</p>
<p>角色管理（管理员..等等）</p>
<p>（1）角色的CRUD</p>
<p>（2）为角色分配菜单</p>
<p>用户管理(haohao…)</p>
<p>（1）用户的CRUD</p>
<p>   (2)为用户分配角色</p>
<h1 id="Day18"><a href="#Day18" class="headerlink" title="Day18"></a>Day18</h1><h2 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h2><p>Spring 是一个非常流行和成功的 Java 应用开发框架。Spring Security 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。一般来说，Web 应用的安全性包括<strong>用户认证（Authentication）</strong>和<strong>用户授权（Authorization）</strong>两个部分。</p>
<blockquote>
<p>用户认证：</p>
<p>进入用户登录的时候，输入用户名和密码，查询数据库，验证用户名和密码是否正确，如果正确的话，认证就成功了</p>
<p>用户授权：</p>
<p>登录了系统，登录用户可能为不同的角色。比如可能是管理员，管理员所可以操作的功能要比普通用户多</p>
</blockquote>
<p><strong>Spring Security其实就是用filter</strong>，多请求的路径进行过滤。</p>
<p> （1）如果是基于Session，那么Spring-security会对cookie里的sessionid进行解析，找到服务器存储 的session信息，然后判断当前用户是否符合请求的要求。 </p>
<p>（2）如果是token，则是解析出token，然后将当前请求加入到Spring-security管理的权限信息中去</p>
<h3 id="认证与授权实现思路"><a href="#认证与授权实现思路" class="headerlink" title="认证与授权实现思路"></a>认证与授权实现思路</h3><p>如果系统的模块众多，每个模块都需要就行授权与认证，所以我们选择基于token的形式进行授权与认证，用户根据用户名密码认证成功，然后获取当前用户角色的一系列权限值，并以用户名为key，权限列表为value的形式存入redis缓存中，根据用户名相关信息生成token返回，浏览器将token记录到cookie中， 每次调用api接口都默认将token携带到header请求头中，Spring-security解析header头获取token信息，解 析token获取当前用户名，根据用户名就可以从redis中获取权限列表，这样Spring-security就能够判断当前 请求是否有权限访问</p>
<p><img src="/../pic/image-20221021150624911.png" alt="image-20221021150624911"></p>
<hr>
<p><img src="/../pic/image-20221021163459989.png" alt="image-20221021163459989"></p>
<p>1、项目描述<br>（1）<br>在线教育系统，分为前台网站系统和后台运营平台，B2C模式。<br>前台用户系统包括课程、讲师、问答、文章几大大部分，使用了微服务技术架构，前后端分离开发。<br>后端的主要技术架构是：SpringBoot + SpringCloud + MyBatis-Plus + HttpClient + MySQL +<br>Maven+EasyExcel+ nginx<br>前端的架构是：Node.js + Vue.js +element-ui+NUXT+ECharts<br>其他涉及到的中间件包括Redis、阿里云OSS、阿里云视频点播<br>业务中使用了ECharts做图表展示，使用EasyExcel完成分类批量添加、注册分布式单点登录使用了JWT<br>（2）<br>项目前后端分离开发，后端采用SpringCloud微服务架构，持久层用的是MyBatis-Plus，微服务分库设<br>计，使用Swagger生成接口文档<br>接入了阿里云视频点播、阿里云OSS。<br>系统分为前台用户系统和后台管理系统两部分。<br>前台用户系统包括：首页、课程、名师、问答、文章。<br>后台管理系统包括：讲师管理、课程分类管理、课程管理、统计分析、Banner管理、订单管理、权限管<br>理等功能。<br>在线教育计费案例：<br>小A是一名杭州的创业者，带领团队研发了一个在线教育平台。他希望把视频托管在阿里云上，存量视频大约1000个，<br>占用存储空间近1T，每月预计新增视频100个，并新增存储约100G，课程视频的时长集中在20-40分钟，并且按照不同课<br>程进行分类管理。为了保障各端的观看效果，计划为用户提供“标清480P”和“高清720P”两种清晰度。目前已有用<br>户400人左右，每日平均视频观看次数1000次，在移动端和PC端观看次数比例大致为3:1。<br>2、这是一个项目还是一个产品<br>这是一个产品<br>1.0版本是单体应用：SSM<br>2.0版本加入了SpringCloud，将一些关键业务和访问量比较大的部分分离了出去<br>目前独立出来的服务有教学服务、视频点播服务、用户服务、统计分析服务、网关服务<br>3、测试要求<br>首页和视频详情页qps单机qps要求 2000+<br>经常用每秒查询率来衡量域名系统服务器的机器的性能，其即为QPS<br>QPS &#x3D; 并发量 &#x2F; 平均响应时间<br>4、企业中的项目（产品）开发流程<br>一个中大型项目的开发流程<br>1、需求调研（产品经理）<br>2、需求评审（产品&#x2F;设计&#x2F;前端&#x2F;后端&#x2F;测试&#x2F;运营）<br>3、立项（项目经理、品管）<br>4、UI设计<br>5、开发<br>架构、数据库设计、API文档、MOCK数据、开发、单元测试<br>前端<br>后端<br>6、前端后端联调<br>7、项目提测：黑盒白盒、压力测试（qps） loadrunner<br>8、bug修改<br>9、回归测试<br>10、运维和部署上线<br>11、灰度发布<br>12、全量发布<br>13、维护和运营<br>5、系统中都有那些角色？数据库是怎么设计的？<br>前台：会员（学员）<br>后台：系统管理员、运营人员<br>后台分库，每个微服务一个独立的数据库，使用了分布式id生成器<br>6、视频点播是怎么实现的（流媒体你们是怎么实现的）<br>我们直接接入了阿里云的云视频点播。云平台上的功能包括视频上传、转码、加密、智能审核、监控统<br>计等。<br>还包括视频播放功能，阿里云还提供了一个视频播放器。<br>7、前后端联调经常遇到的问题：<br> 1、请求方式post、get<br> 2、json、x-wwww-form-urlencoded混乱的错误<br> 3、后台必要的参数，前端省略了<br> 4、数据类型不匹配<br> 5、空指针异常<br> 6、分布式系统中分布式id生成器生成的id 长度过大（19个字符长度的整数），js无法解析（js智能解<br>析16个长度：2的53次幂）<br> id策略改成 ID_WORKER_STR<br>8、前后端分离项目中的跨域问题是如何解决的<br>后端服务器配置：我们的项目中是通过Spring注解解决跨域的 @CrossOrigin<br>也可以使用nginx反向代理、httpClient、网关<br>9、说说你做了哪个部分、遇到了什么问题、怎么解决的<br>问题1：<br>分布式id生成器在前端无法处理，总是在后三位进行四舍五入。<br>分布式id生成器生成的id是19个字符的长度，前端javascript脚本对整数的处理能力只有2的53次方，也就<br>是最多只能处理16个字符<br>解决的方案是把id在程序中设置成了字符串的性质<br>问题2：<br>项目迁移到Spring-Cloud的时候，经过网关时，前端传递的cookie后端一只获取不了，看<br>了cloud中zuul的源码，发现向下游传递数据的时候，zull默认过滤了敏感信息，将cookie过滤掉了<br>解决的方案是在配置文件中将请求头的过滤清除掉，使cookie可以向下游传递<br>问题3…….<br>10、分布式系统的id生成策略<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/haoxinyue/p/5208136.html">https://www.cnblogs.com/haoxinyue/p/5208136.html</a><br>11、项目组有多少人，人员如何组成？<br>12、分布式系统的CAP原理<br>CAP定理：<br>指的是在一个分布式系统中，Consistency（一致性）、 Availability（可用性）、Partition tolerance（分<br>区容错性），三者不可同时获得。<br>一致性（C）：在分布式系统中的所有数据备份，在同一时刻是否同样的值。（所有节点在同一时间的<br>数据完全一致，越多节点，数据同步越耗时）<br>可用性（A）：负载过大后，集群整体是否还能响应客户端的读写请求。（服务一直可用，而且是正常响<br>应时间）<br>分区容错性（P）：分区容错性，就是高可用性，一个节点崩了，并不影响其它的节点（100个节点，挂<br>了几个，不影响服务，越多机器越好）<br>CA 满足的情况下，P不能满足的原因：<br>数据同步(C)需要时间，也要正常的时间内响应(A)，那么机器数量就要少，所以P就不满足</p>
<p>CP 满足的情况下，A不能满足的原因：<br>数据同步(C)需要时间, 机器数量也多(P)，但是同步数据需要时间，所以不能再正常时间内响应，所以A就<br>不满足<br>AP 满足的情况下，C不能满足的原因：<br>机器数量也多(P)，正常的时间内响应(A)，那么数据就不能及时同步到其他节点，所以C不满足<br>注册中心选择的原则：<br>Zookeeper：CP设计，保证了一致性，集群搭建的时候，某个节点失效，则会进行选举行的leader，或<br>者半数以上节点不可用，则无法提供服务，因此可用性没法满足<br>Eureka：AP原则，无主从节点，一个节点挂了，自动切换其他节点可以使用，去中心化<br>结论：<br>分布式系统中P,肯定要满足，所以我们只能在一致性和可用性之间进行权衡<br>如果要求一致性，则选择zookeeper，如金融行业<br>如果要求可用性，则Eureka，如教育、电商系统<br>没有最好的选择，最好的选择是根据业务场景来进行架构设计<br>13、前端渲染和后端渲染有什么区别<br>前端渲染是返回json给前端，通过javascript将数据绑定到页面上<br>后端渲染是在服务器端将页面生成直接发送给服务器，有利于SEO的优化<br>14、能画一下系统架构图吗</p>
<p><img src="/../pic/image-20221020172548853.png" alt="image-20221020172548853"></p>
<h1 id="总结在线教育项目功能点"><a href="#总结在线教育项目功能点" class="headerlink" title="总结在线教育项目功能点"></a>总结在线教育项目功能点</h1><p><strong>一、准备</strong></p>
<p>1、把后端接口启动起来</p>
<p>2、启动前端项目（前台系统和后台系统）</p>
<p><strong>二、项目后台管理系统功能</strong></p>
<p><strong>1、登录功能</strong>（SpringSecurity框架）</p>
<p><strong>2、权限管理模块</strong></p>
<p>（1）菜单管理：列表、添加、修改、删除</p>
<p>（2）角色管理</p>
<p>* 列表、添加、修改、删除、批量删除</p>
<p>* 为角色分配菜单</p>
<p>（3）用户管理</p>
<p>* 列表、添加、修改、删除、批量删除</p>
<p>* 为用户分配角色</p>
<p><strong>（4）权限管理表和关系</strong></p>
<p>*** 使用五张表**</p>
<p><img src="/../pic/wps1.jpg" alt="img"> </p>
<p><strong>3、讲师管理模块</strong></p>
<p>（1）条件查询分页列表、添加、修改、删除</p>
<p><strong>4、课程分类模块</strong></p>
<p>（1）添加课程分类</p>
<p>* 读取Excel里面课程分类数据，添加到数据库中</p>
<p>（2）课程分类列表</p>
<p>* 使用树形结构显示课程分类列表</p>
<p><strong>5、课程管理模块</strong></p>
<p>（1）课程列表功能</p>
<p><strong>（2）添加课程</strong></p>
<p>* 课程发布流程：第一步填写课程基本信息，第二步添加课程大纲（章节和小节），第三步课程信息确认，最终课程发布</p>
<p>* <strong>课程如何判断是否已经被发布了？</strong>使用status字段</p>
<p>* <strong>课程添加过程中，中途把课程停止添加，重新去添加新的课程，如何找到之前没有发布完成课程，继续进行发布？</strong> 到课程列表中根据课程状态查询未发布的课程，点击课程右边超链接把课程继续发布完成</p>
<p><strong>（3）添加小节上传课程视频</strong></p>
<p><img src="/../pic/wps2.jpg" alt="img"> </p>
<p><strong>6、统计分析模块</strong></p>
<p><strong>（1）生成统计数据</strong></p>
<p><strong>（2）统计数据图表显示</strong></p>
<p><strong>三、项目前台用户系统功能</strong></p>
<p>1、首页数据显示</p>
<p>（1）显示幻灯片功能</p>
<p>（2）显示热门课程</p>
<p>（3）显示名师</p>
<p><strong>2、注册功能</strong></p>
<p>（1）获取手机验证码</p>
<p><strong>3、登录功能</strong></p>
<p><strong>（1）普通登录和退出</strong></p>
<p>*** SSO（单点登录）**</p>
<p><img src="/../pic/wps3.jpg" alt="img"> </p>
<p>l <strong>JWT</strong></p>
<p>l 使用JWT生成token字符串</p>
<p>l JWT有三部分组成</p>
<p>l <strong>登录实现流程</strong></p>
<p>登录调用登录接口返回token字符串，把返回token字符串放到cookie里面，创建前l 端拦截器进行判断，如果cookie里面包含token字符串，把token字符串放到header里面。调用接口根据token获取用户信息，把用户信息放到cookie里面，进行显示</p>
<p><strong>（2）微信扫描登录</strong></p>
<p>l <strong>OAuth2</strong></p>
<p>l 是针对特定问题解决方案</p>
<p>l 主要有两个问题：开放系统间授权，分布式访问</p>
<p>l <strong>如何获取扫描人信息过程？</strong></p>
<p>l 扫描之后微信接口返回code（临时票据），拿着code值请求微信固定地址，得到两个值：access_token（访问凭证）和openid（微信唯一标识）,你拿着这两个值再去请求微信固定的地址，得到微信扫描人信息（比如昵称，头像等等）</p>
<p>4、名师列表功能</p>
<p>5、名师详情功能</p>
<p>6、课程列表功能</p>
<p>（1）条件查询分页列表功能</p>
<p><strong>7、课程详情页</strong></p>
<p>（1）课程信息显示（包含课程基本信息，分类，讲师，课程大纲）</p>
<p>（2）判断课程是否需要购买</p>
<p><strong>8、课程视频在线播放</strong></p>
<p><strong>9、课程支付功能（微信支付）</strong></p>
<p>（1）生成课程订单</p>
<p>（2）生成微信支付二维码</p>
<p>（3）微信最终支付</p>
<p>*** 微信支付实现流程：**</p>
<p>* 如果课程是收费课程，点击立即购买，生成课程订单</p>
<p>* 点击订单页面去支付，生成微信支付二维码</p>
<p>* 使用微信扫描支付二维码实现支付</p>
<p>* 支付之后，每隔3秒查询支付状态（是否支付成功），如果没有支付成功等待，如果支付成功之后，更新订单状态（已经支付状态），向支付记录表添加支付成功记录</p>
<h1 id="总结在线教育项目技术点（前端）"><a href="#总结在线教育项目技术点（前端）" class="headerlink" title="总结在线教育项目技术点（前端）"></a>总结在线教育项目技术点（前端）</h1><p><strong>1、在线教育项目采用前后端分离开发</strong></p>
<p><strong>2、项目使用前端技术</strong></p>
<p><strong>（1）vue</strong></p>
<p>* 基本语法</p>
<p>* 常见指令 ： v-bind  v-model  v-if  v-for  v-html</p>
<p>* 绑定事件： v-on-click  @click</p>
<p>* 生命周期：created() 页面渲染之前   mounted()页面渲染之后</p>
<p>*** ES6规范**</p>
<p><strong>（2）Element-ui</strong></p>
<p><strong>（3）nodejs</strong></p>
<p>* 是JavaScript运行环境，不需要浏览器直接运行js代码，模拟服务器效果</p>
<p><strong>（4）NPM</strong></p>
<p>* 包管理工具，类似于Maven</p>
<p>* npm命令： npm init    npm install  依赖名称</p>
<p><strong>（5）Babel</strong></p>
<p>* 转码器，可以把ES6代码转换成ES5代码</p>
<p><strong>（6）前端模块化</strong></p>
<p>* 通过一个页面或者一个js文件，调用另外一个js文件里面的方法</p>
<p>* 问题：ES6的模块化无法在Node.js中执行，需要用Babel编辑成ES5后再执行</p>
<p><strong>（6）后台系统使用vue-admin-template</strong></p>
<p>* 基于vue+Element-ui</p>
<p><strong>（7）前台系统使用Nuxt</strong></p>
<p>* 基于vue</p>
<p>* 服务器渲染技术</p>
<p><strong>（8）Echarts</strong></p>
<p>* 图表工具</p>
<h1 id="总结在线教育项目技术点（后端技术一）"><a href="#总结在线教育项目技术点（后端技术一）" class="headerlink" title="总结在线教育项目技术点（后端技术一）"></a>总结在线教育项目技术点（后端技术一）</h1><p><strong>1、项目采用微服务架构</strong></p>
<p><strong>2、SpringBoot</strong></p>
<p>（1）SpringBoot本质是就是Spring，只是快速构建Spring工程脚手架</p>
<p>（2）细节：</p>
<p>* 启动类包扫描机制</p>
<p>* 设置扫描规则 @ComponentScan(<em><strong>*“包路径”*</strong></em>)</p>
<p>* 配置类</p>
<p>（3）SpringBoot配置文件</p>
<p>* 配置文件类型：properties和yml</p>
<p>* 配置文件加载顺序：bootstrap   application   application-dev</p>
<p><strong>3、SpringCloud</strong></p>
<p>（1）是很多框架总称，使用这些框架实现微服务架构，基于SpringBoot实现</p>
<p>（2）组成框架有哪些？</p>
<p>（3）项目中，使用阿里巴巴Nacos，替代SpringCloud一些组件</p>
<p>（4）Nacos</p>
<p>* 使用Nacos作为注册中心</p>
<p>* 使用Nacos作为配置中心</p>
<p>（5）Feign</p>
<p>* 服务调用，一个微服务调用另外一个微服务，实现远程调用</p>
<p>（6）熔断器</p>
<p>（7）Gateway网关</p>
<p>* SpringCloud之前zuul网关，目前Gateway网关</p>
<p><strong>（8）版本</strong></p>
<p><img src="/../pic/wps4.jpg" alt="img"> </p>
<p><strong>4、MyBatisPlus</strong></p>
<p>（1）MyBatisPlus就是对MyBatis做增强</p>
<p>（2）自动填充</p>
<p>（3）乐观锁</p>
<p>（4）逻辑删除</p>
<p>（5）代码生成器</p>
<p><strong>5、EasyExcel</strong></p>
<p>（1）阿里巴巴提供操作excel工具，代码简洁，效率很高</p>
<p>（2）EasyExcel对poi进行封装，采用SAX方式解析</p>
<p>（3）项目应用在添加课程分类，读取excel数据</p>
<p>总结在线教育项目技术点（后端技术二）</p>
<p>1、Spring Security</p>
<p>（1）在项目整合框架实现权限管理功能</p>
<p>（2）SpringSecurity框架组成：认证和授权</p>
<p>（3）SpringSecurity登录认证过程</p>
<p><img src="/../pic/wps5.jpg" alt="img"> </p>
<p>（4）SpringSecurity代码执行过程</p>
<p>2、Redis</p>
<p>（1）首页数据通过Redis进行缓存</p>
<p>（2）Redis数据类型</p>
<p>（3）使用Redis作为缓存，不太重要或者不经常改变数据适合放到Redis作为缓存 </p>
<p>3、Nginx</p>
<p>（1）反向代理服务器</p>
<p>（2）请求转发，负载均衡，动静分离</p>
<p>4、OAuth2+JWT</p>
<p>（1）OAuth2针对特定问题解决方案</p>
<p>（2）JWT包含三部分</p>
<p>5、HttpClient</p>
<p>（1）发送请求返回响应的工具，不需要浏览器完成请求和响应的过程</p>
<p>（2）应用场景：微信登录获取扫描人信息，微信支付查询支付状态</p>
<p>6、Cookie</p>
<p>（1）Cookie特点：</p>
<p>* 客户端技术</p>
<p>* 每次发送请求带着cookie值进行发送</p>
<p>* cookie有默认会话级别，关闭浏览器cookie默认不存在了，</p>
<p>* 但是可以设置cookie有效时长  setMaxAge</p>
<p>7、微信登录</p>
<p>8、微信支付</p>
<p>9、阿里云OSS</p>
<p>（1）文件存储服务器</p>
<p>（2）添加讲师时候上传讲师头像</p>
<p>10、阿里云视频点播</p>
<p>（1）视频上传、删除、播放</p>
<p>（2）整合阿里云视频播放器进行视频播放</p>
<p>* 使用视频播放凭证</p>
<p>11、阿里云短信服务</p>
<p>（1）注册时候，发送手机验证码</p>
<p>12、Git</p>
<p>（1）代码提交到远程Git仓库</p>
<p>13、Docker+Jenkins</p>
<p>（1）手动打包运行</p>
<p>（2）idea打包</p>
<p>（3）jenkins自动化部署过程</p>
<h1 id="总结在线教育项目问题"><a href="#总结在线教育项目问题" class="headerlink" title="总结在线教育项目问题"></a>总结在线教育项目问题</h1><p>1、前端问题-路由切换问题</p>
<p>（1）多次路由跳转到同一个vue页面，页面中created方法只会执行一次</p>
<p>（2）解决方案：使用vue监听</p>
<p>2、前端问题-ES6模块化运行问题</p>
<p>（1）Nodejs不能直接运行ES6模块化代码，需要使用Babel把ES6模块化代码转换ES5代码 执行</p>
<p>3、mp生成19位id值</p>
<p>（1）mp生成id值是19位，JavaScript处理数字类型值时候，只会处理到16位</p>
<p>4、跨域问题</p>
<p>（1）访问协议，ip地址，端口号，这三个如果有任何一个不一样，产生跨域</p>
<p>（2）跨域解决：</p>
<p>* 在Controller添加注解</p>
<p>* 通过网关解决</p>
<p>5、413问题</p>
<p>（1）上传视频时候，因为Nginx有上传文件大小限制，如果超过Nginx大小，出现413</p>
<p>（2）413错误：请求体过大</p>
<p>（3）在Nginx配置客户端大小</p>
<p>（4）响应状态码：413  403  302</p>
<p>6、Maven加载问题</p>
<p>（1）maven加载项目时候，默认不会加载src-java文件夹里面xml类型文件的</p>
<p>（2）解决方案：</p>
<p>* 直接复制xml文件到target目录</p>
<p>* 通过配置实现</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">小白菜</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/10/01/%E8%B0%B7%E7%B2%92%E5%AD%A6%E9%99%A2/">http://example.com/2022/10/01/%E8%B0%B7%E7%B2%92%E5%AD%A6%E9%99%A2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">是小白菜哦</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/">实战项目</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220806101221.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/10/20/%E6%96%B0%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%9F%BA%E6%9C%AClinux%E9%83%A8%E7%BD%B2%E7%8E%AF%E5%A2%83/"><img class="prev-cover" src="https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220806101221.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">新建虚拟机并配置基本linux部署环境</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/30/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96/"><img class="next-cover" src="https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220806101221.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">瑞吉外卖</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/pic.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">小白菜</div><div class="author-info__description">头发多多</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Xiaobaicai350"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Xiaobaicai350" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1499487526@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">阳光斑斓 微风含香 爱与四季 皆是向往 <img height="230" lengh="230" src="https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/1.gif"/></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Day1"><span class="toc-number">1.</span> <span class="toc-text">Day1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E4%B8%9A%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">商业模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#B2C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.1.</span> <span class="toc-text">B2C模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B2B2C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.2.</span> <span class="toc-text">B2B2C模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%B7%E7%B2%92%E5%AD%A6%E9%99%A2%E5%8A%9F%E8%83%BD%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.</span> <span class="toc-text">谷粒学院功能简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mybatis-Plus"><span class="toc-number">1.3.</span> <span class="toc-text">Mybatis Plus</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83"><span class="toc-number">1.3.1.</span> <span class="toc-text">配置环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">1.3.2.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAMapper"><span class="toc-number">1.3.3.</span> <span class="toc-text">创建Mapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97"><span class="toc-number">1.3.4.</span> <span class="toc-text">配置日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E6%96%B0%E5%A2%9E%E7%AD%96%E7%95%A5"><span class="toc-number">1.3.5.</span> <span class="toc-text">主键新增策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="toc-number">1.3.6.</span> <span class="toc-text">自动填充</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">1.3.7.</span> <span class="toc-text">乐观锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-number">1.3.8.</span> <span class="toc-text">分页插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4"><span class="toc-number">1.3.9.</span> <span class="toc-text">逻辑删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E6%8F%92%E4%BB%B6"><span class="toc-number">1.3.10.</span> <span class="toc-text">性能分析插件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day2"><span class="toc-number">2.</span> <span class="toc-text">Day2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">搭建项目结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E8%AF%B4%E6%98%8E"><span class="toc-number">2.1.1.</span> <span class="toc-text">模块说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">配置配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MP%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8%E7%94%9F%E6%88%90%E5%A4%A7%E8%87%B4%E6%A1%86%E6%9E%B6"><span class="toc-number">2.3.</span> <span class="toc-text">MP代码生成器生成大致框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E8%BF%94%E5%9B%9Ejson%E6%97%B6%E9%97%B4%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.4.</span> <span class="toc-text">统一返回json时间的格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8service%E4%B8%AD%E4%BD%BF%E7%94%A8swagger"><span class="toc-number">2.5.</span> <span class="toc-text">在service中使用swagger</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%8Apom%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84bean%E4%BA%A4%E7%BB%99spring%E7%AE%A1%E7%90%86%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">2.6.</span> <span class="toc-text">把pom文件中的bean交给spring管理的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C"><span class="toc-number">2.7.</span> <span class="toc-text">统一返回结果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.7.1.</span> <span class="toc-text">编码实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE"><span class="toc-number">2.8.</span> <span class="toc-text">跨域配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2%E5%88%86%E9%A1%B5"><span class="toc-number">2.9.</span> <span class="toc-text">条件查询分页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.10.</span> <span class="toc-text">统一异常处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86"><span class="toc-number">2.11.</span> <span class="toc-text">统一日志处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB"><span class="toc-number">2.11.1.</span> <span class="toc-text">配置日志级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%8A%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA%E5%88%B0%E6%96%87%E4%BB%B6%E4%B8%AD"><span class="toc-number">2.11.2.</span> <span class="toc-text">把日志输出到文件中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%8A%E9%94%99%E8%AF%AF%E7%9A%84%E6%97%A5%E5%BF%97%E5%8D%95%E7%8B%AC%E8%BE%93%E5%87%BA"><span class="toc-number">2.11.3.</span> <span class="toc-text">把错误的日志单独输出</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day3"><span class="toc-number">3.</span> <span class="toc-text">Day3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8VSCode%E9%87%8C%E9%9D%A2%E5%88%9B%E5%BB%BA%E5%B7%A5%E4%BD%9C%E5%8C%BA"><span class="toc-number">3.1.</span> <span class="toc-text">在VSCode里面创建工作区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ES6"><span class="toc-number">3.2.</span> <span class="toc-text">ES6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">3.2.1.</span> <span class="toc-text">基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#let%E5%A3%B0%E6%98%8E%E5%8F%98%E9%87%8F"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">let声明变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#const%E5%A3%B0%E6%98%8E%E5%B8%B8%E9%87%8F%EF%BC%88%E5%8F%AA%E8%AF%BB%E5%8F%98%E9%87%8F%EF%BC%89"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">const声明常量（只读变量）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">解构赋值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">3.2.1.4.</span> <span class="toc-text">模板字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%AF%B9%E8%B1%A1%E7%AE%80%E5%86%99"><span class="toc-number">3.2.1.5.</span> <span class="toc-text">声明对象简写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95%E7%AE%80%E5%86%99"><span class="toc-number">3.2.1.6.</span> <span class="toc-text">定义方法简写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%89%A9%E5%B1%95%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">3.2.1.7.</span> <span class="toc-text">对象扩展运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.1.8.</span> <span class="toc-text">箭头函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue"><span class="toc-number">3.3.</span> <span class="toc-text">Vue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Element-UI"><span class="toc-number">3.4.</span> <span class="toc-text">Element-UI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-js"><span class="toc-number">3.5.</span> <span class="toc-text">Node.js</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%88%E6%9E%9C"><span class="toc-number">3.5.1.</span> <span class="toc-text">模拟服务器效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8vscode%E4%BD%BF%E7%94%A8nodejs"><span class="toc-number">3.5.2.</span> <span class="toc-text">在vscode使用nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85NPM"><span class="toc-number">3.5.2.1.</span> <span class="toc-text">安装NPM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#npm%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E6%93%8D%E4%BD%9C"><span class="toc-number">3.5.2.2.</span> <span class="toc-text">npm项目初始化操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#npm%E4%B8%8B%E8%BD%BDjs%E4%BE%9D%E8%B5%96"><span class="toc-number">3.5.2.3.</span> <span class="toc-text">npm下载js依赖</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babel%E8%BD%AC%E7%A0%81%E5%99%A8"><span class="toc-number">3.6.</span> <span class="toc-text">babel转码器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85babel"><span class="toc-number">3.6.1.</span> <span class="toc-text">安装babel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAjs%E6%96%87%E4%BB%B6-%E7%BC%96%E5%86%99es6%E4%BB%A3%E7%A0%81"><span class="toc-number">3.6.2.</span> <span class="toc-text">创建js文件,编写es6代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E5%8C%96%E6%93%8D%E4%BD%9C"><span class="toc-number">3.7.</span> <span class="toc-text">模块化操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#es5%E6%A8%A1%E5%9D%97%E5%8C%96%E6%93%8D%E4%BD%9C"><span class="toc-number">3.7.1.</span> <span class="toc-text">es5模块化操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#es6%E6%A8%A1%E5%9D%97%E5%8C%96%E6%93%8D%E4%BD%9C"><span class="toc-number">3.7.2.</span> <span class="toc-text">es6模块化操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E5%86%99%E6%B3%95"><span class="toc-number">3.7.2.1.</span> <span class="toc-text">第一种写法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E5%86%99%E6%B3%95"><span class="toc-number">3.7.2.2.</span> <span class="toc-text">第二种写法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webpack"><span class="toc-number">3.8.</span> <span class="toc-text">Webpack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Webpack"><span class="toc-number">3.8.1.</span> <span class="toc-text">安装Webpack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Webpack%E6%89%93%E5%8C%85js"><span class="toc-number">3.8.2.</span> <span class="toc-text">使用Webpack打包js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Webpack%E6%89%93%E5%8C%85css"><span class="toc-number">3.8.3.</span> <span class="toc-text">使用Webpack打包css</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%90%AF%E5%8A%A8%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.9.</span> <span class="toc-text">使用模板启动项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">3.9.1.</span> <span class="toc-text">项目的创建和基本配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.9.1.1.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%A1%B9%E7%9B%AE%E4%BF%A1%E6%81%AF"><span class="toc-number">3.9.1.2.</span> <span class="toc-text">修改项目信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">3.9.1.3.</span> <span class="toc-text">项目的目录结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.9.1.4.</span> <span class="toc-text">运行项目</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E5%A4%AA%E5%BC%80%E5%BF%83%E4%BA%86"><span class="toc-number">3.9.2.</span> <span class="toc-text">我太开心了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%82%B9"><span class="toc-number">3.9.3.</span> <span class="toc-text">项目中需要注意的点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.10.</span> <span class="toc-text">前端页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E5%88%97%E8%A1%A8%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.10.1.</span> <span class="toc-text">讲师列表前端实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EasyExcel"><span class="toc-number">3.11.</span> <span class="toc-text">EasyExcel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8EasyExcel%E8%BF%9B%E8%A1%8C%E5%86%99%E6%93%8D%E4%BD%9C"><span class="toc-number">3.11.1.</span> <span class="toc-text">使用EasyExcel进行写操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8EasyExcel%E8%BF%9B%E8%A1%8C%E8%AF%BB%E6%93%8D%E4%BD%9C"><span class="toc-number">3.11.2.</span> <span class="toc-text">使用EasyExcel进行读操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day9"><span class="toc-number">4.</span> <span class="toc-text">Day9</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%9C%80%E7%BB%88%E5%8F%91%E5%B8%83%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.1.</span> <span class="toc-text">课程最终发布实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF%E7%A1%AE%E8%AE%A4"><span class="toc-number">4.1.1.</span> <span class="toc-text">课程信息确认</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83"><span class="toc-number">4.1.2.</span> <span class="toc-text">课程发布</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%97%E8%A1%A8"><span class="toc-number">4.2.</span> <span class="toc-text">课程列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%97%E8%A1%A8%E6%98%BE%E7%A4%BA"><span class="toc-number">4.2.1.</span> <span class="toc-text">课程列表显示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%A0%E9%99%A4"><span class="toc-number">4.2.2.</span> <span class="toc-text">课程删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E8%A7%86%E9%A2%91%E7%82%B9%E6%92%AD%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.3.</span> <span class="toc-text">阿里云视频点播服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%B0%8F%E8%8A%82%E5%AE%9E%E7%8E%B0%E8%A7%86%E9%A2%91%E4%B8%8A%E4%BC%A0"><span class="toc-number">4.4.</span> <span class="toc-text">添加小节实现视频上传</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day12"><span class="toc-number">5.</span> <span class="toc-text">Day12</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B"><span class="toc-number">5.1.</span> <span class="toc-text">登录实现流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSO%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.1.</span> <span class="toc-text">SSO模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%89%E7%A7%8D%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">常见的三种单点登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JWT"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">JWT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88JWT"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">整合JWT</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.1.2.</span> <span class="toc-text">整合阿里云短信微服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%B3%A8%E5%86%8C%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.2.</span> <span class="toc-text">登录接口和注册接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">5.2.1.</span> <span class="toc-text">编写实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAcontroller%E7%BC%96%E5%86%99%E7%99%BB%E5%BD%95%E5%92%8C%E6%B3%A8%E5%86%8C%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.2.</span> <span class="toc-text">创建controller编写登录和注册方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAservice%E6%8E%A5%E5%8F%A3%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">5.2.3.</span> <span class="toc-text">创建service接口和实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%A0%B9%E6%8D%AEtoken%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">5.2.4.</span> <span class="toc-text">创建接口根据token获取用户信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day13"><span class="toc-number">6.</span> <span class="toc-text">Day13</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.1.</span> <span class="toc-text">登录前端实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%92%8C%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%E9%A6%96%E9%A1%B5%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="toc-number">6.1.1.</span> <span class="toc-text">登录和登录成功之后首页显示数据的实现过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8api%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E7%9A%84js%E6%96%87%E4%BB%B6%EF%BC%8C%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.1.1.1.</span> <span class="toc-text">在api文件夹中创建登录的js文件，定义接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8pages%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%EF%BC%8C%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">6.1.1.2.</span> <span class="toc-text">在pages文件夹中创建登录页面，调用方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9layouts%E4%B8%AD%E7%9A%84default-vue%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.1.1.3.</span> <span class="toc-text">修改layouts中的default.vue页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95"><span class="toc-number">6.2.</span> <span class="toc-text">微信扫码登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OAuth2"><span class="toc-number">6.2.1.</span> <span class="toc-text">OAuth2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95"><span class="toc-number">6.2.2.</span> <span class="toc-text">微信登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF"><span class="toc-number">6.2.2.1.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF"><span class="toc-number">6.2.2.2.</span> <span class="toc-text">前端</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day14"><span class="toc-number">7.</span> <span class="toc-text">Day14</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8D%E5%B8%88%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">7.1.</span> <span class="toc-text">名师列表功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8D%E5%B8%88%E8%AF%A6%E6%83%85%E5%8A%9F%E8%83%BD"><span class="toc-number">7.2.</span> <span class="toc-text">名师详情功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">7.3.</span> <span class="toc-text">课程列表功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%AF%A6%E6%83%85%E5%8A%9F%E8%83%BD"><span class="toc-number">7.4.</span> <span class="toc-text">课程详情功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89vo%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.4.1.</span> <span class="toc-text">定义vo对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89Mapper%E6%96%B9%E6%B3%95"><span class="toc-number">7.4.2.</span> <span class="toc-text">定义Mapper方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%B1%82%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%B9%B6%E6%9B%B4%E6%96%B0%E6%B5%8F%E8%A7%88%E9%87%8F"><span class="toc-number">7.4.3.</span> <span class="toc-text">业务层获取数据并更新浏览量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%B1%82"><span class="toc-number">7.4.4.</span> <span class="toc-text">接口层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E9%98%BF%E9%87%8C%E4%BA%91%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8%E5%AE%9E%E7%8E%B0%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE"><span class="toc-number">7.5.</span> <span class="toc-text">整合阿里云视频播放器实现视频播放</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E8%8E%B7%E5%8F%96%E6%92%AD%E6%94%BE%E5%87%AD%E8%AF%81"><span class="toc-number">7.5.1.</span> <span class="toc-text">后端获取播放凭证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%92%AD%E6%94%BE%E5%99%A8%E6%95%B4%E5%90%88"><span class="toc-number">7.5.2.</span> <span class="toc-text">前端播放器整合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%B6%85%E9%93%BE%E6%8E%A5"><span class="toc-number">7.5.2.1.</span> <span class="toc-text">修改超链接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99api"><span class="toc-number">7.5.2.2.</span> <span class="toc-text">编写api</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E8%B7%B3%E8%BD%AC%E7%9A%84%E9%A1%B5%E9%9D%A2%EF%BC%88%E6%92%AD%E6%94%BE%E9%A1%B5%E9%9D%A2%EF%BC%89"><span class="toc-number">7.5.3.</span> <span class="toc-text">创建动态路由跳转的页面（播放页面）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day15"><span class="toc-number">8.</span> <span class="toc-text">Day15</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%AF%E4%BB%98%E5%8A%9F%E8%83%BD"><span class="toc-number">8.1.</span> <span class="toc-text">支付功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%94%AF%E4%BB%98%E9%9C%80%E6%B1%82%E6%8F%8F%E8%BF%B0"><span class="toc-number">8.1.1.</span> <span class="toc-text">课程支付需求描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">8.1.2.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.1.3.</span> <span class="toc-text">开发创建订单接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%8E%B7%E5%8F%96%E8%AE%A2%E5%8D%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.1.4.</span> <span class="toc-text">开发获取订单接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.1.5.</span> <span class="toc-text">生成微信支付二维码接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E7%9A%84%E6%94%AF%E4%BB%98%E7%8A%B6%E6%80%81%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.1.6.</span> <span class="toc-text">查询用户的支付状态接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%94%AF%E4%BB%98%E5%89%8D%E7%AB%AF"><span class="toc-number">8.2.</span> <span class="toc-text">课程支付前端</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day16"><span class="toc-number">9.</span> <span class="toc-text">Day16</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%E6%A8%A1%E5%9D%97"><span class="toc-number">9.1.</span> <span class="toc-text">统计分析模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1"><span class="toc-number">9.1.1.</span> <span class="toc-text">后端实现服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">9.1.2.</span> <span class="toc-text">定时任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.1.3.</span> <span class="toc-text">前端页面实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%9B%86%E6%88%90ECharts"><span class="toc-number">9.1.4.</span> <span class="toc-text">前端集成ECharts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E5%90%8E%E7%AB%AF%E4%B8%9A%E5%8A%A1"><span class="toc-number">9.1.5.</span> <span class="toc-text">完成后端业务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day17"><span class="toc-number">10.</span> <span class="toc-text">Day17</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Canal"><span class="toc-number">10.1.</span> <span class="toc-text">Canal</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Canal%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.1.1.</span> <span class="toc-text">Canal介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Canal%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">10.1.2.</span> <span class="toc-text">Canal环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85Canal%E6%9C%8D%E5%8A%A1"><span class="toc-number">10.1.3.</span> <span class="toc-text">下载安装Canal服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Cannal"><span class="toc-number">10.1.4.</span> <span class="toc-text">使用Cannal</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">10.2.</span> <span class="toc-text">权限管理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day18"><span class="toc-number">11.</span> <span class="toc-text">Day18</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Security"><span class="toc-number">11.1.</span> <span class="toc-text">Spring Security</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-number">11.1.1.</span> <span class="toc-text">认证与授权实现思路</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E9%A1%B9%E7%9B%AE%E5%8A%9F%E8%83%BD%E7%82%B9"><span class="toc-number">12.</span> <span class="toc-text">总结在线教育项目功能点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E9%A1%B9%E7%9B%AE%E6%8A%80%E6%9C%AF%E7%82%B9%EF%BC%88%E5%89%8D%E7%AB%AF%EF%BC%89"><span class="toc-number">13.</span> <span class="toc-text">总结在线教育项目技术点（前端）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E9%A1%B9%E7%9B%AE%E6%8A%80%E6%9C%AF%E7%82%B9%EF%BC%88%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%80%EF%BC%89"><span class="toc-number">14.</span> <span class="toc-text">总结在线教育项目技术点（后端技术一）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98"><span class="toc-number">15.</span> <span class="toc-text">总结在线教育项目问题</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/04/%E7%9B%98%E7%82%B9Mysql%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E6%97%A5%E5%BF%97/" title="盘点Mysql中常见的日志">盘点Mysql中常见的日志</a><time datetime="2023-08-04T07:03:41.000Z" title="发表于 2023-08-04 15:03:41">2023-08-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/04/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" title="深入理解InnoDB存储引擎">深入理解InnoDB存储引擎</a><time datetime="2023-08-04T07:03:33.000Z" title="发表于 2023-08-04 15:03:33">2023-08-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/04/%E8%AF%A6%E8%A7%A3MySQL%E9%94%81/" title="详解MySQL锁">详解MySQL锁</a><time datetime="2023-08-04T07:03:23.000Z" title="发表于 2023-08-04 15:03:23">2023-08-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/04/SQL%E4%BC%98%E5%8C%96%E6%9C%80%E5%B9%B2%E8%B4%A7%E6%80%BB%E7%BB%93/" title="SQL优化最干货总结">SQL优化最干货总结</a><time datetime="2023-08-04T07:03:16.000Z" title="发表于 2023-08-04 15:03:16">2023-08-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/02/%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%EF%BC%88%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95%EF%BC%89/" title="索引设计（前缀索引）">索引设计（前缀索引）</a><time datetime="2023-08-02T06:17:13.000Z" title="发表于 2023-08-02 14:17:13">2023-08-02</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://raw.githubusercontent.com/Xiaobaicai350/picBed/master/xiaobaicai/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220806101221.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By 小白菜</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欢迎来到小白菜的blog~</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script src="/js/sakura.js"></script><script src="https://myhkw.cn/player/js/player.js" id="myhk" key="159611061656" m="1"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>